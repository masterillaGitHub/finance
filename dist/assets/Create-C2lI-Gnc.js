import{u as B}from"./bank.create.store-C5HiQ1H2.js";import{a6 as O,C as z,_ as G,i as g,m as M,y as F,r as a,o as d,d as k,w as u,j as c,b as h,c as A,F as V,x as j,a as _,t as w,e as $,f as E,cj as H,bz as Q}from"./index-CECwDoZT.js";import{r as U,u as W}from"./form_validate-BcbkTvQT.js";import{a as D}from"./Model-m4MKmFK9.js";import{u as X}from"./currency_decimal_convert-KKbzYINo.js";class Y extends O{getResource(){return"bank-manager"}static getAccounts(t){return new this().getAccounts(t)}async getAccounts(t){return await this.params({bankId:t}).get("/get-accounts")}}class Z extends O{getResource(){return"bank-account"}}const J=z("bank-accounts/mono/create",{state:()=>({accountsLoading:!1,accounts:[],selectedAccountsIds:[]}),getters:{getAccounts:e=>e.accounts.map(t=>ee(t))},actions:{async loadAccountsByBankId(e){this.accountsLoading=!0;try{const t=await Y.getAccounts(e);this.accounts=t.data.data}finally{this.accountsLoading=!1}},async saveAccounts(e){const t=this.selectedAccountsIds.map(n=>this.accounts.find(s=>s.id===n)).map(n=>({idOrigin:n.id,name:`Mono ${n.currency}, ${n.type}`,currencyCode:n.currencyCode,creditLimit:n.creditLimit}));console.log("accounts",t),await Z.store({bankId:e,accounts:t})}}}),ee=e=>{const{toDecimal:t}=X(),n=e.creditLimit>0;let s=e.balance,o=0;return n&&(s=e.balance-e.creditLimit,o=e.balance),{id:e.id,isCredit:n,balance:D(t(s),e.currency),availableBalance:D(t(o),e.currency),maskedPan:e.maskedPan,name:`Mono ${e.currency}, ${e.type}`}},te={class:"d-flex w-100 justify-space-between"},ne={class:""},oe={class:"text-right"},ae={key:0,class:"text-subtitle-2"},se={__name:"TheAccountsStep",setup(e,{expose:t}){const n=B(),s=J(),o=g();g(!1);const p=M(()=>s.getAccounts.map(r=>({id:r.id,label:JSON.stringify({...r})}))),i=W(o);F(async()=>{await s.loadAccountsByBankId(n.bankId)});const l=(r,f)=>JSON.parse(r)[f]??"",m=r=>l(r,"availableBalance"),v=r=>l(r,"balance"),b=r=>l(r,"maskedPan"),y=r=>l(r,"name"),L=r=>l(r,"isCredit");return t({formCheck:()=>i.check()}),(r,f)=>{const T=a("v-progress-linear"),C=a("v-checkbox"),K=a("v-form");return d(),k(K,{ref_key:"formAccountsRef",ref:o},{default:u(()=>[c(T,{active:h(s).accountsLoading,indeterminate:""},null,8,["active"]),(d(!0),A(V,null,j(p.value,(R,q)=>(d(),k(C,{key:R.id,multiple:"",modelValue:h(s).selectedAccountsIds,"onUpdate:modelValue":f[0]||(f[0]=x=>h(s).selectedAccountsIds=x),value:R.id,label:R.label,rules:[h(U)],"hide-details":q+1<p.value.length,class:"s-checkbox mb-4"},{label:u(({label:x})=>[_("div",te,[_("div",ne,[_("div",null,w(y(x)),1),_("div",null,w(b(x)),1)]),_("div",oe,[_("div",null,w(v(x)),1),L(x)?(d(),A("div",ae," Доступно: "+w(m(x)),1)):$("",!0)])])]),_:2},1032,["modelValue","value","label","rules","hide-details"]))),128))]),_:1},512)}}},ce=G(se,[["__scopeId","data-v-f013be7a"]]);function re(e){const t=async()=>(await e.value.validate()).length===0,n=()=>e.value.resetValidation();return{validate:t,resetValidation:n,check:async()=>(n(),await t())}}const le={__name:"TheTokenStep",setup(e,{expose:t}){const n=B(),s=g(),o=[U],p=re(s);return t({formCheck:()=>p.check()}),(l,m)=>{const v=a("v-text-field");return d(),A(V,null,[m[1]||(m[1]=_("p",{class:"mb-4"},[E("Токен потрібно отримати за посиланням "),_("a",{href:"https://api.monobank.ua/",target:"_blank"},"https://api.monobank.ua/")],-1)),c(v,{label:"Token",rules:o,modelValue:h(n).token,"onUpdate:modelValue":m[0]||(m[0]=b=>h(n).token=b),ref_key:"tokenRef",ref:s},null,8,["modelValue"])],64)}}},ue={__name:"TheFinishStep",setup(e){const t=B(),n=J();return F(async()=>{await n.saveAccounts(t.bankId)}),(s,o)=>{const p=a("v-card-title"),i=a("v-card-text"),l=a("v-btn"),m=a("v-card-actions"),v=a("v-card");return d(),k(v,null,{default:u(()=>[c(p,null,{default:u(()=>o[0]||(o[0]=[E("Монобанк підключено")])),_:1}),c(i,null,{default:u(()=>o[1]||(o[1]=[_("ul",null,[_("li",null,"Встановлюємо зв'язки"),_("li",null,"Вантажимо історію транзакцій"),_("li",null,"Визначаємо категорії платежів"),_("li",null,"Оновлюємо графічки")],-1)])),_:1}),c(m,{class:"justify-center mt-5"},{default:u(()=>[c(l,{to:{name:"accounts.index"},variant:"tonal",text:"Готово"})]),_:1})]),_:1})}}},I=1,N=2,S=3,ie={__name:"Index",setup(e){const t=g(),n=g(),s=[I,N,S],o=g(1),p=async i=>{o.value===I&&!await t.value.formCheck()||o.value===N&&!await n.value.formCheck()||i()};return(i,l)=>{const m=a("v-stepper-item"),v=a("v-divider"),b=a("v-stepper-header"),y=a("v-stepper-window-item"),L=a("v-stepper-window"),P=a("v-stepper-actions"),r=a("v-stepper");return d(),k(r,{modelValue:o.value,"onUpdate:modelValue":l[0]||(l[0]=f=>o.value=f)},{default:u(({prev:f,next:T})=>[c(b,null,{default:u(()=>[(d(),A(V,null,j(s,C=>(d(),A(V,{key:C},[c(m,{complete:o.value>C,value:C},null,8,["complete","value"]),C<S?(d(),k(v,{key:0})):$("",!0)],64))),64))]),_:1}),c(L,null,{default:u(()=>[c(y,{value:I},{default:u(()=>[c(le,{ref_key:"tokenComponentRef",ref:t},null,512)]),_:1}),c(y,{value:N},{default:u(()=>[c(ce,{ref_key:"accountsComponentRef",ref:n},null,512)]),_:1}),c(y,{value:S},{default:u(()=>[c(ue)]),_:1})]),_:1}),o.value<S?(d(),k(P,{key:0,"prev-text":"назад","next-text":"далі","onClick:next":C=>p(T),"onClick:prev":f},null,8,["onClick:next","onClick:prev"])):$("",!0)]),_:1},8,["modelValue"])}}},fe={__name:"Create",setup(e){const t=B(),n={mono:ie},s=M(()=>t.bankId),o=M(()=>{var i;const p=((i=H.find(l=>l.id===s.value))==null?void 0:i.template)??"";return n[p]});return(p,i)=>{const l=a("v-btn"),m=a("v-toolbar-title"),v=a("v-spacer"),b=a("v-toolbar"),y=a("v-card");return d(),k(y,{class:"fill-height"},{default:u(()=>[c(b,{color:"cyan-lighten-1"},{default:u(()=>[c(l,{to:{name:"banks.index"},icon:"mdi-arrow-left",variant:"text"}),c(m,null,{default:u(()=>i[0]||(i[0]=[E("Підключення")])),_:1}),c(v)]),_:1}),(d(),k(Q(o.value)))]),_:1})}}};export{fe as default};
