var ot=Object.defineProperty;var at=(s,t,e)=>t in s?ot(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var u=(s,t,e)=>(at(s,typeof t!="symbol"?t+"":t,e),e),B=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var n=(s,t,e)=>(B(s,t,"read from private field"),e?e.call(s):t.get(s)),d=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},c=(s,t,e,i)=>(B(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e);var _=(s,t,e)=>(B(s,t,"access private method"),e);import{E as lt,M as ct,P as j,Q as H,R as ut,S as ht,T as dt,U as mt,r as C,o as L,d as K,w as N,c as pt,F as yt,y as ft,k as W,f as Y,t as D}from"./index-B9rgIAwP.js";import{i as gt,b as _t,d as G,r as Rt,c as It}from"./functions-DAvG65lt.js";const p=lt("models",{state:()=>({models:{},activeIds:{}}),getters:{getAll:s=>(t,e=!1)=>At(s,t,e),getById:s=>(t,e)=>Z(s,t,e),getByIds:s=>(t,e)=>J(s,t,e),getByLoaded:s=>t=>J(s,t,vt(s,t))},actions:{setActiveIds(s,t){F(this,s),this.activeIds[s]=t},addActiveId(s,t){F(this,s),this.activeIds[s].push(t)},removeLoadedId(s,t){F(this,s);const e=this.activeIds.indexOf(t);delete this.activeIds[e]},setCollection(s,t){typeof this.models[s]>"u"&&(this.models[s]={}),this.models[s]=t},updateById(s,t,e){typeof this.models[s]>"u"&&(console.info(`create state model [${s}]`),this.models[s]={});const i={...this.models[s][t],...e},r={...this.models[s],[t]:i},a={...this.models,[s]:r};this.models=a},removeById(s,t){if(typeof this.models[s]>"u"){console.warn(`Not found state model [${s}]`);return}delete this.models[s][t]},reset(){this.models={}}}});function F(s,t){typeof s.activeIds[t]>"u"&&(s.activeIds[t]=[])}function vt(s,t){return s.activeIds[t]??[]}function At(s,t,e=!1){const i=s.models[t];return e?i??{}:i?Object.values(i):[]}function J(s,t,e){return e.map(i=>Z(s,t,i)).filter(i=>i)}function Z(s,t,e){let i=s.models[t]??null;return i?i[e]:null}function Ot(s,t,e={},i={}){for(let[r,a]of Object.entries(s)){let m=i.hasOwnProperty(r)?i[r]:t;e.hasOwnProperty(r)&&(r=e[r]),bt(m,r,a)}}function wt(s,t){if(gt(t))return;p().setActiveIds(s,t)}function bt(s,t,e){switch(s){case H:q(t,e);break;case j:Et(t,e);break;case ct:Ct(t,e);break}}function q(s,t){p().setCollection(s,t)}function Et(s,t){x(s),q(s,Object.assign({},{...x(s),...t}))}function Ct(s,t){console.log("fillModels update Field");const e={...x(s)};for(const i in t){const r={...e[i]};e[i]=Object.assign(r,t[i])}q(s,e)}function x(s){return p().getAll(s,!0)}var l,g,o,f,w,b,E,R,P,M,tt,S,et,z;let Nt=(z=class{constructor(){d(this,R);d(this,M);d(this,S);d(this,l,null);d(this,g,{});d(this,o,{});d(this,f,{});d(this,w,H);d(this,b,{});d(this,E,{});this.api=new ut}static make(t){const e=new this;return e.setModel(t),e}getResponse(){return n(this,o)}getMeta(){return n(this,f)}getResourceUrl(t=null){return t?n(this,l).urlResource()+t:n(this,l).urlResource()}getStorageNames(){let t={};return n(this,l)&&(t[n(this,l).includeName()]=n(this,l).storageName()),{...t,...n(this,E)}}setModel(t){return c(this,l,t),this}setUpdateMode(t){return c(this,w,t),this}setParams(t){return c(this,g,t),this}setUpdateModes(t){return c(this,b,t),this}setStorageNames(t){return c(this,E,t),this}async get(t=null){var e;return this.api.params(n(this,g)),c(this,o,await this.api.query(this.getResourceUrl(t))),c(this,f,(e=n(this,o).data)==null?void 0:e.meta),_(this,R,P).call(this,n(this,o).data,n(this,w)),n(this,o)}async create(){var i;const t=n(this,l).urlResource(),e=n(this,l).toObject();return console.log("api create resource",t,e),this.api.params(n(this,g)),c(this,o,await this.api.post(t,e)),c(this,f,(i=n(this,o).data)==null?void 0:i.meta),_(this,R,P).call(this,n(this,o).data,j),n(this,o)}async update(){const t=n(this,l).urlResource()+"/"+n(this,l).getId(),e=n(this,l).toObject();return console.log("api update resource",t,e),this.api.params(n(this,g)),c(this,o,await this.api.patch(t,e)),c(this,f,n(this,o).data.meta),_(this,R,P).call(this,n(this,o).data,j),n(this,o)}async destroy(){const t=n(this,l).urlResource()+"/"+n(this,l).getId();return console.log("api destroy resource",t),c(this,o,await this.api.delete(t)),c(this,f,n(this,o).data.meta),n(this,o)}},l=new WeakMap,g=new WeakMap,o=new WeakMap,f=new WeakMap,w=new WeakMap,b=new WeakMap,E=new WeakMap,R=new WeakSet,P=function(t,e){wt(n(this,l).storageName(),t.data),Ot(_(this,M,tt).call(this,t.included),e,this.getStorageNames(),n(this,b))},M=new WeakSet,tt=function(t){for(const[e,i]of Object.entries(t))t[e]=_(this,S,et).call(this,i);return t},S=new WeakSet,et=function(t){for(const[e,i]of Object.entries(t))i.exists=!0,t[e]=i;return t},z);class h{constructor(){u(this,"model",null);u(this,"params",{});this.params=this._getDefaultParams()}static make(t){const e=new this;return e.setModel(t),e}setModel(t){return this.model=t,this}setParams(t){return this.params={...this.params,...t},this}all(){const e=p().getAll(this._storageName());return this._handlerEntities(e)}find(t){const i=p().getById(this._storageName(),t);return i?this._handlerEntities([i])[0]:null}findIn(t){const i=p().getByIds(this._storageName(),t);return this._handlerEntities(i)}findLoaded(){const e=p().getByLoaded(this._storageName());return this._handlerEntities(e)}copyToStorage(t){const e=p(),i=e.getById(this._storageName(),this.model.id);e.updateById(t,this.model.id,i)}moveToStorage(t){this.copyToStorage(t),this._storeRemoveById(this.model.id)}update(){this._storeCommit()}create(){return this.model.getId()||this.model.setId(_t()),this._storeCommit(),this.model.getId()}remove(){this._storeRemoveById(this.model.getId())}removeById(t){this._storeRemoveById(t)}_storeRemoveById(t){p().removeById(this._storageName(),t)}_storeCommit(){const t=p(),e=G(this.model.toObject());t.updateById(this._storageName(),this.model.getId(),e)}_getDefaultParams(){return{model:!0,copy:!0,deepCopy:!0,with:[]}}_isFieldRelation(t){return this.model.isFieldRelation(t)}_getRelation(t){return this.model.relations()[t]??null}_storageName(){const t=this.model.storageName();if(!t)throw new Error("Is not founded storage name");return t}_handlerEntities(t){if(!Array.isArray(t))throw Error("Is not correct ids");return t.length?(this._isCopy()&&(t=t.map(e=>this._copyObj(e))),this._isWithRelations()&&(t=t.map(e=>this._completeRelations(e))),this._isModel()&&(t=t.map(e=>this._completeModel(e))),t):[]}_completeRelations(t){if(!t)return null;for(let[e,i]of Object.entries(t))if(this._isFieldRelation(e)&&i){const a=Array.isArray(i)?this._getRelation(e).findIn(i,this.params):this._getRelation(e).find(i,this.params);t[e]=a}return t}_completeModel(t){return this.model.clone().fill(t)}_isWithRelations(){return this.params.hasOwnProperty("with")&&this.params.with.length>0}_isModel(){return this.params.hasOwnProperty("model")&&this.params.model===!0}_isCopy(){return this.params.hasOwnProperty("copy")&&this.params.copy===!0}_isDeepCopy(){return this.params.hasOwnProperty("deepCopy")&&this.params.deepCopy===!0}_copyObj(t){return t&&(this._isDeepCopy()?G(t):{...t})}}function kt(){return typeof window<"u"?window.console:global.console}const y=kt();function Pt(s,t=!1){let e=[0,"0",!1,"false","",[],{},NaN,"NaN",null,"null",void 0,"undefined"],i;return t?(i=e.reduce(function(r,a){return r+(a===s?1:0)}),i>0):(i=e.indexOf(s),i>-1)}function O(s){return Array.isArray(s)}function Mt(s){return!O(s)}function k(s){return s===null}function qt(s){return!isNaN(Number(s))}function Vt(s){return typeof s=="number"}function St(s){return Pt(s)}function $t(s){return!St(s)}function Kt(s){return O(s)&&s.length===0}const Q="array",Tt="object";var T,I;const $=class ${constructor(){u(this,"relationships",{});u(this,"_dependentRelationships",{});u(this,"exists",!1);u(this,"_baseUrl","/api/v1");u(this,"_resourceName",null);d(this,T,[]);u(this,"_storageName",null);u(this,"_includeName",null);u(this,"_primaryKey","id");d(this,I,null)}instance(){return new this.constructor}static make(){return new this}static query(){return new this().query()}static sync(t={}){return new this().sync(t)}static fill(t){return new this().fill(t)}static createLocal(){return new this().createLocal()}static all(t){return new this().all(t)}static find(t,e={}){return new this().find(t,e)}static findIn(t,e={}){return new this().findIn(t,e)}static findLoaded(t={}){return new this().findLoaded(t)}apiResource(){return n(this,I)}urlResource(){return this._baseUrl+"/"+this.resourceName()}resourceName(){return this._resourceName}includeName(){return this._includeName||this.resourceName().replace("-","_")}storageName(){return this._storageName||this.includeName()}relations(){return this._relations}primaryKey(){return this._primaryKey}getId(){return this[this._primaryKey]??null}setId(t){return this[this._primaryKey]=t,this}setResourceName(t){return this._resourceName=t,this}setIncludeName(t){return this._includeName=t,this}setStorageName(t){return this._storageName=t,this}fill(t){return this._creator(t),this}toObject(){return Object.getOwnPropertyNames(this).reduce((e,i)=>(this.isFieldAttribute(i)&&(e[i]=this[i]),e),{})}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}query(){return Nt.make(this)}async sync(t={}){c(this,I,this.query());const e=await n(this,I).setParams(t).get();return y.log("sync response",e),c(this,T,e.data.data),e.data.data}all(t={}){return h.make(this).setParams(t).all()}find(t,e={}){return h.make(this).setParams(e).find(t)??this.instance()}findIn(t,e={}){return h.make(this).setParams(e).findIn(t)}findLoaded(t={}){return h.make(this).setParams(t).findLoaded()}createLocal(){const t=h.make(this).create();return this._updateDependentRelationships(t),t}updateLocal(){h.make(this).update()}destroyLocal(){h.make(this).remove()}copyToStorage(t){h.make(this).copyToStorage(t)}moveToStorage(t){h.make(this).moveToStorage(t)}save(t={}){return this.exists?this.update(t):this.create(t)}async create(t={}){const e=h.make(this),i=e.create();this._updateDependentRelationships(i);try{const r=await this.query().setParams(t).create();return this._updateDependentRelationships(r.data.data,i),y.log("model create response",r),e.removeById(i),r.data.data}catch(r){y.log("removeById",i),e.removeById(i),y.error("Error: "+r)}}async update(t={}){const e=h.make(this),i=e.find(this.getId());e.update();try{const r=await this.query().setParams(t).update();return y.log("model update response",r),r.data.data}catch(r){h.make(i).update(),y.error("Error: "+r)}return i.getId()}async destroy(){const t=h.make(this),e=t.find(this.getId());t.remove();try{const i=await this.query().destroy();return y.log("model update response",i),this.getId()}catch(i){h.make(e).update(),y.error("Error: "+i)}}isFieldAttribute(t){return this.isPublicField(t)}isPublicField(t){return!t.startsWith("_")&&!t.startsWith("#")}hasOne(t,e){return this.relationships.hasOwnProperty(t)?e.find(this.relationships[t])??null:null}hasMany(t,e){return this.relationships.hasOwnProperty(t)?e.findIn(this.relationships[t])??[]:[]}belongsTo(t,e,i=null,r=null,a=null){if(this.putRelation(t,e),k(i))return;const m=i.find(e);r=r||this.storageName(),this._dependentRelationships[t]={relationEntity:m,localRelationName:r,localStorageName:a}}hasRelation(t){return!!this.getRelation(t)}setRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships[t]=e}addRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships.hasOwnProperty(t)||(this.relationships[t]=[]),this.relationships[t].push(e)}getRelation(t){return this.relationships[t]??null}removeRelation(t){delete this.relationships[t],this._checkAndDeleteRelationshipsField()}removeRelationValue(t,e){const i=this.getRelation(t);if(k(i)||Mt(i))return;const r=i.indexOf(e);delete this.relationships[t][r]}isFieldRelation(t){return(Array.isArray(this._relations)?Q:Tt)===Q?this._relations.includes(t):this._relations.hasOwnProperty(t)}isFieldModel(t){return this[t]instanceof $}_convertModelToId(t){return t.getId()}_creator(t){t=t||{};for(let[e,i]of Object.entries(t))this[e]=i}_checkAndCreateRelationshipsField(){this.hasOwnProperty("relationships")||(this.relationships={})}_checkAndDeleteRelationshipsField(){Object.entries(this.relationships).length===0&&delete this.relationships}_updateDependentRelationships(t,e=null){const i=Object.entries(this._dependentRelationships);for(let[r,{relationEntity:a,localRelationName:m}]of i)k(e)?a.putRelation(m,t):e!==0?a.replaceRelation(m,t,e):a.deleteRelation(m,t),a.updateLocal()}deleteRelation(t,e=null){const i=this[t];if(O(i)){if(k(e))throw Error("Delete Relation: no value specified");this.removeRelationValue(t,e)}else this.removeRelation(t)}replaceRelation(t,e,i){const r=this[t];if(O(r)){const a=this.getRelation(t);this.setRelation(t,Rt(a,i,e))}else this.setRelation(t,e)}putRelation(t,e){const i=this[t];O(i)?this.addRelation(t,e):this.setRelation(t,e)}};T=new WeakMap,I=new WeakMap;let v=$;class V extends v{constructor(){super(...arguments);u(this,"_resourceName","currencies")}get icon(){var e;return((e=ht.find(i=>i.id===this.id))==null?void 0:e.icon)??null}}class st extends v{constructor(){super(...arguments);u(this,"_resourceName","account-sums")}get currency(){return this.hasOne("currency",V)}set currency(e){return this.belongsTo("currency",e)}get account(){this.hasOne("account",U)}set account(e){this.belongsTo("account",e,U,"sums")}}class X extends v{constructor(){super(...arguments);u(this,"_resourceName","account-categories")}get accounts(){return this.hasMany("accounts",U)}get icon(){var e;return((e=dt.find(i=>i.id===this.id))==null?void 0:e.icon)??null}getSum(){return this.accounts.reduce((e,i)=>i.getSum()+e,0)}storageIndex(){return this.setStorageName(mt)}static async loadMainPage(){return await this.query().get("/main-page")}async loadMainPage(){return await this.query().get("/main-page")}}class U extends v{constructor(){super(...arguments);u(this,"_resourceName","accounts")}get sums(){return this.hasMany("sums",st)}set sums(e){this.belongsTo("sums",e)}get category(){return this.hasOne("category",X)}set category(e){this.belongsTo("category",e,X,"accounts")}get currency(){return this.hasOne("currency",V)}set currency(e){this.belongsTo("currency",e)}getSum(){return It(this.sums,"balance")}}function Bt(s){return s instanceof st}function Wt(s){return s.every(Bt)}function it(s){return s instanceof V}function Lt(s){return s.every(it)}const Yt={__name:"CurrenciesList",props:{currencies:{type:Array,required:!0,validator:Lt}},emits:{selected:it},setup(s,{emit:t}){const e=t;return(i,r)=>{const a=C("v-list-item-title"),m=C("v-list-item-subtitle"),rt=C("v-list-item"),nt=C("v-list");return L(),K(nt,null,{default:N(()=>[(L(!0),pt(yt,null,ft(s.currencies,A=>(L(),K(rt,{key:A.id,onClick:Dt=>e("selected",A)},{default:N(()=>[W(a,null,{default:N(()=>[Y(D(A.name),1)]),_:2},1024),W(m,null,{default:N(()=>[Y(D(A.symbol)+", "+D(A.alphabetic_code),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})}}};export{U as A,V as C,Yt as _,X as a,$t as b,qt as c,st as d,Bt as e,it as f,Vt as g,Kt as i,p as u,Wt as v};
