import{_ as J}from"./FullscreenAppBar-XBChpMej.js";import{h,k as P,l as K}from"./entities-DXs83vKd.js";import{G as Q,P as k,r as o,o as c,d as _,b as i,w as r,k as e,Y as W,a as I,t as Z,c as w,F as T,y as S,n as x,O as E,f as N,e as M,j as U,V as ee,z as te}from"./index-uNLpc8m8.js";import{_ as ae,r as oe,u as ne,a as q}from"./DialogComponent-DSQFJjBp.js";import{_ as re}from"./BottomConfirm-COa7FO5-.js";const y=Q("settings/categories",{state:()=>({categoryLoading:!1,editCategory:null,editDialog:!1,storeDialog:!1,currentTab:k,categoryIds:[]}),getters:{categories:a=>h.findIn(a.categoryIds)},actions:{async loadCategories(){console.log("load categories"),this.categoryLoading=!0;try{this.categoryIds=await h.sync({include:"children.parent,parent","filter[user_id]":"auth"})}finally{this.categoryLoading=!1}},async saveCategory(a){await a.save()},setNewCategory(){const a=new h;a.type=this.currentTab,this.editCategory=a,this.storeDialog=!0},setEditCategory(a){this.editCategory=a,this.editDialog=!0},closeDialog(){this.editDialog=!1,this.storeDialog=!1,setTimeout(()=>{this.editCategory=!1},1e3)}}}),B={__name:"CategoryItem",props:{category:{type:Object,required:!0,validator:P}},setup(a){const t=y();return(m,s)=>{const n=o("v-list-item");return c(),_(n,{"prepend-icon":a.category.icon,title:a.category.name,onClick:s[0]||(s[0]=d=>i(t).setEditCategory(a.category))},null,8,["prepend-icon","title"])}}},se={__name:"CategoryItemGroup",props:{category:{type:Object,required:!0,validator:P}},setup(a){const t=y();return(m,s)=>{const n=o("v-badge"),d=o("v-list-item-title"),f=o("v-btn"),u=o("v-list-item"),C=o("v-list-group");return c(),_(C,null,{activator:r(({props:v})=>[e(u,{"prepend-icon":a.category.icon,onClick:s[0]||(s[0]=b=>i(t).setEditCategory(a.category))},{append:r(({isActive:b})=>[e(f,W(v,{icon:b?"mdi-chevron-up":"mdi-chevron-down",variant:"text"}),null,16,["icon"])]),default:r(()=>[e(d,null,{default:r(()=>[I("span",null,Z(a.category.name),1),e(n,{content:a.category.childrenCount(),inline:"",color:"transparent"},null,8,["content"])]),_:1})]),_:2},1032,["prepend-icon"])]),default:r(()=>[(c(!0),w(T,null,S(a.category.children,v=>(c(),_(B,{key:v.id,category:v},null,8,["category"]))),128))]),_:1})}}},L={__name:"CategoryList",props:{categories:{type:Array,default:()=>[],validator:K}},setup(a){return(t,m)=>{const s=o("v-list");return c(),_(s,null,{default:r(()=>[(c(!0),w(T,null,S(a.categories,n=>(c(),w(T,{key:n.id},[n.isChildren()?(c(),_(se,{key:0,category:n},null,8,["category"])):(c(),_(B,{key:1,category:n},null,8,["category"]))],64))),128))]),_:1})}}},le={class:"pa-2"},ie={__name:"CategoryListTabs",setup(a){const t=y(),m=x(()=>t.categories.filter(n=>n.type_id===k)),s=x(()=>t.categories.filter(n=>n.type_id===E));return(n,d)=>{const f=o("v-tab"),u=o("v-tabs"),C=o("v-card"),v=o("v-tabs-window-item"),b=o("v-tabs-window"),$=o("v-fade-transition");return c(),w(T,null,[I("div",le,[e(C,{loading:i(t).categoryLoading},{default:r(()=>[e(u,{modelValue:i(t).currentTab,"onUpdate:modelValue":d[0]||(d[0]=V=>i(t).currentTab=V),grow:""},{default:r(()=>[e(f,{value:i(k)},{default:r(()=>[N("Витрати")]),_:1},8,["value"]),e(f,{value:i(E)},{default:r(()=>[N("Доходи")]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1},8,["loading"])]),e($,null,{default:r(()=>[i(t).categories.length?(c(),_(C,{key:0},{default:r(()=>[e(b,{modelValue:i(t).currentTab,"onUpdate:modelValue":d[1]||(d[1]=V=>i(t).currentTab=V)},{default:r(()=>[e(v,{value:i(k)},{default:r(()=>[e(L,{categories:m.value},null,8,["categories"])]),_:1},8,["value"]),e(v,{value:i(E)},{default:r(()=>[e(L,{categories:s.value},null,8,["categories"])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1})):M("",!0)]),_:1})],64)}}},ce={class:"text-center mb-4"},F={__name:"TheFormCategory",props:{title:{type:String,required:!0}},setup(a){const t=y(),m=U(),s={name:"Немає",id:null},n=x(()=>!!u.value.exists),d=x({get:()=>{var g;return(g=u.value.parent)!=null&&g.exists?u.value.parent:s},set:g=>u.value.parent=g}),f=U(!1),u=x(()=>t.editCategory),C=x($),{check:v}=ne(m),b=[oe];function $(){const g=t.categories.filter(l=>l.type_id===t.currentTab).filter(l=>l.id!==u.value.id).map(l=>({name:l.name,id:l.id}));return g.unshift(s),g}async function V(){await v()&&(t.closeDialog(),await t.saveCategory(u.value),await t.loadCategories())}function O(){t.closeDialog(),u.value.destroy()}return(g,l)=>{const j=o("v-text-field"),z=o("v-select"),Y=o("v-form"),G=o("v-card-text"),A=o("v-divider"),D=o("v-btn"),R=o("v-spacer"),X=o("v-card-actions"),H=o("v-card");return c(),_(H,{"prepend-icon":"mdi-credit-card-edit-outline",title:a.title},{default:r(()=>[e(G,null,{default:r(()=>[I("div",ce,[e(ae,{modelValue:u.value.icon,"onUpdate:modelValue":l[0]||(l[0]=p=>u.value.icon=p)},null,8,["modelValue"])]),e(Y,{onSubmit:ee(V,["prevent"]),ref_key:"form",ref:m},{default:r(()=>[e(j,{label:"Назва категорії",modelValue:u.value.name,"onUpdate:modelValue":l[1]||(l[1]=p=>u.value.name=p),rules:b,autofocus:!n.value},null,8,["modelValue","autofocus"]),e(z,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=p=>d.value=p),label:"Батьківська категорія",items:C.value,"item-title":"name","item-value":"id"},null,8,["modelValue","items"])]),_:1},512),e(re,{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=p=>f.value=p),title:"Видалити?",onSuccess:O},null,8,["modelValue"])]),_:1}),e(A),e(X,null,{default:r(()=>[n.value?(c(),_(D,{key:0,class:"text-red",icon:"mdi-delete-outline",variant:"plain",onClick:l[4]||(l[4]=p=>f.value=!0)})):M("",!0),e(R),e(D,{text:"Відміна",size:"large",variant:"plain",onClick:l[5]||(l[5]=p=>i(t).closeDialog())}),e(D,{size:"large",color:"primary",text:"Зберегти",variant:"tonal",onClick:V})]),_:1})]),_:1},8,["title"])}}},ue={__name:"TheCategoryEdit",setup(a){const t=y();return(m,s)=>(c(),_(q,{modelValue:i(t).editDialog,"onUpdate:modelValue":s[0]||(s[0]=n=>i(t).editDialog=n)},{default:r(()=>[e(F,{title:"Редагування категорії"})]),_:1},8,["modelValue"]))}},de={__name:"TheCategoryCreate",setup(a){const t=y();return(m,s)=>(c(),_(q,{modelValue:i(t).storeDialog,"onUpdate:modelValue":s[0]||(s[0]=n=>i(t).storeDialog=n)},{default:r(()=>[e(F,{title:"Нова категорія"})]),_:1},8,["modelValue"]))}},_e={class:""},ye={__name:"Index",setup(a){const t=y();return te(async()=>{await t.loadCategories()}),(m,s)=>{const n=o("v-btn");return c(),w("div",_e,[e(J,{"path-name":"settings.index",title:"Категорії"},{default:r(()=>[e(n,{icon:"mdi-plus",onClick:s[0]||(s[0]=d=>i(t).setNewCategory())})]),_:1}),e(ie),e(de),e(ue)])}}};export{ye as default};
