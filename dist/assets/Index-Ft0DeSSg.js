import{_ as X}from"./FullscreenAppBar-BZePO86Z.js";import{h,k as L,l as H}from"./entities-CNJ8_7LR.js";import{J as K,Q as k,r as o,o as c,d as _,b as i,w as r,k as e,a0 as W,a as I,t as Z,c as w,F as T,z as P,n as x,S as E,f as N,e as B,j as S,Y as ee,B as te}from"./index-CxbfblZZ.js";import{_ as ae,r as oe,u as ne,a as M}from"./DialogComponent-DLV67brD.js";import{_ as re}from"./BottomConfirm-KNcKc8gK.js";const y=K("settings/categories",{state:()=>({categoryLoading:!1,editCategory:null,editDialog:!1,storeDialog:!1,currentTab:k,categoryIds:[]}),getters:{categories:a=>h.findIn(a.categoryIds)},actions:{async loadCategories(){console.log("load categories"),this.categoryLoading=!0;try{this.categoryIds=await h.sync({include:"children.parent,parent","filter[user_id]":"auth"})}finally{this.categoryLoading=!1}},async saveCategory(a){await a.save()},setNewCategory(){const a=new h;a.type=this.currentTab,this.editCategory=a,this.storeDialog=!0},setEditCategory(a){this.editCategory=a,this.editDialog=!0},closeDialog(){this.editDialog=!1,this.storeDialog=!1,setTimeout(()=>{this.editCategory=!1},1e3)}}}),q={__name:"CategoryItem",props:{category:{type:Object,required:!0,validator:L}},setup(a){const t=y();return(m,s)=>{const n=o("v-list-item");return c(),_(n,{"prepend-icon":a.category.icon,title:a.category.name,onClick:s[0]||(s[0]=d=>i(t).setEditCategory(a.category))},null,8,["prepend-icon","title"])}}},se={__name:"CategoryItemGroup",props:{category:{type:Object,required:!0,validator:L}},setup(a){const t=y();return(m,s)=>{const n=o("v-badge"),d=o("v-list-item-title"),f=o("v-btn"),u=o("v-list-item"),C=o("v-list-group");return c(),_(C,null,{activator:r(({props:v})=>[e(u,{"prepend-icon":a.category.icon,onClick:s[0]||(s[0]=b=>i(t).setEditCategory(a.category))},{append:r(({isActive:b})=>[e(f,W(v,{icon:b?"mdi-chevron-up":"mdi-chevron-down",variant:"text"}),null,16,["icon"])]),default:r(()=>[e(d,null,{default:r(()=>[I("span",null,Z(a.category.name),1),e(n,{content:a.category.childrenCount(),inline:"",color:"transparent"},null,8,["content"])]),_:1})]),_:2},1032,["prepend-icon"])]),default:r(()=>[(c(!0),w(T,null,P(a.category.children,v=>(c(),_(q,{key:v.id,category:v},null,8,["category"]))),128))]),_:1})}}},U={__name:"CategoryList",props:{categories:{type:Array,default:()=>[],validator:H}},setup(a){return(t,m)=>{const s=o("v-list");return c(),_(s,null,{default:r(()=>[(c(!0),w(T,null,P(a.categories,n=>(c(),w(T,{key:n.id},[n.isChildren()?(c(),_(se,{key:0,category:n},null,8,["category"])):(c(),_(q,{key:1,category:n},null,8,["category"]))],64))),128))]),_:1})}}},le={class:"pa-2"},ie={__name:"CategoryListTabs",setup(a){const t=y(),m=x(()=>t.categories.filter(n=>n.type_id===k)),s=x(()=>t.categories.filter(n=>n.type_id===E));return(n,d)=>{const f=o("v-tab"),u=o("v-tabs"),C=o("v-card"),v=o("v-tabs-window-item"),b=o("v-tabs-window"),$=o("v-fade-transition");return c(),w(T,null,[I("div",le,[e(C,{loading:i(t).categoryLoading},{default:r(()=>[e(u,{modelValue:i(t).currentTab,"onUpdate:modelValue":d[0]||(d[0]=V=>i(t).currentTab=V),grow:""},{default:r(()=>[e(f,{value:i(k)},{default:r(()=>[N("Витрати")]),_:1},8,["value"]),e(f,{value:i(E)},{default:r(()=>[N("Доходи")]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1},8,["loading"])]),e($,null,{default:r(()=>[i(t).categories.length?(c(),_(C,{key:0},{default:r(()=>[e(b,{modelValue:i(t).currentTab,"onUpdate:modelValue":d[1]||(d[1]=V=>i(t).currentTab=V)},{default:r(()=>[e(v,{value:i(k)},{default:r(()=>[e(U,{categories:m.value},null,8,["categories"])]),_:1},8,["value"]),e(v,{value:i(E)},{default:r(()=>[e(U,{categories:s.value},null,8,["categories"])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1})):B("",!0)]),_:1})],64)}}},ce={class:"text-center mb-4"},F={__name:"TheFormCategory",props:{title:{type:String,required:!0}},setup(a){const t=y(),m=S(),s={name:"Немає",id:null},n=x(()=>!!u.value.exists),d=x({get:()=>{var g;return(g=u.value.parent)!=null&&g.exists?u.value.parent:s},set:g=>u.value.parent=g}),f=S(!1),u=x(()=>t.editCategory),C=x($),{check:v}=ne(m),b=[oe];function $(){const g=t.categories.filter(l=>l.type_id===t.currentTab).filter(l=>l.id!==u.value.id).map(l=>({name:l.name,id:l.id}));return g.unshift(s),g}async function V(){await v()&&(t.closeDialog(),await t.saveCategory(u.value),await t.loadCategories())}function j(){t.closeDialog(),u.value.destroy()}return(g,l)=>{const z=o("v-text-field"),O=o("v-select"),Y=o("v-form"),A=o("v-card-text"),G=o("v-divider"),D=o("v-btn"),J=o("v-spacer"),Q=o("v-card-actions"),R=o("v-card");return c(),_(R,{"prepend-icon":"mdi-credit-card-edit-outline",title:a.title},{default:r(()=>[e(A,null,{default:r(()=>[I("div",ce,[e(ae,{modelValue:u.value.icon,"onUpdate:modelValue":l[0]||(l[0]=p=>u.value.icon=p)},null,8,["modelValue"])]),e(Y,{onSubmit:ee(V,["prevent"]),ref_key:"form",ref:m},{default:r(()=>[e(z,{label:"Назва категорії",modelValue:u.value.name,"onUpdate:modelValue":l[1]||(l[1]=p=>u.value.name=p),rules:b,autofocus:!n.value},null,8,["modelValue","autofocus"]),e(O,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=p=>d.value=p),label:"Батьківська категорія",items:C.value,"item-title":"name","item-value":"id"},null,8,["modelValue","items"])]),_:1},512),e(re,{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=p=>f.value=p),title:"Видалити?",onSuccess:j},null,8,["modelValue"])]),_:1}),e(G),e(Q,null,{default:r(()=>[n.value?(c(),_(D,{key:0,class:"text-red",icon:"mdi-delete-outline",variant:"plain",onClick:l[4]||(l[4]=p=>f.value=!0)})):B("",!0),e(J),e(D,{text:"Відміна",size:"large",variant:"plain",onClick:l[5]||(l[5]=p=>i(t).closeDialog())}),e(D,{size:"large",color:"primary",text:"Зберегти",variant:"tonal",onClick:V})]),_:1})]),_:1},8,["title"])}}},ue={__name:"TheCategoryEdit",setup(a){const t=y();return(m,s)=>(c(),_(M,{modelValue:i(t).editDialog,"onUpdate:modelValue":s[0]||(s[0]=n=>i(t).editDialog=n)},{default:r(()=>[e(F,{title:"Редагування категорії"})]),_:1},8,["modelValue"]))}},de={__name:"TheCategoryCreate",setup(a){const t=y();return(m,s)=>(c(),_(M,{modelValue:i(t).storeDialog,"onUpdate:modelValue":s[0]||(s[0]=n=>i(t).storeDialog=n)},{default:r(()=>[e(F,{title:"Нова категорія"})]),_:1},8,["modelValue"]))}},_e={class:""},ye={__name:"Index",setup(a){const t=y();return te(async()=>{await t.loadCategories()}),(m,s)=>{const n=o("v-btn");return c(),w("div",_e,[e(X,{"path-name":"settings.index",title:"Категорії"},{default:r(()=>[e(n,{icon:"mdi-plus",onClick:s[0]||(s[0]=d=>i(t).setNewCategory())})]),_:1}),e(ie),e(de),e(ue)])}}};export{ye as default};
