import{a as k}from"./Model-52kJW6XD.js";import{f as v,T as D}from"./entities-Be7q-u-Q.js";import{r as d,o as s,c as i,a as o,t as l,s as A,j as r,e as p,_ as L,m as y,Q as j,i as x,w as I,d as g,h as O,E,F as N,x as z,k as C,P,n as q,C as S,R as B,M,z as F,S as R}from"./index-msQYrNo8.js";import{u as V}from"./currency_decimal_convert-KKbzYINo.js";const G={class:"d-flex"},U={key:0},H={class:"text-green"},Q={__name:"TransactionItemAmount",props:{fromAccount:{required:!0,type:Object},toAccount:{type:Object,default:()=>({})},isTypeTransfer:{required:!0,type:Boolean}},setup(t){function e(n,a){return Math.abs(n)===Math.abs(a)}return(n,a)=>{const c=d("v-icon");return s(),i("div",G,[o("div",{class:A({"text-green":t.fromAccount.isIncome})},l(t.fromAccount.amountDisplay),3),t.isTypeTransfer&&!e(t.fromAccount.amount,t.toAccount.amount)?(s(),i("div",U,[r(c,{class:"mx-1 text-grey-darken-1",icon:"mdi-arrow-right-thin"}),o("span",H,l(t.toAccount.amountDisplay),1)])):p("",!0)])}}},W={class:"d-flex text-grey-darken-1"},Y={class:"text-truncate"},Z={key:0,class:"d-flex s-min-width-0 s-max-width-70"},J={class:"text-truncate"},K={__name:"TransactionItemAccounts",props:{fromAccount:{required:!0,type:Object},toAccount:{type:Object,default:()=>({})},isTypeTransfer:{required:!0,type:Boolean}},setup(t){return(e,n)=>{const a=d("v-icon");return s(),i("div",W,[o("div",{class:A(["d-flex s-min-width-0",[t.isTypeTransfer?"s-max-width-70":"w-100"]])},[r(a,{icon:t.fromAccount.icon,class:"mr-2"},null,8,["icon"]),o("span",Y,l(t.fromAccount.name),1)],2),t.isTypeTransfer?(s(),i("div",Z,[r(a,{icon:"mdi-arrow-right-thin",class:"mx-1"}),r(a,{icon:t.toAccount.icon,class:"mr-2"},null,8,["icon"]),o("span",J,l(t.toAccount.name),1)])):p("",!0)])}}},X=L(K,[["__scopeId","data-v-e9a16d8e"]]),tt={class:"d-flex text-grey-darken-1"},et={class:"mr-2"},at={class:"text-truncate"},nt={__name:"TransactionItemTags",props:{transaction:{required:!0,type:Object,validator:v}},setup(t){const e=t,n=y(()=>e.transaction.tags.map(a=>a.name).join(", "));return(a,c)=>{const u=d("v-icon");return s(),i("div",tt,[o("div",et,[r(u,{icon:"mdi-tag-outline"})]),o("div",at,l(n.value),1)])}}},st={class:"s-text-truncate-wrapper mr-3"},ot={class:"font-weight-bold text-truncate"},ct={__name:"TransactionItemTitle",props:{transaction:{required:!0,type:Object,validator:v}},setup(t){const e=t,n=y(()=>e.transaction.description||e.transaction.category.name);return(a,c)=>(s(),i("div",st,[o("div",ot,l(n.value),1)]))}},rt=L(ct,[["__scopeId","data-v-4fe7fb10"]]),it={class:"d-flex text-grey-darken-1"},ut={class:"mr-2"},lt={class:"text-truncate"},dt={__name:"TransactionItemNote",props:{transaction:{required:!0,type:Object,validator:v}},setup(t){return(e,n)=>{const a=d("v-icon");return s(),i("div",it,[o("div",ut,[r(a,{icon:"mdi-text"})]),o("div",lt,l(t.transaction.note),1)])}}},mt={class:"d-flex justify-space-between"},_t={class:"pa-2"},ft={class:"d-flex flex-column flex-grow-1",style:{"min-width":"0"}},pt={class:"d-flex flex-wrap flex-grow-1"},yt={__name:"TransactionItem",props:{t:{type:Object,required:!0,validator:v}},setup(t){const e=t,n=V(),a=y(()=>e.t.type.id===j),c=x({}),u=x({});function m(){const f=e.t.amount>0;c.value={name:e.t.account.name,icon:e.t.account.icon,amount:e.t.amount,amountDisplay:_(n.toDecimal(e.t.amount),e.t.currency.alphabetic_code),isIncome:f},a.value&&(u.value={name:e.t.transfer_transaction.account.name,icon:e.t.transfer_transaction.account.icon,amount:e.t.transfer_transaction.amount,amountDisplay:_(n.toDecimal(e.t.transfer_transaction.amount),e.t.transfer_transaction.currency.alphabetic_code)})}function _(f,h){return k(f,h,{signDisplay:"exceptZero"}).replace("-","")}return m(),(f,h)=>{const $=d("v-icon"),w=d("v-avatar");return s(),i("div",mt,[o("div",_t,[r(w,{size:"small"},{default:I(()=>[r($,{size:"large",icon:t.t.category.icon},null,8,["icon"])]),_:1})]),o("div",ft,[o("div",pt,[r(rt,{transaction:t.t},null,8,["transaction"]),r(Q,{"is-type-transfer":a.value,"from-account":c.value,"to-account":u.value},null,8,["is-type-transfer","from-account","to-account"])]),r(X,{"is-type-transfer":a.value,"from-account":c.value,"to-account":u.value},null,8,["is-type-transfer","from-account","to-account"]),t.t.tags.length>0?(s(),g(nt,{key:0,transaction:t.t},null,8,["transaction"])):p("",!0),t.t.note?(s(),g(dt,{key:1,transaction:t.t},null,8,["transaction"])):p("",!0)])])}}},ht={class:"s-group"},vt={class:"text-grey my-3"},$t={__name:"TransactionGroup",props:{group:Object},setup(t){const e=O(),n=a=>{e.push({name:"transactions.edit",params:{id:a.id}})};return(a,c)=>{const u=E("ripple");return s(),i("div",ht,[o("div",vt,l(t.group.date),1),(s(!0),i(N,null,z(t.group.transactions,m=>C((s(),g(yt,{class:"py-1",t:m,onClick:_=>n(m)},null,8,["t","onClick"])),[[u]])),256))])}}},gt={key:0,class:"mt-8 h-3 text-center"},wt={__name:"TheBottomLazyLoading",props:{show:{type:Number,default:100},load:{type:Number,default:100},enable:{type:Boolean,default:!1}},emits:["load"],setup(t,{emit:e}){const n=t,a=e,c=P(),u=y(()=>c.offsetTopPercent>=n.show&&c.offsetTop>0),m=y(()=>u.value||c.offsetTop>0&&c.offsetTopPercent>=n.load);return q(m,_=>{_===!0&&n.enable&&a("load")}),(_,f)=>{const h=d("v-progress-circular");return u.value&&t.enable?(s(),i("div",gt,[r(h,{indeterminate:""})])):p("",!0)}}},kt=S("transaction/index",{state:()=>({meta:{},transactionsLoading:!0,isEmptyData:!1,isLoadLock:!1,isAccessLazyLoad:!1}),getters:{currentNumberPage:t=>{var e;return((e=t.meta)==null?void 0:e.current_page)??1},nextNumberPage(){return this.currentNumberPage+1}},actions:{async firstLoadTransactions(t){const n=Object.assign({include:["type","account","currency","category","tags","transfer_transaction.type","transfer_transaction.account","transfer_transaction.currency","transfer_transaction.category","transfer_transaction.tags"].join(","),page:1,sort:"-transaction_at,-id"},t),a=await T(n);this.isAccessLazyLoad=B(a.data.data),b(this,a)},async lazyLoadTransactions(t={}){if(this.isLoadLock)return;const e=["type","account","currency","category","tags","transfer_transaction.type","transfer_transaction.account","transfer_transaction.currency","transfer_transaction.category","transfer_transaction.tags"];this.transactionsLoading=!0,this.isLoadLock=!0;try{const n=Object.assign({include:e.join(","),page:this.nextNumberPage,sort:"-transaction_at,-id"},t),a=await T(n);b(this,a)}finally{this.transactionsLoading=!1,this.isLoadLock=!1}},reset(){this.isEmptyData=!1,this.isAccessLazyLoad=!1}}});async function T(t){return await D.query().setUpdateMode(M).setParams(t).get()}function b(t,e){t.meta=e.data.meta,t.isEmptyData=F(e.data.data)}function Dt(t){return Object.values(t.reduce(xt,{}))}function xt(t,e){const n=e.transaction_at_date;return R(t[n])&&(t[n]={date:e.transaction_at_date,timestamp:e.transaction_at_timestamp,transactions:[]}),t[n].transactions.push(e),t}export{wt as _,$t as a,Dt as t,kt as u};
