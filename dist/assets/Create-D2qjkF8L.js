import{u as V}from"./bank.create.store-CG0j8MVA.js";import{a8 as z,C as G,_ as H,i as x,m as M,y as O,r as a,o as d,d as f,w as u,j as c,c as A,F as B,x as F,b as g,a as _,t as w,e as $,f as E,cl as Q,bB as W}from"./index-DubSSYkJ.js";import{r as U,u as X}from"./form_validate-6xIFQdZU.js";import{a as D}from"./Model-BOWUD3no.js";import{u as Y}from"./currency_decimal_convert-KKbzYINo.js";import{B as Z}from"./BankAccountResource-CNyNOqh9.js";class ee extends z{getResource(){return"bank-manager"}static getAccounts(e){return new this().getAccounts(e)}async getAccounts(e){return await this.params({bankId:e}).get("/get-accounts")}}const j=G("bank-accounts/mono/create",{state:()=>({accountsLoading:!1,accounts:[],selectedAccountsIds:[]}),getters:{getAccounts:t=>t.accounts.map(e=>te(e))},actions:{async loadAccountsByBankId(t){this.accountsLoading=!0;try{const e=await ee.getAccounts(t);this.accounts=e.data.data}finally{this.accountsLoading=!1}},async saveAccounts(t){const e=this.selectedAccountsIds.map(n=>this.accounts.find(r=>r.id===n)).map(n=>({idOrigin:n.id,name:`Mono ${n.currency}, ${n.type}`,currencyCode:n.currencyCode,creditLimit:n.creditLimit}));console.log("accounts",e),await Z.store({bankId:t,accounts:e})}}}),te=t=>{const{toDecimal:e}=Y(),n=t.creditLimit>0;let r=t.balance,o=0;return n&&(r=t.balance-t.creditLimit,o=t.balance),{id:t.id,isCredit:n,balance:D(e(r),t.currency),availableBalance:D(e(o),t.currency),maskedPan:t.maskedPan,name:`Mono ${t.currency}, ${t.type}`}},ne={class:"d-flex w-100 justify-space-between"},oe={class:""},ae={class:"text-right"},se={key:0,class:"text-subtitle-2"},ce={__name:"TheAccountsStep",setup(t,{expose:e}){const n=V(),r=j(),o=x(),m=x(!1),i=M(()=>r.getAccounts.map(s=>({id:s.id,label:JSON.stringify({...s})}))),p=X(o);O(async()=>{m.value=!0;try{await n.storeBankConnection(),await r.loadAccountsByBankId(n.bankId)}finally{m.value=!1}});const l=(s,h)=>JSON.parse(s)[h]??"",v=s=>l(s,"availableBalance"),k=s=>l(s,"balance"),b=s=>l(s,"maskedPan"),L=s=>l(s,"name"),T=s=>l(s,"isCredit");return e({formCheck:()=>p.check()}),(s,h)=>{const y=a("v-progress-linear"),J=a("v-checkbox"),K=a("v-form");return d(),f(K,{ref_key:"formAccountsRef",ref:o},{default:u(()=>[c(y,{active:m.value,indeterminate:""},null,8,["active"]),(d(!0),A(B,null,F(i.value,(I,q)=>(d(),f(J,{key:I.id,multiple:"",modelValue:g(r).selectedAccountsIds,"onUpdate:modelValue":h[0]||(h[0]=C=>g(r).selectedAccountsIds=C),value:I.id,label:I.label,rules:[g(U)],"hide-details":q+1<i.value.length,class:"s-checkbox mb-4"},{label:u(({label:C})=>[_("div",ne,[_("div",oe,[_("div",null,w(L(C)),1),_("div",null,w(b(C)),1)]),_("div",ae,[_("div",null,w(k(C)),1),T(C)?(d(),A("div",se," Доступно: "+w(v(C)),1)):$("",!0)])])]),_:2},1032,["modelValue","value","label","rules","hide-details"]))),128))]),_:1},512)}}},re=H(ce,[["__scopeId","data-v-47c1cd3c"]]);function le(t){const e=async()=>(await t.value.validate()).length===0,n=()=>t.value.resetValidation();return{validate:e,resetValidation:n,check:async()=>(n(),await e())}}const ue={__name:"TheTokenStep",setup(t,{expose:e}){const n=V(),r=x(),o=[U],m=le(r);return e({formCheck:()=>m.check()}),(p,l)=>{const v=a("v-text-field");return d(),A(B,null,[l[1]||(l[1]=_("p",{class:"mb-4"},[E("Токен потрібно отримати за посиланням "),_("a",{href:"https://api.monobank.ua/",target:"_blank"},"https://api.monobank.ua/")],-1)),c(v,{label:"Token",rules:o,modelValue:g(n).token,"onUpdate:modelValue":l[0]||(l[0]=k=>g(n).token=k),ref_key:"tokenRef",ref:r},null,8,["modelValue"])],64)}}},ie={__name:"TheFinishStep",setup(t){const e=V(),n=j();return O(async()=>{await n.saveAccounts(e.bankId)}),(r,o)=>{const m=a("v-card-title"),i=a("v-card-text"),p=a("v-btn"),l=a("v-card-actions"),v=a("v-card");return d(),f(v,null,{default:u(()=>[c(m,null,{default:u(()=>o[0]||(o[0]=[E("Монобанк підключено")])),_:1}),c(i,null,{default:u(()=>o[1]||(o[1]=[_("ul",null,[_("li",null,"Встановлюємо зв'язки"),_("li",null,"Вантажимо історію транзакцій"),_("li",null,"Визначаємо категорії платежів"),_("li",null,"Оновлюємо графічки")],-1)])),_:1}),c(l,{class:"justify-center mt-5"},{default:u(()=>[c(p,{to:{name:"accounts.index"},variant:"tonal",text:"Готово"})]),_:1})]),_:1})}}},R=1,N=2,S=3,_e={__name:"Index",setup(t){const e=x(),n=x(),r=[R,N,S],o=x(1),m=async i=>{o.value===R&&!await e.value.formCheck()||o.value===N&&!await n.value.formCheck()||i()};return(i,p)=>{const l=a("v-stepper-item"),v=a("v-divider"),k=a("v-stepper-header"),b=a("v-stepper-window-item"),L=a("v-stepper-window"),T=a("v-stepper-actions"),P=a("v-stepper");return d(),f(P,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=s=>o.value=s)},{default:u(({prev:s,next:h})=>[c(k,null,{default:u(()=>[(d(),A(B,null,F(r,y=>(d(),A(B,{key:y},[c(l,{complete:o.value>y,value:y},null,8,["complete","value"]),y<S?(d(),f(v,{key:0})):$("",!0)],64))),64))]),_:1}),c(L,null,{default:u(()=>[c(b,{value:R},{default:u(()=>[c(ue,{ref_key:"tokenComponentRef",ref:e},null,512)]),_:1}),c(b,{value:N},{default:u(()=>[c(re,{ref_key:"accountsComponentRef",ref:n},null,512)]),_:1}),c(b,{value:S},{default:u(()=>[c(ie)]),_:1})]),_:1}),o.value<S?(d(),f(T,{key:0,"prev-text":"назад","next-text":"далі","onClick:next":y=>m(h),"onClick:prev":s},null,8,["onClick:next","onClick:prev"])):$("",!0)]),_:1},8,["modelValue"])}}},be={__name:"Create",setup(t){const e=V(),n={mono:_e},r=M(()=>e.bankId),o=M(()=>{var i;const m=((i=Q.find(p=>p.id===r.value))==null?void 0:i.template)??"";return n[m]});return(m,i)=>{const p=a("v-btn"),l=a("v-toolbar-title"),v=a("v-spacer"),k=a("v-toolbar"),b=a("v-card");return d(),f(b,{class:"fill-height"},{default:u(()=>[c(k,{color:"cyan-lighten-1"},{default:u(()=>[c(p,{to:{name:"banks.index"},icon:"mdi-arrow-left",variant:"text"}),c(l,null,{default:u(()=>i[0]||(i[0]=[E("Підключення")])),_:1}),c(v)]),_:1}),(d(),f(W(o.value)))]),_:1})}}};export{be as default};
