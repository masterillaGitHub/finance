import{C as w,_ as O,i as T,m as A,r as _,o as l,c as S,a as C,t as x,b as $,j as m,e as V,w as g,N as F,O as P,f as R,y as j,d as b,F as I,x as D,P as E,B as L}from"./index-BbjtBCCf.js";import{a as M,b as k,c as N,C as y,d as q,v as U,A as z}from"./entities-DFEtP537.js";import{a as Y,b as G}from"./Model-DgptP03g.js";import{_ as H,a as J}from"./CurrenciesList-CEQTwQJt.js";import{u as K}from"./currency_decimal_convert-KKbzYINo.js";const re=w("accounts/index",{state:()=>({amountTotal:0,accountsPanelModel:[],categoriesIds:[]}),getters:{},actions:{addCategoryId(e){this.categoriesIds.indexOf(e)===-1&&this.categoriesIds.push(e)},updateAmountTotal(){const e=M.findIn(this.categoriesIds);this.amountTotal=e.reduce((t,a)=>t+a.getSumInMineCurrency(),0)}}}),Q={class:"d-flex align-center s-item"},W={class:"d-flex align-center"},X={class:"mr-2"},Z={key:0,class:"align-self-center"},ee={__name:"AccountSumItem",props:{accountSum:{type:Object,required:!0,validator:e=>e instanceof k},isAvailableRemove:{type:Boolean,required:!1}},emits:{removeAccountSum:N},setup(e,{emit:t}){const{toDecimal:a,toInteger:v}=K(),o=e,u=t,r=T(!1),d=A(()=>a(o.accountSum.balance)??0),f=A(()=>y.find(o.accountSum.getRelation("currency")));function i(p){G(o.accountSum,{balance:v(p)})}return(p,s)=>{const n=_("v-btn");return l(),S("div",Q,[C("div",W,"Баланс ("+x(f.value.alphabetic_code)+")",1),C("div",{class:"flex-grow-1 d-flex justify-end align-center text-h6",onClick:s[2]||(s[2]=c=>r.value=!0)},[C("span",X,x($(Y)(d.value,f.value.alphabetic_code)),1),m(H,{modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=c=>r.value=c),"start-sum":d.value,onDone:s[1]||(s[1]=c=>i(c))},null,8,["modelValue","start-sum"])]),e.isAvailableRemove?(l(),S("div",Z,[m(n,{variant:"text",icon:"mdi-close",onClick:s[3]||(s[3]=c=>u("removeAccountSum",e.accountSum))})])):V("",!0)])}}},te=O(ee,[["__scopeId","data-v-23e4787d"]]),ne={__name:"TheAddAccountSum",emits:{selectedCurrency:q},setup(e,{emit:t}){const a=t,v=A(()=>y.all());return(o,u)=>{const r=_("v-divider"),d=_("v-btn"),f=_("v-menu");return l(),S("div",null,[m(r,{class:"mb-3"}),m(f,null,{activator:g(({props:i})=>[m(d,F(P(i)),{default:g(()=>u[1]||(u[1]=[R(" Додати валюту ")])),_:2},1040)]),default:g(()=>[m(J,{currencies:v.value,onSelected:u[0]||(u[0]=i=>a("selectedCurrency",i))},null,8,["currencies"])]),_:1})])}}},ie={__name:"TheAccountSums",props:{accountSums:{type:Array,required:!0,validator:U},isCreateFirst:{type:Boolean,default:!1}},emits:{createdAccountSum:N},setup(e,{emit:t}){const a=e,v=t,o=T(!1),u=A(()=>y.findLoaded());j(()=>{r()});async function r(){u.value.length!==3&&await f(),a.isCreateFirst&&d()}function d(){const n=y.all();p(n[0])||s(n[0])}async function f(){o.value=!0;try{await y.sync()}finally{o.value=!1}}function i(n){p(n)||s(n)}function p(n){return a.accountSums.some(c=>c.currency.id===n.id)}function s(n){const c=new k;c.balance=0,c.currency=n.id,v("createdAccountSum",c)}return(n,c)=>{const B=_("v-progress-linear");return l(),S(I,null,[o.value?(l(),b(B,{key:0,indeterminate:""})):V("",!0),(l(!0),S(I,null,D(e.accountSums,h=>(l(),b(te,{key:h.id,"account-sum":h},null,8,["account-sum"]))),128)),m(ne,{onSelectedCurrency:i})],64)}}},le=w("accounts/create",{state:()=>({account:null,sums:[]}),getters:{},actions:{createAccount(e){const t=new z;t.category=e,this.account=t},reset(){this.resetAccount(),this.resetAccountSum(),console.info("account and account sums were reset")},resetAccount(){this.account=null},resetAccountSum(){this.sums=[]},createAccountSum(e){this.sums.push(e)},deleteAccountSum(e){this.sums.splice(this.sums.indexOf(e),1)},async saveAccount(){const e=E();this.account.currency=e.getMainCurrency.id;const t=await this.account.save({include:"sums,category"});this.account.place_type===L&&await this.saveAccountSums(t)},async saveAccountSums(e){if(e)for(const t of this.sums)t.account=e,await t.save({include:"currency"})}}});export{ie as _,le as a,re as u};
