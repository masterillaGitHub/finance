var z=Object.defineProperty;var Q=(s,t,e)=>t in s?z(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(Q(s,typeof t!="symbol"?t+"":t,e),e),L=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var n=(s,t,e)=>(L(s,t,"read from private field"),e?e.call(s):t.get(s)),d=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},h=(s,t,e,r)=>(L(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);var I=(s,t,e)=>(L(s,t,"access private method"),e);import{E as X,M as $,J as M,K as F,a5 as Z,a0 as C,a6 as tt,a7 as B,a8 as et,L as st,a9 as rt}from"./index-DZ83gzV4.js";const p=X("models",{state:()=>({models:{},activeIds:{}}),getters:{getAll:s=>(t,e=!1)=>nt(s,t,e),getById:s=>(t,e)=>H(s,t,e),getByIds:s=>(t,e)=>q(s,t,e),getByLoaded:s=>t=>q(s,t,it(s,t))},actions:{setActiveIds(s,t){D(this,s),this.activeIds[s]=t},addActiveIds(s,t){t.forEach(e=>this.addActiveId(s,e))},addActiveId(s,t){D(this,s),this.activeIds[s].push(t)},removeActiveIds(s,t){t.forEach(e=>this.removeLoadedId(s,e))},removeLoadedId(s,t){D(this,s);const e=this.activeIds.indexOf(t);delete this.activeIds[e]},setCollection(s,t){typeof this.models[s]>"u"&&(this.models[s]={}),this.models[s]=t},updateById(s,t,e){typeof this.models[s]>"u"&&(console.info(`create state model [${s}]`),this.models[s]={});const r={...this.models[s][t],...e},i={...this.models[s],[t]:r},u={...this.models,[s]:i};this.models=u},removeById(s,t){if(typeof this.models[s]>"u"){console.warn(`Not found state model [${s}]`);return}delete this.models[s][t]},reset(s){typeof this.models[s]<"u"&&(this.models[s]={}),typeof this.activeIds[s]<"u"&&(this.activeIds[s]=[])},resetAll(){this.models={},this.activeIds={}}}});function D(s,t){typeof s.activeIds[t]>"u"&&(s.activeIds[t]=[])}function it(s,t){return s.activeIds[t]??[]}function nt(s,t,e=!1){const r=s.models[t];return e?r??{}:r?Object.values(r):[]}function q(s,t,e){return e.map(r=>H(s,t,r)).filter(r=>r)}function H(s,t,e){let r=s.models[t]??null;return r?r[e]:null}function K(s){return JSON.parse(JSON.stringify(s))}function at(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function ot(s,t,e){return s.map(r=>r===t?e:r)}function wt(s,t={}){return ct(s,"UAH",t)}function ct(s,t="UAH",e={},r="uk-UA"){if(typeof s!="number")return s;const i={style:"currency",currency:t,currencyDisplay:"narrowSymbol"};return new Intl.NumberFormat(r,{...i,...e}).format(s)}function vt(s,t){return Object.assign(s,t)}function ht(s){return Array.isArray(s)?s.length===0:Object.keys(s).length===0}function ut(s,t){return s.reduce((e,r)=>parseInt(e,10)+parseInt(r[t],10),0)}function lt(s,t,e={},r={}){for(let[i,u]of Object.entries(s)){let f=r.hasOwnProperty(i)?r[i]:t;e.hasOwnProperty(i)&&(i=e[i]),pt(f,i,u)}}function dt(s,t,e){if(ht(t))return;const r=p();switch(e){case F:r.setActiveIds(s,t);break;case M:case $:r.addActiveIds(s,t);break}}function pt(s,t,e){switch(s){case F:x(t,e);break;case M:mt(t,e);break;case $:yt(t,e);break}}function x(s,t){p().setCollection(s,t)}function mt(s,t){j(s),x(s,Object.assign({},{...j(s),...t}))}function yt(s,t){console.log("fillModels update Field");const e={...j(s)};for(const r in t){const i={...e[r]};e[r]=Object.assign(i,t[r])}x(s,e)}function j(s){return p().getAll(s,!0)}var c,_,a,g,b,w,v,R,E,P,V,S,G,Y;let gt=(Y=class{constructor(){d(this,R);d(this,P);d(this,S);d(this,c,null);d(this,_,{});d(this,a,{});d(this,g,{});d(this,b,F);d(this,w,{});d(this,v,{});this.api=new Z}static make(t){const e=new this;return e.setModel(t),e}getResponse(){return n(this,a)}getMeta(){return n(this,g)}getResourceUrl(t=null){return t?n(this,c).urlResource()+t:n(this,c).urlResource()}getStorageNames(){let t={};return n(this,c)&&(t[n(this,c).includeName()]=n(this,c).storageName()),{...t,...n(this,v)}}setModel(t){return h(this,c,t),this}setUpdateMode(t){return h(this,b,t),this}setParams(t){return h(this,_,t),this}setUpdateModes(t){return h(this,w,t),this}setStorageNames(t){return h(this,v,t),this}async get(t=null){var e;return this.api.params(n(this,_)),h(this,a,await this.api.query(this.getResourceUrl(t))),h(this,g,(e=n(this,a).data)==null?void 0:e.meta),I(this,R,E).call(this,n(this,a).data,n(this,b)),n(this,a)}async create(){var r;const t=n(this,c).urlResource(),e=n(this,c).toObject();return console.log("api create resource",t,e),this.api.params(n(this,_)),h(this,a,await this.api.post(t,e)),h(this,g,(r=n(this,a).data)==null?void 0:r.meta),I(this,R,E).call(this,n(this,a).data,M),n(this,a)}async update(){const t=n(this,c).urlResource()+"/"+n(this,c).getId(),e=n(this,c).toObject();return console.log("api update resource",t,e),this.api.params(n(this,_)),h(this,a,await this.api.patch(t,e)),h(this,g,n(this,a).data.meta),I(this,R,E).call(this,n(this,a).data,M),n(this,a)}async destroy(){const t=n(this,c).urlResource()+"/"+n(this,c).getId();return console.log("api destroy resource",t),h(this,a,await this.api.delete(t)),h(this,g,n(this,a).data.meta),n(this,a)}},c=new WeakMap,_=new WeakMap,a=new WeakMap,g=new WeakMap,b=new WeakMap,w=new WeakMap,v=new WeakMap,R=new WeakSet,E=function(t,e){dt(n(this,c).storageName(),t.data,e),lt(I(this,P,V).call(this,t.included),e,this.getStorageNames(),n(this,w))},P=new WeakSet,V=function(t){for(const[e,r]of Object.entries(t))t[e]=I(this,S,G).call(this,r);return t},S=new WeakSet,G=function(t){for(const[e,r]of Object.entries(t))r.exists=!0,t[e]=r;return t},Y);class l{constructor(){o(this,"model",null);o(this,"params",{});this.params=this._getDefaultParams()}static make(t){const e=new this;return e.setModel(t),e}setModel(t){return this.model=t,this}setParams(t){return this.params={...this.params,...t},this}all(){const e=p().getAll(this._storageName());return this._handlerEntities(e)}find(t){const r=p().getById(this._storageName(),t);return r?this._handlerEntities([r])[0]:null}findIn(t){const r=p().getByIds(this._storageName(),t);return this._handlerEntities(r)}findLoaded(){const e=p().getByLoaded(this._storageName());return this._handlerEntities(e)}reset(){p().reset(this._storageName())}copyToStorage(t){const e=p(),r=e.getById(this._storageName(),this.model.id);e.updateById(t,this.model.id,r)}moveToStorage(t){this.copyToStorage(t),this._storeRemoveById(this.model.id)}update(){this._storeCommit()}create(){return this.model.getId()||this.model.setId(at()),this._storeCommit(),this.model.getId()}remove(){this._storeRemoveById(this.model.getId())}removeById(t){this._storeRemoveById(t)}_storeRemoveById(t){p().removeById(this._storageName(),t)}_storeCommit(){const t=p(),e=K(this.model.toObject());t.updateById(this._storageName(),this.model.getId(),e)}_getDefaultParams(){return{model:!0,copy:!0,deepCopy:!0,with:[]}}_isFieldRelation(t){return this.model.isFieldRelation(t)}_getRelation(t){return this.model.relations()[t]??null}_storageName(){const t=this.model.storageName();if(!t)throw new Error("Is not founded storage name");return t}_handlerEntities(t){if(!Array.isArray(t))throw Error("Is not correct ids");return t.length?(this._isCopy()&&(t=t.map(e=>this._copyObj(e))),this._isWithRelations()&&(t=t.map(e=>this._completeRelations(e))),this._isModel()&&(t=t.map(e=>this._completeModel(e))),t):[]}_completeRelations(t){if(!t)return null;for(let[e,r]of Object.entries(t))if(this._isFieldRelation(e)&&r){const u=Array.isArray(r)?this._getRelation(e).findIn(r,this.params):this._getRelation(e).find(r,this.params);t[e]=u}return t}_completeModel(t){return this.model.clone().fill(t)}_isWithRelations(){return this.params.hasOwnProperty("with")&&this.params.with.length>0}_isModel(){return this.params.hasOwnProperty("model")&&this.params.model===!0}_isCopy(){return this.params.hasOwnProperty("copy")&&this.params.copy===!0}_isDeepCopy(){return this.params.hasOwnProperty("deepCopy")&&this.params.deepCopy===!0}_copyObj(t){return t&&(this._isDeepCopy()?K(t):{...t})}}function ft(){return typeof window<"u"?window.console:global.console}const y=ft(),J="array",_t="object";var N,O;const U=class U{constructor(){o(this,"relationships",{});o(this,"_dependentRelationships",{});o(this,"exists",!1);o(this,"_baseUrl","/api/v1");o(this,"_resourceName",null);d(this,N,[]);o(this,"_storageName",null);o(this,"_includeName",null);o(this,"_primaryKey","id");d(this,O,null)}instance(){return new this.constructor}static make(){return new this}static query(){return new this().query()}static sync(t={}){return new this().sync(t)}static fill(t){return new this().fill(t)}static createLocal(){return new this().createLocal()}static all(t){return new this().all(t)}static find(t,e={}){return new this().find(t,e)}static findIn(t,e={}){return new this().findIn(t,e)}static findLoaded(t={}){return new this().findLoaded(t)}static reset(){new this().reset()}apiResource(){return n(this,O)}urlResource(){return this._baseUrl+"/"+this.resourceName()}resourceName(){return this._resourceName}includeName(){return this._includeName||this.resourceName().replace("-","_")}storageName(){return this._storageName||this.includeName()}relations(){return this._relations}primaryKey(){return this._primaryKey}getId(){return this[this._primaryKey]??null}setId(t){return this[this._primaryKey]=t,this}setResourceName(t){return this._resourceName=t,this}setIncludeName(t){return this._includeName=t,this}setStorageName(t){return this._storageName=t,this}fill(t){return this._creator(t),this}toObject(){return Object.getOwnPropertyNames(this).reduce((e,r)=>(this.isFieldAttribute(r)&&(e[r]=this[r]),e),{})}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}query(){return gt.make(this)}async sync(t={}){h(this,O,this.query());const e=await n(this,O).setParams(t).get();return y.log("sync response",e),h(this,N,e.data.data),e.data.data}all(t={}){return l.make(this).setParams(t).all()}find(t,e={}){return l.make(this).setParams(e).find(t)??this.instance()}findIn(t,e={}){return l.make(this).setParams(e).findIn(t)}findLoaded(t={}){return l.make(this).setParams(t).findLoaded()}reset(){l.make(this).reset()}createLocal(){const t=l.make(this).create();return this._updateDependentRelationships(t),t}updateLocal(){l.make(this).update()}destroyLocal(){l.make(this).remove()}copyToStorage(t){l.make(this).copyToStorage(t)}moveToStorage(t){l.make(this).moveToStorage(t)}save(t={}){return this.exists?this.update(t):this.create(t)}async create(t={}){const e=l.make(this),r=e.create();this._updateDependentRelationships(r);try{const i=await this.query().setParams(t).create();return this._updateDependentRelationships(i.data.data,r),y.log("model create response",i),e.removeById(r),i.data.data}catch(i){y.log("removeById",r),e.removeById(r),y.error("Error: "+i)}}async update(t={}){const e=l.make(this),r=e.find(this.getId());e.update();try{const i=await this.query().setParams(t).update();return y.log("model update response",i),i.data.data}catch(i){l.make(r).update(),y.error("Error: "+i)}return r.getId()}async destroy(){const t=l.make(this),e=t.find(this.getId());t.remove();try{const r=await this.query().destroy();return y.log("model update response",r),this.getId()}catch(r){l.make(e).update(),y.error("Error: "+r)}}isFieldAttribute(t){return this.isPublicField(t)}isPublicField(t){return!t.startsWith("_")&&!t.startsWith("#")}hasOne(t,e){return this.relationships.hasOwnProperty(t)?e.find(this.relationships[t])??null:null}hasMany(t,e){return this.relationships.hasOwnProperty(t)?e.findIn(this.relationships[t])??[]:[]}belongsTo(t,e,r=null,i=null,u=null){if(this.putRelation(t,e),C(r))return;const f=r.find(e);i=i||this.storageName(),this._dependentRelationships[t]={relationEntity:f,localRelationName:i,localStorageName:u}}hasRelation(t){return!!this.getRelation(t)}setRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships[t]=e}addRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships.hasOwnProperty(t)||(this.relationships[t]=[]),this.relationships[t].push(e)}getRelation(t){return this.relationships[t]??null}removeRelation(t){delete this.relationships[t],this._checkAndDeleteRelationshipsField()}removeRelationValue(t,e){const r=this.getRelation(t);if(C(r)||tt(r))return;const i=r.indexOf(e);delete this.relationships[t][i]}isFieldRelation(t){return(Array.isArray(this._relations)?J:_t)===J?this._relations.includes(t):this._relations.hasOwnProperty(t)}isFieldModel(t){return this[t]instanceof U}_convertModelToId(t){return t.getId()}_creator(t){t=t||{};for(let[e,r]of Object.entries(t))this[e]=r}_checkAndCreateRelationshipsField(){this.hasOwnProperty("relationships")||(this.relationships={})}_checkAndDeleteRelationshipsField(){Object.entries(this.relationships).length===0&&delete this.relationships}_updateDependentRelationships(t,e=null){const r=Object.entries(this._dependentRelationships);for(let[i,{relationEntity:u,localRelationName:f}]of r)C(e)?u.putRelation(f,t):e!==0?u.replaceRelation(f,t,e):u.deleteRelation(f,t),u.updateLocal()}deleteRelation(t,e=null){const r=this[t];if(B(r)){if(C(e))throw Error("Delete Relation: no value specified");this.removeRelationValue(t,e)}else this.removeRelation(t)}replaceRelation(t,e,r){const i=this[t];if(B(i)){const u=this.getRelation(t);this.setRelation(t,ot(u,r,e))}else this.setRelation(t,e)}putRelation(t,e){const r=this[t];B(r)?this.addRelation(t,e):this.setRelation(t,e)}};N=new WeakMap,O=new WeakMap;let m=U;class T extends m{constructor(){super(...arguments);o(this,"_resourceName","currencies")}get icon(){var e;return((e=et.find(r=>r.id===this.id))==null?void 0:e.icon)??null}}class It extends m{constructor(){super(...arguments);o(this,"_resourceName","account-sums")}getBalanceInMainCurrency(){const e=st(),r=this.currency.alphabetic_code.toLowerCase();if(r===e.currency.main)return this.balance;const i=e.currency.exchangeRates[r];return this.balance*i}get currency(){return this.hasOne("currency",T)}set currency(e){return this.belongsTo("currency",e)}get account(){this.hasOne("account",A)}set account(e){this.belongsTo("account",e,A,"sums")}}class A extends m{constructor(){super(...arguments);o(this,"_resourceName","accounts")}get sums(){return this.hasMany("sums",It)}set sums(e){this.belongsTo("sums",e)}get category(){return this.hasOne("category",W)}set category(e){this.belongsTo("category",e,W,"accounts")}get currency(){return this.hasOne("currency",T)}set currency(e){this.belongsTo("currency",e)}getIcon(){return this.icon??"mdi-help"}getSum(){return ut(this.sums,"balance")}getSumInMineCurrency(){return this.sums.reduce((e,r)=>parseInt(e,10)+parseInt(r.getBalanceInMainCurrency(),10),0)}}class W extends m{constructor(){super(...arguments);o(this,"_resourceName","account-categories")}get accounts(){return this.hasMany("accounts",A)}get icon(){var e;return((e=rt.find(r=>r.id===this.id))==null?void 0:e.icon)??null}getSum(){return this.accounts.reduce((e,r)=>r.getSum()+e,0)}getSumInMineCurrency(){return this.accounts.reduce((e,r)=>r.getSumInMineCurrency()+e,0)}static async loadMainPage(){return await this.query().get("/main-page")}static async loadTransactionPage(){return await this.query().get("/transaction-page")}async loadMainPage(){return await this.query().get("/main-page")}}class k extends m{constructor(){super(...arguments);o(this,"_resourceName","transaction-categories")}getIcon(){return this.icon??"mdi-help"}get children(){return this.hasMany("children",k)}get transactions(){return this.hasMany("transactions",Ot)}get parent(){return this.hasOne("parent",k)}set parent(e){return this.belongsTo("parent",e)}set type(e){this.belongsTo("type",e)}childrenCount(){return this.children.length}isChildren(){return this.childrenCount()>0}}class Rt extends m{constructor(){super(...arguments);o(this,"_resourceName","transaction-types")}}class Ot extends m{constructor(){super(...arguments);o(this,"_resourceName","transactions")}get account(){return this.hasOne("account",A)}get currency(){return this.hasOne("currency",T)}get to_currency(){return this.hasOne("to_currency",T)}get to_account(){return this.hasOne("to_account",A)}get type(){return this.hasOne("type",Rt)}get category(){return this.hasOne("category",k)}set currency(e){this.belongsTo("currency",e)}set to_currency(e){this.belongsTo("to_currency",e)}set type(e){this.belongsTo("type",e)}set account(e){this.belongsTo("account",e)}set to_account(e){this.belongsTo("to_account",e)}set category(e){this.belongsTo("category",e)}}export{A,T as C,Ot as T,W as a,It as b,ct as c,vt as d,k as e,wt as t,p as u};
