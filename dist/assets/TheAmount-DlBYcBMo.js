import{m as U,r as t,o as l,d as T,w as n,j as e,f as F,c as v,t as E,b as s,F as O,x as L,V as me,p as le,_ as q,i as b,y as X,n as se,W as fe,a as w,e as Y,X as ye,Y as ce,Z as xe,$ as ge,a0 as Ce,K as Te,U as ie,T as B,C as ke,z as Q,a1 as ue,h as Se,a2 as ee,R as Ve}from"./index-CECwDoZT.js";import{t as he,i as Ie,c as j,a as A,d as $e,S as be,e as we,f as Ae,s as De,b as Ee,g as Ue,h as Ne}from"./form.store-Cgi7iU6w.js";import{f as Z,g as te,A as ne,a as J,C as oe}from"./entities-a6JjP9x7.js";import{a as re,_ as de}from"./CurrenciesList-CLAsWoEH.js";import{u as _e}from"./currency_decimal_convert-KKbzYINo.js";function Pe(x,o){const a=he(x);if(!Ie(a))throw new RangeError("Invalid time value");let i="";const c="-",_=":";{const r=j(a.getDate(),2),u=j(a.getMonth()+1,2);i=`${j(a.getFullYear(),4)}${c}${u}${c}${r}`}{const r=j(a.getHours(),2),u=j(a.getMinutes(),2),y=j(a.getSeconds(),2);i=`${i}${i===""?"":" "}${r}${_}${u}${_}${y}`}return i}const Me={key:"0",class:"text-grey"},Oe={key:"1"},Re={__name:"TheTypeStep",setup(x){const o=A(),a=U({get:()=>o.typeId,set:c=>o.typeId=c});async function i(){o.categoryId=null,o.accountTransferId=null,await le(),o.nextStep()}return(c,_)=>{const r=t("v-col"),u=t("v-fade-transition"),y=t("v-row"),p=t("v-expansion-panel-title"),h=t("v-chip"),d=t("v-chip-group"),k=t("v-expansion-panel-text"),m=t("v-expansion-panel");return l(),T(m,{value:s($e)},{default:n(()=>[e(p,{"hide-actions":""},{default:n(({expanded:f})=>[e(y,{"no-gutters":""},{default:n(()=>[e(r,{class:"d-flex justify-start",cols:"4"},{default:n(()=>_[1]||(_[1]=[F("Тип:")])),_:1}),e(r,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(u,{"leave-absolute":""},{default:n(()=>[f?(l(),v("span",Me,"Вкажіть тип транзакції")):(l(),v("span",Oe,E(s(o).getType.name),1))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(k,null,{default:n(()=>[e(d,{mandatory:"",modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=f=>a.value=f)},{default:n(()=>[(l(!0),v(O,null,L(s(me),f=>(l(),T(h,{key:f.id,label:"",variant:"text",text:f.name,value:f.id,onClick:i},null,8,["text","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["value"])}}},Ye={key:0},je={key:1},Le={key:0,class:"text-truncate"},Be={key:1,class:"text-grey"},Fe={class:"ml-1"},ze={key:1},Ge={key:2},Xe={class:"s-parent-wrapper"},Ze={__name:"TheCategoryStep",setup(x){const o=A(),a=b(!1),i=b(!1),c=b(),_=b(),r=b(new Z),u=U(()=>o.typeId),y=U(()=>Z.findLoaded().filter(S=>!!S.user_id));X(p),se(u,p);async function p(){m(),i.value=!0;try{await le(),await Z.loadCategoryStep(o.typeId)}finally{i.value=!1}}function h(S){if(S.isChildren()){a.value=!0,r.value=S;return}f(S.id),D()}function d(S){f(S.id),D()}function k(){a.value=!1}function m(){fe(o.transactionId)&&f(),c.value=!1,_.value=!1,r.value=new Z,a.value=!1}function f(S=null){o.categoryId=S}function D(){o.nextStep()}return(S,g)=>{const $=t("v-fade-transition"),P=t("v-col"),M=t("v-icon"),I=t("v-row"),V=t("v-expansion-panel-title"),z=t("v-progress-linear"),H=t("v-badge"),R=t("v-chip"),G=t("v-chip-group"),K=t("v-btn"),W=t("v-expansion-panel-text"),N=t("v-expansion-panel");return l(),T(N,{value:s(be)},{default:n(()=>[e(V,null,{default:n(({expanded:C})=>[e(I,{"no-gutters":""},{default:n(()=>[e(P,{cols:"4"},{default:n(()=>[e($,{"leave-absolute":""},{default:n(()=>[s(o).typeId===1?(l(),v("span",Ye,"На категорію:")):(l(),v("span",je,"З категорії:"))]),_:1})]),_:1}),e(P,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e($,{"leave-absolute":""},{default:n(()=>[s(o).getCategory.id?(l(),v("div",Le,[e(M,{icon:s(o).getCategory.icon},null,8,["icon"]),F(" "+E(s(o).getCategory.name),1)])):(l(),v("div",Be,"Вкажіть категорію"))]),_:1})]),_:1})]),_:1})]),actions:n(()=>[w("div",Fe,[s(o).isCategoryValid?Y("",!0):(l(),T(M,{key:0,color:"error",icon:"mdi-alert-circle"}))])]),_:1}),e(W,{class:"s-panel-text"},{default:n(()=>[e($,{mode:"out-in"},{default:n(()=>[i.value?(l(),T(z,{key:0,indeterminate:""})):!a.value&&!i.value?(l(),v("div",ze,[e(G,{mandatory:"",column:"",modelValue:c.value,"onUpdate:modelValue":g[0]||(g[0]=C=>c.value=C)},{default:n(()=>[(l(!0),v(O,null,L(y.value,C=>(l(),T(R,{key:C.id,label:"",variant:"text","prepend-icon":C.icon,text:C.name,value:C.id,onClick:ve=>h(C)},ye({_:2},[C.isChildren()?{name:"append",fn:n(()=>[e(H,{content:C.childrenCount(),inline:"",color:"transparent"},null,8,["content"])]),key:"0"}:void 0]),1032,["prepend-icon","text","value","onClick"]))),128))]),_:1},8,["modelValue"])])):(l(),v("div",Ge,[w("div",Xe,[w("div",null,[g[4]||(g[4]=w("div",{class:"text-grey text-subtitle-2"},"Батьківська категорія",-1)),e(G,{mandatory:"",column:"",modelValue:_.value,"onUpdate:modelValue":g[2]||(g[2]=C=>_.value=C)},{default:n(()=>[e(R,{label:"",variant:"text",text:r.value.name,value:r.value.id,onClick:g[1]||(g[1]=C=>d(r.value))},null,8,["text","value"])]),_:1},8,["modelValue"])]),e(K,{icon:"mdi-arrow-up-left",variant:"text",onClick:ce(k,["stop"])})]),g[5]||(g[5]=w("div",{class:"text-grey text-subtitle-2"},"Підкатегорії",-1)),e(G,{mandatory:"",column:"",modelValue:_.value,"onUpdate:modelValue":g[3]||(g[3]=C=>_.value=C)},{default:n(()=>[(l(!0),v(O,null,L(r.value.children,C=>(l(),T(R,{key:C.id,label:"",variant:"text",text:C.name,value:C.id,onClick:ve=>d(C)},null,8,["text","value","onClick"]))),128))]),_:1},8,["modelValue"])]))]),_:1})]),_:1})]),_:1},8,["value"])}}},qe=q(Ze,[["__scopeId","data-v-723ab1c6"]]),He={key:0,class:"text-grey"},Ke={key:1,class:"text-truncate"},We={key:2},Je={__name:"TheTagStep",emits:["done"],setup(x,{emit:o}){const a=A(),i=b(!1),c=U(()=>te.findLoaded()),_=U(()=>a.getTags.map(y=>y.name).join(", "));X(r);async function r(){await u()}async function u(){i.value=!0;try{await te.sync({"filter[user_id]":"auth"})}finally{i.value=!1}}return(y,p)=>{const h=t("v-col"),d=t("v-fade-transition"),k=t("v-row"),m=t("v-expansion-panel-title"),f=t("v-chip"),D=t("v-chip-group"),S=t("v-expansion-panel-text"),g=t("v-expansion-panel");return l(),T(g,{value:s(we)},{default:n(()=>[e(m,{"hide-actions":""},{default:n(()=>[e(k,{"no-gutters":""},{default:n(()=>[e(h,{class:"d-flex justify-start",cols:"4"},{default:n(()=>p[1]||(p[1]=[F("Теги:")])),_:1}),e(h,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(d,{"leave-absolute":""},{default:n(()=>[s(a).getTags.length===0?(l(),v("div",He,"Вкажіть теги")):s(a).getTags.length<=3?(l(),v("div",Ke,E(_.value),1)):(l(),v("div",We,"вибрано "+E(s(a).getTags.length)+" тегів",1))]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{class:"s-panel-text"},{default:n(()=>[e(D,{multiple:"",column:"",modelValue:s(a).tagIds,"onUpdate:modelValue":p[0]||(p[0]=$=>s(a).tagIds=$)},{default:n(()=>[(l(!0),v(O,null,L(c.value,$=>(l(),T(f,{key:$.id,label:"",variant:"text",text:$.name,value:$.id},null,8,["text","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["value"])}}},Qe=q(Je,[["__scopeId","data-v-01b37451"]]),et={__name:"TheDateStep",emits:["done"],setup(x,{emit:o}){const a=A(),i=b(),c=b(!1),_=b(a.date),r=b();xe(()=>{i.value=a.getDate,a.getDate==="today"?r.value="Сьогодні":a.getDate==="yesterday"?r.value="Вчора":a.getDate==="tomorrow"?r.value="Завтра":(i.value="custom",r.value=a.getDate)});function u(){a.date=De(new Date,1),d()}function y(){a.date=new Date,d()}function p(){c.value=!0}function h(){a.date=_.value,c.value=!1,d()}function d(){a.nextStep()}return(k,m)=>{const f=t("v-col"),D=t("v-fade-transition"),S=t("v-row"),g=t("v-expansion-panel-title"),$=t("v-date-picker"),P=t("v-divider"),M=t("v-spacer"),I=t("v-btn"),V=t("v-card-actions"),z=t("v-card"),H=t("v-dialog"),R=t("v-chip"),G=t("v-chip-group"),K=t("v-expansion-panel-text"),W=t("v-expansion-panel");return l(),T(W,{value:s(Ae)},{default:n(()=>[e(g,{"hide-actions":""},{default:n(({expanded:N})=>[e(S,{"no-gutters":""},{default:n(()=>[e(f,{class:"d-flex justify-start",cols:"4"},{default:n(()=>m[4]||(m[4]=[F("Дата:")])),_:1}),e(f,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(D,{"leave-absolute":""},{default:n(()=>[w("span",null,E(r.value),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(K,null,{default:n(()=>[e(H,{modelValue:c.value,"onUpdate:modelValue":m[2]||(m[2]=N=>c.value=N),"max-width":"600"},{default:n(()=>[e(z,null,{default:n(()=>[e($,{modelValue:_.value,"onUpdate:modelValue":m[0]||(m[0]=N=>_.value=N),width:"100%",color:"primary"},null,8,["modelValue"]),e(P),e(V,null,{default:n(()=>[e(M),e(I,{text:"Відміна",variant:"plain",onClick:m[1]||(m[1]=N=>c.value=!1)}),e(I,{color:"primary",text:"Вибрати",variant:"tonal",onClick:h})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(G,{mandatory:"",modelValue:i.value,"onUpdate:modelValue":m[3]||(m[3]=N=>i.value=N)},{default:n(()=>[e(R,{label:"",variant:"text",text:"Вчора",value:"yesterday",onClick:u}),e(R,{label:"",variant:"text",text:"Сьогодні",value:"today",onClick:y}),e(R,{label:"",variant:"text",text:"Вибрати",value:"custom",onClick:p})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["value"])}}},tt={key:0},nt={key:1},ot={key:0,class:"text-truncate"},at={key:1,class:"text-grey"},lt={class:"ml-1"},st={key:0},ct={key:1},it={class:"s-back-button-wrapper"},ut={__name:"TheAccountStep",props:ge({account:{type:Object,default:new ne,validator:x=>x instanceof ne},isValid:{type:Boolean,required:!0},isTransfer:{type:Boolean,default:!1},stepName:{type:String,default:Ee}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(x){const o=x,a=A(),i=Ce(x,"modelValue");U(()=>a.typeId),Te(()=>{o.isTransfer&&(i.value=null)});const c=b(!1),_=U(()=>J.findLoaded()),r=b(null),u=b(new J);function y(h){u.value=h,c.value=!0}function p(){c.value=!1}return(h,d)=>{const k=t("v-fade-transition"),m=t("v-col"),f=t("v-icon"),D=t("v-row"),S=t("v-expansion-panel-title"),g=t("v-chip"),$=t("v-chip-group"),P=t("v-btn"),M=t("v-expansion-panel-text"),I=t("v-expansion-panel");return l(),T(I,{value:x.stepName},{default:n(()=>[e(S,{"disable-icon-rotate":""},{default:n(({expanded:V})=>[e(D,{"no-gutters":""},{default:n(()=>[e(m,{cols:"4"},{default:n(()=>[e(k,{"leave-absolute":""},{default:n(()=>[s(a).typeId===s(ie)||x.isTransfer?(l(),v("span",tt,"На рахунок:")):(l(),v("span",nt,"З рахунку:"))]),_:1})]),_:1}),e(m,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(k,{"leave-absolute":""},{default:n(()=>[x.account.id?(l(),v("div",ot,[e(f,{icon:x.account.icon},null,8,["icon"]),F(" "+E(x.account.name),1)])):(l(),v("div",at,"Вкажіть рахунок"))]),_:1})]),_:1})]),_:1})]),actions:n(()=>[w("div",lt,[x.isValid?Y("",!0):(l(),T(f,{key:0,color:"error",icon:"mdi-alert-circle"}))])]),_:1}),e(M,{class:"s-panel-text"},{default:n(()=>[e(k,{mode:"out-in"},{default:n(()=>[c.value?(l(),v("div",ct,[w("div",it,[e(P,{size:"small",text:"Назад",onClick:ce(p,["stop"])})]),e($,{mandatory:"",column:"",modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=V=>i.value=V)},{default:n(()=>[(l(!0),v(O,null,L(u.value.accounts,V=>(l(),T(g,{key:V.id,label:"",variant:"text","prepend-icon":V.icon,text:V.name,value:V.id,onClick:d[1]||(d[1]=z=>s(a).nextStep())},null,8,["prepend-icon","text","value"]))),128))]),_:1},8,["modelValue"])])):(l(),v("div",st,[e($,{mandatory:"",column:"",modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=V=>r.value=V)},{default:n(()=>[(l(!0),v(O,null,L(_.value,V=>(l(),T(g,{key:V.id,label:"","prepend-icon":V.icon,variant:"text",text:V.name,value:V.id,onClick:z=>y(V)},null,8,["prepend-icon","text","value","onClick"]))),128))]),_:1},8,["modelValue"])]))]),_:1})]),_:1})]),_:1},8,["value"])}}},ae=q(ut,[["__scopeId","data-v-8e72374d"]]),rt={__name:"TheAccountsStepsChoice",setup(x){const o=A();return X(async()=>{await J.loadTransactionPage()}),(a,i)=>(l(),v(O,null,[e(ae,{modelValue:s(o).accountId,"onUpdate:modelValue":i[0]||(i[0]=c=>s(o).accountId=c),account:s(o).getAccount,"is-valid":s(o).isAccountValid},null,8,["modelValue","account","is-valid"]),s(o).typeId===s(B)?(l(),T(ae,{key:0,modelValue:s(o).toAccountId,"onUpdate:modelValue":i[1]||(i[1]=c=>s(o).toAccountId=c),account:s(o).getToAccount,"is-valid":s(o).isToAccountValid,"is-transfer":!0,"step-name":s(Ue)},null,8,["modelValue","account","is-valid","step-name"])):Y("",!0)],64))}},pe=ke("currencies",{state:()=>({loading:!1}),getters:{currencies:()=>oe.findLoaded()},actions:{async loadCurrencies(){if(this.currencies.length!==3){this.loading=!0;try{await oe.sync()}finally{this.loading=!1}}}}}),dt={key:"0",class:"text-grey"},_t={key:"1"},pt={class:"d-flex justify-end align-center pa-2"},vt={class:"text-h5"},mt={__name:"TheToAmount",setup(x){const{toDecimal:o,toPlus:a,toInteger:i}=_e(),c=A(),_=pe(),r=b(!1),u=U(()=>o(c.toAmount));X(()=>{y(),p()});function y(){Q(c.toAmount)&&(c.toAmount=a(c.amount))}function p(){Q(c.toCurrencyId)&&(c.toCurrencyId=c.currencyId)}return(h,d)=>{const k=t("v-col"),m=t("v-fade-transition"),f=t("v-row"),D=t("v-expansion-panel-title"),S=t("v-icon"),g=t("v-btn"),$=t("v-menu"),P=t("v-expansion-panel-text"),M=t("v-expansion-panel");return l(),T(M,{value:s(Ne)},{default:n(()=>[e(D,{"hide-actions":""},{default:n(({expanded:I})=>[e(f,{"no-gutters":""},{default:n(()=>[e(k,{class:"d-flex justify-start",cols:"4"},{default:n(()=>d[4]||(d[4]=[F("Переказати:")])),_:1}),e(k,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(m,{"leave-absolute":""},{default:n(()=>[I?(l(),v("span",dt,"Вкажіть суму зарахування")):(l(),v("span",_t,E(u.value)+" "+E(s(c).getToCurrency.symbol),1))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(P,null,{default:n(()=>[w("div",pt,[w("div",{class:"text-right d-flex align-center",onClick:d[0]||(d[0]=I=>r.value=!0)},[w("span",vt,E(u.value),1),s(c).isAmountValid?Y("",!0):(l(),T(S,{key:0,color:"error",icon:"mdi-alert-circle"}))]),e($,null,{activator:n(({props:I})=>[e(g,ue({variant:"flat",class:"s-btn"},I,{"append-icon":"mdi-chevron-down"}),{default:n(()=>[e(S,{icon:s(c).getToCurrency.icon},null,8,["icon"])]),_:2},1040)]),default:n(()=>[e(re,{currencies:s(_).currencies,onSelected:d[1]||(d[1]=I=>s(c).toCurrencyId=I.id)},null,8,["currencies"])]),_:1})]),e(de,{modelValue:r.value,"onUpdate:modelValue":d[2]||(d[2]=I=>r.value=I),"start-sum":u.value,onDone:d[3]||(d[3]=I=>s(c).toAmount=s(i)(I))},null,8,["modelValue","start-sum"])]),_:1})]),_:1},8,["value"])}}},ht={__name:"TheTransactionSteps",setup(x){const o=A();return(a,i)=>{const c=t("v-expansion-panels");return l(),v("div",null,[e(c,{modelValue:s(o).openStep,"onUpdate:modelValue":i[0]||(i[0]=_=>s(o).openStep=_),variant:"accordion",elevation:"0"},{default:n(()=>[e(Re),e(rt),s(o).typeId!==s(B)?(l(),T(qe,{key:0})):Y("",!0),s(o).typeId===s(B)?(l(),T(mt,{key:1})):Y("",!0),e(Qe),e(et)]),_:1},8,["modelValue"])])}}},It={__name:"TheSaveButton",setup(x){const o=A(),a=Se(),i=b(!1);async function c(){if(o.isEnabledValidate=!0,!!o.isValid){i.value=!0;try{await _(),await a.push({name:"transactions.index"})}finally{i.value=!1}}}async function _(){const r=Pe(o.date),u=o.getTransaction;u.category=o.typeId===B?ee:o.categoryId,u.currency=o.currencyId,u.type=o.typeId,u.account=o.accountId,u.setRelation("tags",o.tagIds),u.amount=o.amount,u.note=null,u.transaction_at=r;const y=await u.save();if(o.typeId===B){const p=o.getTransferTransaction;p.type=o.typeId,p.category=ee,p.account=o.toAccountId,p.currency=o.toCurrencyId,p.transfer_transaction=y,p.amount=o.toAmount,p.setRelation("tags",o.tagIds),p.note=null,p.transaction_at=r,await p.save()}}return(r,u)=>{const y=t("v-btn");return l(),v("div",null,[e(y,{loading:i.value,color:"primary",rounded:"t-0 b-xl",size:"x-large",text:"Continue",variant:"flat",block:"",onClick:c},null,8,["loading"])])}}},ft={class:"d-flex justify-end align-center pa-2"},yt={class:"text-h3"},xt={__name:"TheCreateAmount",props:{amount:{type:[String,Number],default:"0"}},emits:["onClickOnAmount"],setup(x,{emit:o}){const a=o,i=A(),c=pe();X(_);async function _(){await c.loadCurrencies()}return(r,u)=>{const y=t("v-icon"),p=t("v-btn"),h=t("v-menu");return l(),v("div",ft,[w("div",{class:"text-right mr-4 d-flex align-center",onClick:u[0]||(u[0]=d=>a("onClickOnAmount"))},[w("span",yt,E(x.amount),1),s(i).isAmountValid?Y("",!0):(l(),T(y,{key:0,color:"error",icon:"mdi-alert-circle"}))]),e(h,null,{activator:n(({props:d})=>[e(p,ue({variant:"outlined",class:"s-btn"},d,{"append-icon":"mdi-chevron-down",loading:s(c).loading}),{default:n(()=>[e(y,{icon:s(i).getCurrency.icon},null,8,["icon"])]),_:2},1040,["loading"])]),default:n(()=>[e(re,{currencies:s(c).currencies,onSelected:u[1]||(u[1]=d=>s(i).currencyId=d.id)},null,8,["currencies"])]),_:1})])}}},gt=q(xt,[["__scopeId","data-v-2875c90d"]]),$t={__name:"TheAmount",props:{isCalcShow:{type:Boolean,default:!1}},setup(x){const o=x,a=A(),{toInteger:i,toMinus:c,toPlus:_,toDecimal:r}=_e(),u=b(o.isCalcShow),y=U(()=>_(r(a.amount))),p=U(()=>a.typeId);se(p,()=>{a.amount=h(a.amount)});const h=k=>{switch(a.typeId){case Ve:case B:return c(k);case ie:return _(k)}},d=k=>{a.amount=h(i(k))};return(k,m)=>(l(),v(O,null,[e(gt,{amount:y.value,onOnClickOnAmount:m[0]||(m[0]=f=>u.value=!0)},null,8,["amount"]),e(de,{modelValue:u.value,"onUpdate:modelValue":m[1]||(m[1]=f=>u.value=f),"start-sum":y.value,onDone:m[2]||(m[2]=f=>d(f))},null,8,["modelValue","start-sum"])],64))}};export{$t as _,ht as a,It as b};
