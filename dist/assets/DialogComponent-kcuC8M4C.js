var Ae=Object.defineProperty;var Ie=(s,e,t)=>e in s?Ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>(Ie(s,typeof e!="symbol"?e+"":e,t),t),Y=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var i=(s,e,t)=>(Y(s,e,"read from private field"),t?t.call(s):e.get(s)),p=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},l=(s,e,t,n)=>(Y(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t);var k=(s,e,t)=>(Y(s,e,"access private method"),t);import{y as se,M as Re,C as Q,D as me,E as be,G as we,S as Se,_ as Oe,m as U,r as y,o as g,c as M,a as z,t as B,k as A,w as v,e as pe,H as Ce,I as ke,f as X,F as ee,q as fe,d as $,j as Ee,s as Ne,J as Me,B as Pe,K as xe,b as Te}from"./index-Bj5fpcLM.js";function ce(s){return JSON.parse(JSON.stringify(s))}function Be(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function De(s,e,t){return s.map(n=>n===e?t:n)}function mt(s,e={}){return Le(s,"UAH",e)}function Le(s,e="UAH",t={},n="uk-UA"){if(typeof s!="number")return s;const r={style:"currency",currency:e,currencyDisplay:"narrowSymbol"};return new Intl.NumberFormat(n,{...r,...t}).format(s)}function Fe(s,e){return Object.assign(s,e)}function je(s){return Array.isArray(s)?s.length===0:Object.keys(s).length===0}function Ve(s,e){return s.reduce((t,n)=>parseInt(t,10)+parseInt(n[e],10),0)}const _=se("models",{state:()=>({models:{},activeIds:{}}),getters:{getAll:s=>(e,t=!1)=>Ue(s,e,t),getById:s=>(e,t)=>ye(s,e,t),getByIds:s=>(e,t)=>ue(s,e,t),getByLoaded:s=>e=>ue(s,e,qe(s,e))},actions:{setActiveIds(s,e){Z(this,s),this.activeIds[s]=e},addActiveId(s,e){Z(this,s),this.activeIds[s].push(e)},removeLoadedId(s,e){Z(this,s);const t=this.activeIds.indexOf(e);delete this.activeIds[t]},setCollection(s,e){typeof this.models[s]>"u"&&(this.models[s]={}),this.models[s]=e},updateById(s,e,t){typeof this.models[s]>"u"&&(console.info(`create state model [${s}]`),this.models[s]={});const n={...this.models[s][e],...t},r={...this.models[s],[e]:n},o={...this.models,[s]:r};this.models=o},removeById(s,e){if(typeof this.models[s]>"u"){console.warn(`Not found state model [${s}]`);return}delete this.models[s][e]},reset(){this.models={}}}});function Z(s,e){typeof s.activeIds[e]>"u"&&(s.activeIds[e]=[])}function qe(s,e){return s.activeIds[e]??[]}function Ue(s,e,t=!1){const n=s.models[e];return t?n??{}:n?Object.values(n):[]}function ue(s,e,t){return t.map(n=>ye(s,e,n)).filter(n=>n)}function ye(s,e,t){let n=s.models[e]??null;return n?n[t]:null}function $e(s,e,t={},n={}){for(let[r,o]of Object.entries(s)){let u=n.hasOwnProperty(r)?n[r]:e;t.hasOwnProperty(r)&&(r=t[r]),Ge(u,r,o)}}function Ke(s,e){if(je(e))return;_().setActiveIds(s,e)}function Ge(s,e,t){switch(s){case me:ne(e,t);break;case Q:He(e,t);break;case Re:Je(e,t);break}}function ne(s,e){_().setCollection(s,e)}function He(s,e){te(s),ne(s,Object.assign({},{...te(s),...e}))}function Je(s,e){console.log("fillModels update Field");const t={...te(s)};for(const n in e){const r={...t[n]};t[n]=Object.assign(r,e[n])}ne(s,t)}function te(s){return _().getAll(s,!0)}var c,O,a,b,L,F,j,E,q,G,_e,H,ge,he;let We=(he=class{constructor(){p(this,E);p(this,G);p(this,H);p(this,c,null);p(this,O,{});p(this,a,{});p(this,b,{});p(this,L,me);p(this,F,{});p(this,j,{});this.api=new be}static make(e){const t=new this;return t.setModel(e),t}getResponse(){return i(this,a)}getMeta(){return i(this,b)}getResourceUrl(e=null){return e?i(this,c).urlResource()+e:i(this,c).urlResource()}getStorageNames(){let e={};return i(this,c)&&(e[i(this,c).includeName()]=i(this,c).storageName()),{...e,...i(this,j)}}setModel(e){return l(this,c,e),this}setUpdateMode(e){return l(this,L,e),this}setParams(e){return l(this,O,e),this}setUpdateModes(e){return l(this,F,e),this}setStorageNames(e){return l(this,j,e),this}async get(e=null){var t;return this.api.params(i(this,O)),l(this,a,await this.api.query(this.getResourceUrl(e))),l(this,b,(t=i(this,a).data)==null?void 0:t.meta),k(this,E,q).call(this,i(this,a).data,i(this,L)),i(this,a)}async create(){var n;const e=i(this,c).urlResource(),t=i(this,c).toObject();return console.log("api create resource",e,t),this.api.params(i(this,O)),l(this,a,await this.api.post(e,t)),l(this,b,(n=i(this,a).data)==null?void 0:n.meta),k(this,E,q).call(this,i(this,a).data,Q),i(this,a)}async update(){const e=i(this,c).urlResource()+"/"+i(this,c).getId(),t=i(this,c).toObject();return console.log("api update resource",e,t),this.api.params(i(this,O)),l(this,a,await this.api.patch(e,t)),l(this,b,i(this,a).data.meta),k(this,E,q).call(this,i(this,a).data,Q),i(this,a)}async destroy(){const e=i(this,c).urlResource()+"/"+i(this,c).getId();return console.log("api destroy resource",e),l(this,a,await this.api.delete(e)),l(this,b,i(this,a).data.meta),i(this,a)}},c=new WeakMap,O=new WeakMap,a=new WeakMap,b=new WeakMap,L=new WeakMap,F=new WeakMap,j=new WeakMap,E=new WeakSet,q=function(e,t){Ke(i(this,c).storageName(),e.data),$e(k(this,G,_e).call(this,e.included),t,this.getStorageNames(),i(this,F))},G=new WeakSet,_e=function(e){for(const[t,n]of Object.entries(e))e[t]=k(this,H,ge).call(this,n);return e},H=new WeakSet,ge=function(e){for(const[t,n]of Object.entries(e))n.exists=!0,e[t]=n;return e},he);class m{constructor(){d(this,"model",null);d(this,"params",{});this.params=this._getDefaultParams()}static make(e){const t=new this;return t.setModel(e),t}setModel(e){return this.model=e,this}setParams(e){return this.params={...this.params,...e},this}all(){const t=_().getAll(this._storageName());return this._handlerEntities(t)}find(e){const n=_().getById(this._storageName(),e);return n?this._handlerEntities([n])[0]:null}findIn(e){const n=_().getByIds(this._storageName(),e);return this._handlerEntities(n)}findLoaded(){const t=_().getByLoaded(this._storageName());return this._handlerEntities(t)}copyToStorage(e){const t=_(),n=t.getById(this._storageName(),this.model.id);t.updateById(e,this.model.id,n)}moveToStorage(e){this.copyToStorage(e),this._storeRemoveById(this.model.id)}update(){this._storeCommit()}create(){return this.model.getId()||this.model.setId(Be()),this._storeCommit(),this.model.getId()}remove(){this._storeRemoveById(this.model.getId())}removeById(e){this._storeRemoveById(e)}_storeRemoveById(e){_().removeById(this._storageName(),e)}_storeCommit(){const e=_(),t=ce(this.model.toObject());e.updateById(this._storageName(),this.model.getId(),t)}_getDefaultParams(){return{model:!0,copy:!0,deepCopy:!0,with:[]}}_isFieldRelation(e){return this.model.isFieldRelation(e)}_getRelation(e){return this.model.relations()[e]??null}_storageName(){const e=this.model.storageName();if(!e)throw new Error("Is not founded storage name");return e}_handlerEntities(e){if(!Array.isArray(e))throw Error("Is not correct ids");return e.length?(this._isCopy()&&(e=e.map(t=>this._copyObj(t))),this._isWithRelations()&&(e=e.map(t=>this._completeRelations(t))),this._isModel()&&(e=e.map(t=>this._completeModel(t))),e):[]}_completeRelations(e){if(!e)return null;for(let[t,n]of Object.entries(e))if(this._isFieldRelation(t)&&n){const o=Array.isArray(n)?this._getRelation(t).findIn(n,this.params):this._getRelation(t).find(n,this.params);e[t]=o}return e}_completeModel(e){return this.model.clone().fill(e)}_isWithRelations(){return this.params.hasOwnProperty("with")&&this.params.with.length>0}_isModel(){return this.params.hasOwnProperty("model")&&this.params.model===!0}_isCopy(){return this.params.hasOwnProperty("copy")&&this.params.copy===!0}_isDeepCopy(){return this.params.hasOwnProperty("deepCopy")&&this.params.deepCopy===!0}_copyObj(e){return e&&(this._isDeepCopy()?ce(e):{...e})}}function Ye(){return typeof window<"u"?window.console:global.console}const R=Ye();function ze(s,e=!1){let t=[0,"0",!1,"false","",[],{},NaN,"NaN",null,"null",void 0,"undefined"],n;return e?(n=t.reduce(function(r,o){return r+(o===s?1:0)}),n>0):(n=t.indexOf(s),n>-1)}function D(s){return Array.isArray(s)}function Xe(s){return!D(s)}function V(s){return s===null}function Ze(s){return!isNaN(Number(s))}function Qe(s){return ze(s)}function ve(s){return!Qe(s)}function ft(s){return D(s)&&s.length===0}const le="array",et="object";var J,N;const ie=class ie{constructor(){d(this,"relationships",{});d(this,"_dependentRelationships",{});d(this,"exists",!1);d(this,"_baseUrl","/api/v1");d(this,"_resourceName",null);p(this,J,[]);d(this,"_storageName",null);d(this,"_includeName",null);d(this,"_primaryKey","id");p(this,N,null)}instance(){return new this.constructor}static make(){return new this}static query(){return new this().query()}static sync(e={}){return new this().sync(e)}static fill(e){return new this().fill(e)}static createLocal(){return new this().createLocal()}static all(e){return new this().all(e)}static find(e,t={}){return new this().find(e,t)}static findIn(e,t={}){return new this().findIn(e,t)}static findLoaded(e={}){return new this().findLoaded(e)}apiResource(){return i(this,N)}urlResource(){return this._baseUrl+"/"+this.resourceName()}resourceName(){return this._resourceName}includeName(){return this._includeName||this.resourceName().replace("-","_")}storageName(){return this._storageName||this.includeName()}relations(){return this._relations}primaryKey(){return this._primaryKey}getId(){return this[this._primaryKey]??null}setId(e){return this[this._primaryKey]=e,this}setResourceName(e){return this._resourceName=e,this}setIncludeName(e){return this._includeName=e,this}setStorageName(e){return this._storageName=e,this}fill(e){return this._creator(e),this}toObject(){return Object.getOwnPropertyNames(this).reduce((t,n)=>(this.isFieldAttribute(n)&&(t[n]=this[n]),t),{})}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}query(){return We.make(this)}async sync(e={}){l(this,N,this.query());const t=await i(this,N).setParams(e).get();return R.log("sync response",t),l(this,J,t.data.data),t.data.data}all(e={}){return m.make(this).setParams(e).all()}find(e,t={}){return m.make(this).setParams(t).find(e)}findIn(e,t={}){return m.make(this).setParams(t).findIn(e)}findLoaded(e={}){return m.make(this).setParams(e).findLoaded()}createLocal(){const e=m.make(this).create();return this._updateDependentRelationships(e),e}updateLocal(){m.make(this).update()}destroyLocal(){m.make(this).remove()}copyToStorage(e){m.make(this).copyToStorage(e)}moveToStorage(e){m.make(this).moveToStorage(e)}save(e={}){return this.exists?this.update(e):this.create(e)}async create(e={}){const t=m.make(this),n=t.create();this._updateDependentRelationships(n);try{const r=await this.query().setParams(e).create();return this._updateDependentRelationships(r.data.data,n),R.log("model create response",r),t.removeById(n),r.data.data}catch(r){R.log("removeById",n),t.removeById(n),R.error("Error: "+r)}}async update(e={}){const t=m.make(this),n=t.find(this.getId());t.update();try{const r=await this.query().setParams(e).update();return R.log("model update response",r),r.data.data}catch(r){m.make(n).update(),R.error("Error: "+r)}return n.getId()}async destroy(){const e=m.make(this),t=e.find(this.getId());e.remove();try{const n=await this.query().destroy();return R.log("model update response",n),this.getId()}catch(n){m.make(t).update(),R.error("Error: "+n)}}isFieldAttribute(e){return this.isPublicField(e)}isPublicField(e){return!e.startsWith("_")&&!e.startsWith("#")}hasOne(e,t){return this.relationships.hasOwnProperty(e)?t.find(this.relationships[e])??null:null}hasMany(e,t){return this.relationships.hasOwnProperty(e)?t.findIn(this.relationships[e])??[]:[]}belongsTo(e,t,n=null,r=null,o=null){if(this.putRelation(e,t),V(n))return;const u=n.find(t);r=r||this.storageName(),this._dependentRelationships[e]={relationEntity:u,localRelationName:r,localStorageName:o}}hasRelation(e){return!!this.getRelation(e)}setRelation(e,t){this._checkAndCreateRelationshipsField(),this.relationships[e]=t}addRelation(e,t){this._checkAndCreateRelationshipsField(),this.relationships.hasOwnProperty(e)||(this.relationships[e]=[]),this.relationships[e].push(t)}getRelation(e){return this.relationships[e]??null}removeRelation(e){delete this.relationships[e],this._checkAndDeleteRelationshipsField()}removeRelationValue(e,t){const n=this.getRelation(e);if(V(n)||Xe(n))return;const r=n.indexOf(t);delete this.relationships[e][r]}isFieldRelation(e){return(Array.isArray(this._relations)?le:et)===le?this._relations.includes(e):this._relations.hasOwnProperty(e)}isFieldModel(e){return this[e]instanceof ie}_convertModelToId(e){return e.getId()}_creator(e){e=e||{};for(let[t,n]of Object.entries(e))this[t]=n}_checkAndCreateRelationshipsField(){this.hasOwnProperty("relationships")||(this.relationships={})}_checkAndDeleteRelationshipsField(){Object.entries(this.relationships).length===0&&delete this.relationships}_updateDependentRelationships(e,t=null){const n=Object.entries(this._dependentRelationships);for(let[r,{relationEntity:o,localRelationName:u}]of n)V(t)?o.putRelation(u,e):t!==0?o.replaceRelation(u,e,t):o.deleteRelation(u,e),o.updateLocal()}deleteRelation(e,t=null){const n=this[e];if(D(n)){if(V(t))throw Error("Delete Relation: no value specified");this.removeRelationValue(e,t)}else this.removeRelation(e)}replaceRelation(e,t,n){const r=this[e];if(D(r)){const o=this.getRelation(e);this.setRelation(e,De(o,n,t))}else this.setRelation(e,t)}putRelation(e,t){const n=this[e];D(n)?this.addRelation(e,t):this.setRelation(e,t)}};J=new WeakMap,N=new WeakMap;let P=ie;class w extends P{constructor(){super(...arguments);d(this,"_resourceName","currencies")}}class W extends P{constructor(){super(...arguments);d(this,"_resourceName","account-sums")}get currency(){return this.hasOne("currency",w)}set currency(t){return this.belongsTo("currency",t)}get account(){this.hasOne("account",K)}set account(t){this.belongsTo("account",t,K,"sums")}}class de extends P{constructor(){super(...arguments);d(this,"_resourceName","account-categories")}get accounts(){return this.hasMany("accounts",K)}get icon(){var t;return((t=we.find(n=>n.id===this.id))==null?void 0:t.icon)??null}getSum(){return this.accounts.reduce((t,n)=>n.getSum()+t,0)}storageIndex(){return this.setStorageName(Se)}static async loadMainPage(){return await this.query().get("/main-page")}async loadMainPage(){return await this.query().get("/main-page")}}class K extends P{constructor(){super(...arguments);d(this,"_resourceName","accounts")}get sums(){return this.hasMany("sums",W)}set sums(t){this.belongsTo("sums",t)}get category(){return this.hasOne("category",de)}set category(t){this.belongsTo("category",t,de,"accounts")}get currency(){return this.hasOne("currency",w)}set currency(t){this.belongsTo("currency",t)}getSum(){return Ve(this.sums,"balance")}}const yt=se("accounts/index",{state:()=>({accountsPanelModel:[],categoriesIds:[]}),getters:{},actions:{addCategoryId(s){this.categoriesIds.indexOf(s)===-1&&this.categoriesIds.push(s)}}});function _t(s){return ve(s)?!0:"Поле не може бути пустим."}function tt(s){return ve(s)||s===0||s==="0"?!0:"Поле не може бути пустим."}function st(s){return Ze(s)?!0:"Значення повинно бути цілим числом."}function gt(s){const e=async()=>{const{valid:r}=await s.value.validate();return r},t=()=>s.value.resetValidation();return{validate:e,resetValidation:t,check:async()=>(t(),await e())}}function re(s){return s instanceof W}function nt(s){return s.every(re)}function rt(s){return s instanceof w}const it={class:"d-flex align-center s-item"},ot={class:"flex-grow-1"},at={key:0,class:"align-self-center"},ct={__name:"AccountSumItem",props:{accountSum:{type:Object,required:!0,validator:s=>s instanceof W},isAvailableRemove:{type:Boolean,required:!1}},emits:{removeAccountSum:re},setup(s,{emit:e}){const t=s,n=e,r=U({get:()=>t.accountSum.balance??0,set:C=>Fe(t.accountSum,{balance:C})}),o=U(()=>w.find(t.accountSum.getRelation("currency"))),u=[st,tt];return(C,I)=>{const x=y("v-text-field"),T=y("v-btn");return g(),M("div",it,[z("div",ot,"Баланс ("+B(o.value.alphabetic_code)+")",1),z("div",null,[A(x,{modelValue:r.value,"onUpdate:modelValue":I[0]||(I[0]=S=>r.value=S),rules:u,density:"compact",width:"100",variant:"underlined",class:"s-text-field",type:"number"},{"append-inner":v(()=>[z("span",null,B(o.value.symbol),1)]),_:1},8,["modelValue"])]),s.isAvailableRemove?(g(),M("div",at,[A(T,{variant:"text",icon:"mdi-close",onClick:I[1]||(I[1]=S=>n("removeAccountSum",s.accountSum))})])):pe("",!0)])}}},ut=Oe(ct,[["__scopeId","data-v-feb3efb9"]]),lt={__name:"TheAddAccountSum",emits:{selectedCurrency:rt},setup(s,{emit:e}){const t=e,n=U(()=>w.all());return(r,o)=>{const u=y("v-divider"),C=y("v-btn"),I=y("v-list-item-title"),x=y("v-list-item-subtitle"),T=y("v-list-item"),S=y("v-list"),f=y("v-menu");return g(),M("div",null,[A(u,{class:"mb-3"}),A(f,null,{activator:v(({props:h})=>[A(C,Ce(ke(h)),{default:v(()=>[X(" Додати валюту ")]),_:2},1040)]),default:v(()=>[A(S,null,{default:v(()=>[(g(!0),M(ee,null,fe(n.value,h=>(g(),$(T,{key:h.id,onClick:oe=>t("selectedCurrency",h)},{default:v(()=>[A(I,null,{default:v(()=>[X(B(h.name),1)]),_:2},1024),A(x,null,{default:v(()=>[X(B(h.symbol)+", "+B(h.alphabetic_code),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})])}}},vt={__name:"TheAccountSums",props:{accountSums:{type:Array,required:!0,validator:nt},isCreateFirst:{type:Boolean,default:!1}},emits:{createdAccountSum:re},setup(s,{emit:e}){const t=s,n=e,r=Ee(!1),o=U(()=>w.findLoaded());Ne(()=>{u()});async function u(){o.value.length!==3&&await I(),t.isCreateFirst&&C()}function C(){const f=w.all();S(f[0])}async function I(){r.value=!0;try{await w.sync()}finally{r.value=!1}}function x(f){T(f)||S(f)}function T(f){return t.accountSums.some(h=>h.currency.id===f.id)}function S(f){const h=new W;h.balance=0,h.currency=f.id,n("createdAccountSum",h)}return(f,h)=>{const oe=y("v-progress-linear");return g(),M(ee,null,[r.value?(g(),$(oe,{key:0,indeterminate:""})):pe("",!0),(g(!0),M(ee,null,fe(s.accountSums,ae=>(g(),$(ut,{key:ae.id,"account-sum":ae},null,8,["account-sum"]))),128)),A(lt,{onSelectedCurrency:x})],64)}}},At=se("accounts/create",{state:()=>({account:null,sums:[]}),getters:{},actions:{createAccount(s){const e=new K;e.category=s,this.account=e},reset(){this.resetAccount(),this.resetAccountSum(),console.info("account and account sums were reset")},resetAccount(){this.account=null},resetAccountSum(){this.sums=[]},createAccountSum(s){this.sums.push(s)},deleteAccountSum(s){this.sums.splice(this.sums.indexOf(s),1)},async saveAccount(){this.account.currency=this.sums[0].currency.id;const s=await this.account.save({include:"sums,category"});await this.saveAccountSums(s)},async saveAccountSums(s){if(s)for(const e of this.sums)e.account=s,await e.save({include:"currency"})}}}),It={__name:"DialogComponent",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const{mobile:e}=Me(),t=Pe(s,"modelValue");return(n,r)=>{const o=y("v-dialog");return g(),$(o,{"max-width":"600",fullscreen:Te(e),modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=u=>t.value=u)},{default:v(()=>[xe(n.$slots,"default")]),_:3},8,["fullscreen","modelValue"])}}};export{K as A,vt as _,de as a,_ as b,At as c,gt as d,It as e,Le as f,ft as i,_t as r,mt as t,yt as u};
