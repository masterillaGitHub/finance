import{G as I,_ as F,j as k,n as A,r as p,o as r,c as y,a as S,t as h,k as i,e as V,w as C,H as j,I as N,f as O,z as R,d as b,F as w,y as q}from"./index-CsBXRI5z.js";import{a as L,b as B,C as _,d as M,A as P}from"./Transaction-CMZ7FxtM.js";import{a as T,b as z,v as D}from"./entities-n8vO3US1.js";import{_ as E,a as G}from"./CurrenciesList-Ct_5xQyC.js";const ne=I("accounts/index",{state:()=>({amountTotal:0,accountsPanelModel:[],categoriesIds:[]}),getters:{},actions:{addCategoryId(e){this.categoriesIds.indexOf(e)===-1&&this.categoriesIds.push(e)},updateAmountTotal(){const e=L.findIn(this.categoriesIds);this.amountTotal=e.reduce((t,c)=>t+c.getSumInMineCurrency(),0)}}}),H={class:"d-flex align-center s-item"},U={class:"d-flex align-center"},J={class:"mr-2"},K={key:0,class:"align-self-center"},Q={__name:"AccountSumItem",props:{accountSum:{type:Object,required:!0,validator:e=>e instanceof B},isAvailableRemove:{type:Boolean,required:!1}},emits:{removeAccountSum:T},setup(e,{emit:t}){const c=e,v=t,a=k(!1),u=A(()=>c.accountSum.balance??0),l=A(()=>_.find(c.accountSum.getRelation("currency")));function f(m){M(c.accountSum,{balance:m})}return(m,n)=>{const g=p("v-btn");return r(),y("div",H,[S("div",U,"Баланс ("+h(l.value.alphabetic_code)+")",1),S("div",{class:"flex-grow-1 d-flex justify-end align-center text-h6",onClick:n[2]||(n[2]=o=>a.value=!0)},[S("span",J,h(u.value),1),S("span",null,h(l.value.symbol),1),i(E,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=o=>a.value=o),"start-sum":u.value,onDone:n[1]||(n[1]=o=>f(o))},null,8,["modelValue","start-sum"])]),e.isAvailableRemove?(r(),y("div",K,[i(g,{variant:"text",icon:"mdi-close",onClick:n[3]||(n[3]=o=>v("removeAccountSum",e.accountSum))})])):V("",!0)])}}},W=F(Q,[["__scopeId","data-v-2df19aa5"]]),X={__name:"TheAddAccountSum",emits:{selectedCurrency:z},setup(e,{emit:t}){const c=t,v=A(()=>_.all());return(a,u)=>{const l=p("v-divider"),f=p("v-btn"),m=p("v-menu");return r(),y("div",null,[i(l,{class:"mb-3"}),i(m,null,{activator:C(({props:n})=>[i(f,j(N(n)),{default:C(()=>[O(" Додати валюту ")]),_:2},1040)]),default:C(()=>[i(G,{currencies:v.value,onSelected:u[0]||(u[0]=n=>c("selectedCurrency",n))},null,8,["currencies"])]),_:1})])}}},ce={__name:"TheAccountSums",props:{accountSums:{type:Array,required:!0,validator:D},isCreateFirst:{type:Boolean,default:!1}},emits:{createdAccountSum:T},setup(e,{emit:t}){const c=e,v=t,a=k(!1),u=A(()=>_.findLoaded());R(()=>{l()});async function l(){u.value.length!==3&&await m(),c.isCreateFirst&&f()}function f(){const s=_.all();o(s[0])}async function m(){a.value=!0;try{await _.sync()}finally{a.value=!1}}function n(s){g(s)||o(s)}function g(s){return c.accountSums.some(d=>d.currency.id===s.id)}function o(s){const d=new B;d.balance=0,d.currency=s.id,v("createdAccountSum",d)}return(s,d)=>{const $=p("v-progress-linear");return r(),y(w,null,[a.value?(r(),b($,{key:0,indeterminate:""})):V("",!0),(r(!0),y(w,null,q(e.accountSums,x=>(r(),b(W,{key:x.id,"account-sum":x},null,8,["account-sum"]))),128)),i(X,{onSelectedCurrency:n})],64)}}},se=I("accounts/create",{state:()=>({account:null,sums:[]}),getters:{},actions:{createAccount(e){const t=new P;t.category=e,this.account=t},reset(){this.resetAccount(),this.resetAccountSum(),console.info("account and account sums were reset")},resetAccount(){this.account=null},resetAccountSum(){this.sums=[]},createAccountSum(e){this.sums.push(e)},deleteAccountSum(e){this.sums.splice(this.sums.indexOf(e),1)},async saveAccount(){this.account.currency=this.sums[0].currency.id;const e=await this.account.save({include:"sums,category"});await this.saveAccountSums(e)},async saveAccountSums(e){if(e)for(const t of this.sums)t.account=e,await t.save({include:"currency"})}}});export{ce as _,se as a,ne as u};
