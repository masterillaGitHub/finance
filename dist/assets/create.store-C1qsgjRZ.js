import{J as w,_ as $,j as k,n as A,r as _,o as i,c as S,a as C,t as x,b as D,k as l,e as T,w as g,K as F,L,f as O,B as R,d as b,F as I,z as j,N as E,D as M}from"./index-BzizgZbg.js";import{a as P,b as V,d as N,C as y,c as q,e as z,f as U,v as J,A as K}from"./entities-Ld4GelJy.js";import{_ as Y,a as G}from"./CurrenciesList-BZ_0te8g.js";import{u as H}from"./currency_decimal_convert-KKbzYINo.js";const ue=w("accounts/index",{state:()=>({amountTotal:0,accountsPanelModel:[],categoriesIds:[]}),getters:{},actions:{addCategoryId(e){this.categoriesIds.indexOf(e)===-1&&this.categoriesIds.push(e)},updateAmountTotal(){const e=P.findIn(this.categoriesIds);this.amountTotal=e.reduce((t,a)=>t+a.getSumInMineCurrency(),0)}}}),Q={class:"d-flex align-center s-item"},W={class:"d-flex align-center"},X={class:"mr-2"},Z={key:0,class:"align-self-center"},ee={__name:"AccountSumItem",props:{accountSum:{type:Object,required:!0,validator:e=>e instanceof V},isAvailableRemove:{type:Boolean,required:!1}},emits:{removeAccountSum:N},setup(e,{emit:t}){const{toDecimal:a,toInteger:v}=H(),o=e,m=t,u=k(!1),d=A(()=>a(o.accountSum.balance)??0),f=A(()=>y.find(o.accountSum.getRelation("currency")));function r(p){z(o.accountSum,{balance:v(p)})}return(p,s)=>{const c=_("v-btn");return i(),S("div",Q,[C("div",W,"Баланс ("+x(f.value.alphabetic_code)+")",1),C("div",{class:"flex-grow-1 d-flex justify-end align-center text-h6",onClick:s[2]||(s[2]=n=>u.value=!0)},[C("span",X,x(D(q)(d.value,f.value.alphabetic_code)),1),l(Y,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=n=>u.value=n),"start-sum":d.value,onDone:s[1]||(s[1]=n=>r(n))},null,8,["modelValue","start-sum"])]),e.isAvailableRemove?(i(),S("div",Z,[l(c,{variant:"text",icon:"mdi-close",onClick:s[3]||(s[3]=n=>m("removeAccountSum",e.accountSum))})])):T("",!0)])}}},te=$(ee,[["__scopeId","data-v-23e4787d"]]),ce={__name:"TheAddAccountSum",emits:{selectedCurrency:U},setup(e,{emit:t}){const a=t,v=A(()=>y.all());return(o,m)=>{const u=_("v-divider"),d=_("v-btn"),f=_("v-menu");return i(),S("div",null,[l(u,{class:"mb-3"}),l(f,null,{activator:g(({props:r})=>[l(d,F(L(r)),{default:g(()=>[O(" Додати валюту ")]),_:2},1040)]),default:g(()=>[l(G,{currencies:v.value,onSelected:m[0]||(m[0]=r=>a("selectedCurrency",r))},null,8,["currencies"])]),_:1})])}}},re={__name:"TheAccountSums",props:{accountSums:{type:Array,required:!0,validator:J},isCreateFirst:{type:Boolean,default:!1}},emits:{createdAccountSum:N},setup(e,{emit:t}){const a=e,v=t,o=k(!1),m=A(()=>y.findLoaded());R(()=>{u()});async function u(){m.value.length!==3&&await f(),a.isCreateFirst&&d()}function d(){const c=y.all();p(c[0])||s(c[0])}async function f(){o.value=!0;try{await y.sync()}finally{o.value=!1}}function r(c){p(c)||s(c)}function p(c){return a.accountSums.some(n=>n.currency.id===c.id)}function s(c){const n=new V;n.balance=0,n.currency=c.id,v("createdAccountSum",n)}return(c,n)=>{const B=_("v-progress-linear");return i(),S(I,null,[o.value?(i(),b(B,{key:0,indeterminate:""})):T("",!0),(i(!0),S(I,null,j(e.accountSums,h=>(i(),b(te,{key:h.id,"account-sum":h},null,8,["account-sum"]))),128)),l(ce,{onSelectedCurrency:r})],64)}}},ie=w("accounts/create",{state:()=>({account:null,sums:[]}),getters:{},actions:{createAccount(e){const t=new K;t.category=e,this.account=t},reset(){this.resetAccount(),this.resetAccountSum(),console.info("account and account sums were reset")},resetAccount(){this.account=null},resetAccountSum(){this.sums=[]},createAccountSum(e){this.sums.push(e)},deleteAccountSum(e){this.sums.splice(this.sums.indexOf(e),1)},async saveAccount(){const e=E();this.account.currency=e.getMainCurrency.id;const t=await this.account.save({include:"sums,category"});this.account.place_type===M&&await this.saveAccountSums(t)},async saveAccountSums(e){if(e)for(const t of this.sums)t.account=e,await t.save({include:"currency"})}}});export{re as _,ie as a,ue as u};
