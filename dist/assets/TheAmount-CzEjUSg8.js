import{m as U,r as t,o as l,d as k,w as n,j as e,f as F,c as p,t as D,b as c,F as O,x as j,V as fe,p as se,_ as Z,i as $,y as q,n as le,W as ye,a as b,e as L,X as xe,Y as ce,Z as ge,$ as Te,a0 as Ce,L as Se,U as ie,T as B,C as re,z as Q,a1 as ue,a2 as ke,h as Ve,a3 as ee,S as he}from"./index-BrXRMGmX.js";import{t as Ie,i as we,c as Y,a as A,d as $e,S as be,e as Ae,f as Ee,s as De,b as Ue,g as Ne,h as Pe}from"./form.store-EBaaRdbv.js";import{f as X,g as te,A as ne,a as K,C as oe,T as Me}from"./entities-BNYU3wZw.js";import{a as de,_ as _e}from"./CurrenciesList-BhJmpedc.js";import{u as pe}from"./currency_decimal_convert-KKbzYINo.js";function Oe(f,o){const a=Ie(f);if(!we(a))throw new RangeError("Invalid time value");let r="";const s="-",_=":";{const d=Y(a.getDate(),2),v=Y(a.getMonth()+1,2);r=`${Y(a.getFullYear(),4)}${s}${v}${s}${d}`}{const d=Y(a.getHours(),2),v=Y(a.getMinutes(),2),m=Y(a.getSeconds(),2);r=`${r}${r===""?"":" "}${d}${_}${v}${_}${m}`}return r}const Re={key:"0",class:"text-grey"},Le={key:"1"},Ye={__name:"TheTypeStep",setup(f){const o=A(),a=U({get:()=>o.typeId,set:s=>o.typeId=s});async function r(){o.categoryId=null,o.accountTransferId=null,await se(),o.nextStep()}return(s,_)=>{const d=t("v-col"),v=t("v-fade-transition"),m=t("v-row"),x=t("v-expansion-panel-title"),g=t("v-chip"),i=t("v-chip-group"),T=t("v-expansion-panel-text"),u=t("v-expansion-panel");return l(),k(u,{value:c($e)},{default:n(()=>[e(x,{"hide-actions":""},{default:n(({expanded:y})=>[e(m,{"no-gutters":""},{default:n(()=>[e(d,{class:"d-flex justify-start",cols:"4"},{default:n(()=>_[1]||(_[1]=[F("Тип:")])),_:1}),e(d,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(v,{"leave-absolute":""},{default:n(()=>[y?(l(),p("span",Re,"Вкажіть тип транзакції")):(l(),p("span",Le,D(c(o).getType.name),1))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(T,null,{default:n(()=>[e(i,{mandatory:"",modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=y=>a.value=y)},{default:n(()=>[(l(!0),p(O,null,j(c(fe),y=>(l(),k(g,{key:y.id,label:"",variant:"text",text:y.name,value:y.id,onClick:r},null,8,["text","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["value"])}}},je={key:0},Be={key:1},Fe={key:0,class:"text-truncate"},ze={key:1,class:"text-grey"},Ge={class:"ml-1"},qe={key:1},Xe={key:2},Ze={class:"s-parent-wrapper"},He={__name:"TheCategoryStep",setup(f){const o=A(),a=$(!1),r=$(!1),s=$(),_=$(),d=$(new X),v=U(()=>o.typeId),m=U(()=>X.findLoaded().filter(V=>!!V.user_id));q(x),le(v,x);async function x(){u(),r.value=!0;try{await se(),await X.loadCategoryStep(o.typeId)}finally{r.value=!1}}function g(V){if(V.isChildren()){a.value=!0,d.value=V;return}y(V.id),E()}function i(V){y(V.id),E()}function T(){a.value=!1}function u(){ye(o.transactionId)&&y(),s.value=!1,_.value=!1,d.value=new X,a.value=!1}function y(V=null){o.categoryId=V}function E(){o.nextStep()}return(V,C)=>{const w=t("v-fade-transition"),P=t("v-col"),M=t("v-icon"),I=t("v-row"),h=t("v-expansion-panel-title"),z=t("v-progress-linear"),H=t("v-badge"),R=t("v-chip"),G=t("v-chip-group"),W=t("v-btn"),J=t("v-expansion-panel-text"),N=t("v-expansion-panel");return l(),k(N,{value:c(be)},{default:n(()=>[e(h,null,{default:n(({expanded:S})=>[e(I,{"no-gutters":""},{default:n(()=>[e(P,{cols:"4"},{default:n(()=>[e(w,{"leave-absolute":""},{default:n(()=>[c(o).typeId===1?(l(),p("span",je,"На категорію:")):(l(),p("span",Be,"З категорії:"))]),_:1})]),_:1}),e(P,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(w,{"leave-absolute":""},{default:n(()=>[c(o).getCategory.id?(l(),p("div",Fe,[e(M,{icon:c(o).getCategory.icon},null,8,["icon"]),F(" "+D(c(o).getCategory.name),1)])):(l(),p("div",ze,"Вкажіть категорію"))]),_:1})]),_:1})]),_:1})]),actions:n(()=>[b("div",Ge,[c(o).isCategoryValid?L("",!0):(l(),k(M,{key:0,color:"error",icon:"mdi-alert-circle"}))])]),_:1}),e(J,{class:"s-panel-text"},{default:n(()=>[e(w,{mode:"out-in"},{default:n(()=>[r.value?(l(),k(z,{key:0,indeterminate:""})):!a.value&&!r.value?(l(),p("div",qe,[e(G,{mandatory:"",column:"",modelValue:s.value,"onUpdate:modelValue":C[0]||(C[0]=S=>s.value=S)},{default:n(()=>[(l(!0),p(O,null,j(m.value,S=>(l(),k(R,{key:S.id,label:"",variant:"text","prepend-icon":S.icon,text:S.name,value:S.id,onClick:me=>g(S)},xe({_:2},[S.isChildren()?{name:"append",fn:n(()=>[e(H,{content:S.childrenCount(),inline:"",color:"transparent"},null,8,["content"])]),key:"0"}:void 0]),1032,["prepend-icon","text","value","onClick"]))),128))]),_:1},8,["modelValue"])])):(l(),p("div",Xe,[b("div",Ze,[b("div",null,[C[4]||(C[4]=b("div",{class:"text-grey text-subtitle-2"},"Батьківська категорія",-1)),e(G,{mandatory:"",column:"",modelValue:_.value,"onUpdate:modelValue":C[2]||(C[2]=S=>_.value=S)},{default:n(()=>[e(R,{label:"",variant:"text",text:d.value.name,value:d.value.id,onClick:C[1]||(C[1]=S=>i(d.value))},null,8,["text","value"])]),_:1},8,["modelValue"])]),e(W,{icon:"mdi-arrow-up-left",variant:"text",onClick:ce(T,["stop"])})]),C[5]||(C[5]=b("div",{class:"text-grey text-subtitle-2"},"Підкатегорії",-1)),e(G,{mandatory:"",column:"",modelValue:_.value,"onUpdate:modelValue":C[3]||(C[3]=S=>_.value=S)},{default:n(()=>[(l(!0),p(O,null,j(d.value.children,S=>(l(),k(R,{key:S.id,label:"",variant:"text",text:S.name,value:S.id,onClick:me=>i(S)},null,8,["text","value","onClick"]))),128))]),_:1},8,["modelValue"])]))]),_:1})]),_:1})]),_:1},8,["value"])}}},We=Z(He,[["__scopeId","data-v-723ab1c6"]]),Je={key:0,class:"text-grey"},Ke={key:1,class:"text-truncate"},Qe={key:2},et={__name:"TheTagStep",emits:["done"],setup(f,{emit:o}){const a=A(),r=$(!1),s=U(()=>te.findLoaded()),_=U(()=>a.getTags.map(m=>m.name).join(", "));q(d);async function d(){await v()}async function v(){r.value=!0;try{await te.sync({"filter[user_id]":"auth"})}finally{r.value=!1}}return(m,x)=>{const g=t("v-col"),i=t("v-fade-transition"),T=t("v-row"),u=t("v-expansion-panel-title"),y=t("v-chip"),E=t("v-chip-group"),V=t("v-expansion-panel-text"),C=t("v-expansion-panel");return l(),k(C,{value:c(Ae)},{default:n(()=>[e(u,{"hide-actions":""},{default:n(()=>[e(T,{"no-gutters":""},{default:n(()=>[e(g,{class:"d-flex justify-start",cols:"4"},{default:n(()=>x[1]||(x[1]=[F("Теги:")])),_:1}),e(g,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(i,{"leave-absolute":""},{default:n(()=>[c(a).getTags.length===0?(l(),p("div",Je,"Вкажіть теги")):c(a).getTags.length<=3?(l(),p("div",Ke,D(_.value),1)):(l(),p("div",Qe,"вибрано "+D(c(a).getTags.length)+" тегів",1))]),_:1})]),_:1})]),_:1})]),_:1}),e(V,{class:"s-panel-text"},{default:n(()=>[e(E,{multiple:"",column:"",modelValue:c(a).tagIds,"onUpdate:modelValue":x[0]||(x[0]=w=>c(a).tagIds=w)},{default:n(()=>[(l(!0),p(O,null,j(s.value,w=>(l(),k(y,{key:w.id,label:"",variant:"text",text:w.name,value:w.id},null,8,["text","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["value"])}}},tt=Z(et,[["__scopeId","data-v-01b37451"]]),nt={__name:"TheDateStep",emits:["done"],setup(f,{emit:o}){const a=A(),r=$(),s=$(!1),_=$(a.date),d=$();ge(()=>{r.value=a.getDate,a.getDate==="today"?d.value="Сьогодні":a.getDate==="yesterday"?d.value="Вчора":a.getDate==="tomorrow"?d.value="Завтра":(r.value="custom",d.value=a.getDate)});function v(){a.date=De(new Date,1),i()}function m(){a.date=new Date,i()}function x(){s.value=!0}function g(){a.date=_.value,s.value=!1,i()}function i(){a.nextStep()}return(T,u)=>{const y=t("v-col"),E=t("v-fade-transition"),V=t("v-row"),C=t("v-expansion-panel-title"),w=t("v-date-picker"),P=t("v-divider"),M=t("v-spacer"),I=t("v-btn"),h=t("v-card-actions"),z=t("v-card"),H=t("v-dialog"),R=t("v-chip"),G=t("v-chip-group"),W=t("v-expansion-panel-text"),J=t("v-expansion-panel");return l(),k(J,{value:c(Ee)},{default:n(()=>[e(C,{"hide-actions":""},{default:n(({expanded:N})=>[e(V,{"no-gutters":""},{default:n(()=>[e(y,{class:"d-flex justify-start",cols:"4"},{default:n(()=>u[4]||(u[4]=[F("Дата:")])),_:1}),e(y,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(E,{"leave-absolute":""},{default:n(()=>[b("span",null,D(d.value),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(W,null,{default:n(()=>[e(H,{modelValue:s.value,"onUpdate:modelValue":u[2]||(u[2]=N=>s.value=N),"max-width":"600"},{default:n(()=>[e(z,null,{default:n(()=>[e(w,{modelValue:_.value,"onUpdate:modelValue":u[0]||(u[0]=N=>_.value=N),width:"100%",color:"primary"},null,8,["modelValue"]),e(P),e(h,null,{default:n(()=>[e(M),e(I,{text:"Відміна",variant:"plain",onClick:u[1]||(u[1]=N=>s.value=!1)}),e(I,{color:"primary",text:"Вибрати",variant:"tonal",onClick:g})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(G,{mandatory:"",modelValue:r.value,"onUpdate:modelValue":u[3]||(u[3]=N=>r.value=N)},{default:n(()=>[e(R,{label:"",variant:"text",text:"Вчора",value:"yesterday",onClick:v}),e(R,{label:"",variant:"text",text:"Сьогодні",value:"today",onClick:m}),e(R,{label:"",variant:"text",text:"Вибрати",value:"custom",onClick:x})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["value"])}}},ot={key:0},at={key:1},st={key:0,class:"text-truncate"},lt={key:1,class:"text-grey"},ct={class:"ml-1"},it={key:0},rt={key:1},ut={class:"s-back-button-wrapper"},dt={__name:"TheAccountStep",props:Te({account:{type:Object,default:new ne,validator:f=>f instanceof ne},isValid:{type:Boolean,required:!0},isTransfer:{type:Boolean,default:!1},stepName:{type:String,default:Ue}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const o=f,a=A(),r=Ce(f,"modelValue");U(()=>a.typeId),Se(()=>{o.isTransfer&&(r.value=null)});const s=$(!1),_=U(()=>K.findLoaded()),d=$(null),v=$(new K);function m(g){v.value=g,s.value=!0}function x(){s.value=!1}return(g,i)=>{const T=t("v-fade-transition"),u=t("v-col"),y=t("v-icon"),E=t("v-row"),V=t("v-expansion-panel-title"),C=t("v-chip"),w=t("v-chip-group"),P=t("v-btn"),M=t("v-expansion-panel-text"),I=t("v-expansion-panel");return l(),k(I,{value:f.stepName},{default:n(()=>[e(V,{"disable-icon-rotate":""},{default:n(({expanded:h})=>[e(E,{"no-gutters":""},{default:n(()=>[e(u,{cols:"4"},{default:n(()=>[e(T,{"leave-absolute":""},{default:n(()=>[c(a).typeId===c(ie)||f.isTransfer?(l(),p("span",ot,"На рахунок:")):(l(),p("span",at,"З рахунку:"))]),_:1})]),_:1}),e(u,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(T,{"leave-absolute":""},{default:n(()=>[f.account.id?(l(),p("div",st,[e(y,{icon:f.account.icon},null,8,["icon"]),F(" "+D(f.account.name),1)])):(l(),p("div",lt,"Вкажіть рахунок"))]),_:1})]),_:1})]),_:1})]),actions:n(()=>[b("div",ct,[f.isValid?L("",!0):(l(),k(y,{key:0,color:"error",icon:"mdi-alert-circle"}))])]),_:1}),e(M,{class:"s-panel-text"},{default:n(()=>[e(T,{mode:"out-in"},{default:n(()=>[s.value?(l(),p("div",rt,[b("div",ut,[e(P,{size:"small",text:"Назад",onClick:ce(x,["stop"])})]),e(w,{mandatory:"",column:"",modelValue:r.value,"onUpdate:modelValue":i[2]||(i[2]=h=>r.value=h)},{default:n(()=>[(l(!0),p(O,null,j(v.value.accounts,h=>(l(),k(C,{key:h.id,label:"",variant:"text","prepend-icon":h.icon,text:h.name,value:h.id,onClick:i[1]||(i[1]=z=>c(a).nextStep())},null,8,["prepend-icon","text","value"]))),128))]),_:1},8,["modelValue"])])):(l(),p("div",it,[e(w,{mandatory:"",column:"",modelValue:d.value,"onUpdate:modelValue":i[0]||(i[0]=h=>d.value=h)},{default:n(()=>[(l(!0),p(O,null,j(_.value,h=>(l(),k(C,{key:h.id,label:"","prepend-icon":h.icon,variant:"text",text:h.name,value:h.id,onClick:z=>m(h)},null,8,["prepend-icon","text","value","onClick"]))),128))]),_:1},8,["modelValue"])]))]),_:1})]),_:1})]),_:1},8,["value"])}}},ae=Z(dt,[["__scopeId","data-v-8e72374d"]]),_t={__name:"TheAccountsStepsChoice",setup(f){const o=A();return q(async()=>{await K.loadTransactionPage()}),(a,r)=>(l(),p(O,null,[e(ae,{modelValue:c(o).accountId,"onUpdate:modelValue":r[0]||(r[0]=s=>c(o).accountId=s),account:c(o).getAccount,"is-valid":c(o).isAccountValid},null,8,["modelValue","account","is-valid"]),c(o).typeId===c(B)?(l(),k(ae,{key:0,modelValue:c(o).toAccountId,"onUpdate:modelValue":r[1]||(r[1]=s=>c(o).toAccountId=s),account:c(o).getToAccount,"is-valid":c(o).isToAccountValid,"is-transfer":!0,"step-name":c(Ne)},null,8,["modelValue","account","is-valid","step-name"])):L("",!0)],64))}},ve=re("currencies",{state:()=>({loading:!1}),getters:{currencies:()=>oe.findLoaded()},actions:{async loadCurrencies(){if(this.currencies.length!==3){this.loading=!0;try{await oe.sync()}finally{this.loading=!1}}}}}),pt={key:"0",class:"text-grey"},vt={key:"1"},mt={class:"d-flex justify-end align-center pa-2"},ft={class:"text-h5"},yt={__name:"TheToAmount",setup(f){const{toDecimal:o,toPlus:a,toInteger:r}=pe(),s=A(),_=ve(),d=$(!1),v=U(()=>o(s.toAmount));q(()=>{m(),x()});function m(){Q(s.toAmount)&&(s.toAmount=a(s.amount))}function x(){Q(s.toCurrencyId)&&(s.toCurrencyId=s.currencyId)}return(g,i)=>{const T=t("v-col"),u=t("v-fade-transition"),y=t("v-row"),E=t("v-expansion-panel-title"),V=t("v-icon"),C=t("v-btn"),w=t("v-menu"),P=t("v-expansion-panel-text"),M=t("v-expansion-panel");return l(),k(M,{value:c(Pe)},{default:n(()=>[e(E,{"hide-actions":""},{default:n(({expanded:I})=>[e(y,{"no-gutters":""},{default:n(()=>[e(T,{class:"d-flex justify-start",cols:"4"},{default:n(()=>i[4]||(i[4]=[F("Переказати:")])),_:1}),e(T,{class:"text--secondary text-right",cols:"8"},{default:n(()=>[e(u,{"leave-absolute":""},{default:n(()=>[I?(l(),p("span",pt,"Вкажіть суму зарахування")):(l(),p("span",vt,D(v.value)+" "+D(c(s).getToCurrency.symbol),1))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),e(P,null,{default:n(()=>[b("div",mt,[b("div",{class:"text-right d-flex align-center",onClick:i[0]||(i[0]=I=>d.value=!0)},[b("span",ft,D(v.value),1),c(s).isAmountValid?L("",!0):(l(),k(V,{key:0,color:"error",icon:"mdi-alert-circle"}))]),e(w,null,{activator:n(({props:I})=>[e(C,ue({variant:"flat",class:"s-btn"},I,{"append-icon":"mdi-chevron-down"}),{default:n(()=>[e(V,{icon:c(s).getToCurrency.icon},null,8,["icon"])]),_:2},1040)]),default:n(()=>[e(de,{currencies:c(_).currencies,onSelected:i[1]||(i[1]=I=>c(s).toCurrencyId=I.id)},null,8,["currencies"])]),_:1})]),e(_e,{modelValue:d.value,"onUpdate:modelValue":i[2]||(i[2]=I=>d.value=I),"start-sum":v.value,onDone:i[3]||(i[3]=I=>c(s).toAmount=c(r)(I))},null,8,["modelValue","start-sum"])]),_:1})]),_:1},8,["value"])}}},Et={__name:"TheTransactionSteps",setup(f){const o=A();return(a,r)=>{const s=t("v-expansion-panels");return l(),p("div",null,[e(s,{modelValue:c(o).openStep,"onUpdate:modelValue":r[0]||(r[0]=_=>c(o).openStep=_),variant:"accordion",elevation:"0"},{default:n(()=>[e(Ye),e(_t),c(o).typeId!==c(B)?(l(),k(We,{key:0})):L("",!0),c(o).typeId===c(B)?(l(),k(yt,{key:1})):L("",!0),e(tt),e(nt)]),_:1},8,["modelValue"])])}}},xt=()=>({}),gt={},Tt={async loadTransactionById(f){const o=["category","account","currency","type","tags","transfer_transaction.category","transfer_transaction.currency","transfer_transaction.type","transfer_transaction.account","transfer_transaction.tags"];return(await Me.query().setUpdateMode(ke).setParams({include:o.join(","),"filter[id]":f}).get()).data.data[0]??null}},Ct=re("transaction/create",{state:xt,getters:gt,actions:Tt}),Dt={__name:"TheSaveButton",setup(f){const o=A(),a=Ct(),r=Ve(),s=$(!1);async function _(){if(o.isEnabledValidate=!0,!!o.isValid){s.value=!0;try{await d(),await r.push({name:"transactions.index"})}finally{s.value=!1}}}async function d(){const m=o.typeId,x=Oe(o.date),g=o.tagIds,i=o.getTransaction;i.category=o.typeId===B?ee:o.categoryId,i.currency=o.currencyId,i.type=m,i.account=o.accountId,i.setRelation("tags",g),i.amount=o.amount,i.note=null,i.transaction_at=x;const T=await i.save();if(o.typeId===B){const u=await v(i);u.type=m,u.category=ee,u.account=o.toAccountId,u.currency=o.toCurrencyId,u.transfer_transaction=T,u.amount=o.toAmount,u.setRelation("tags",g),u.note=null,u.transaction_at=x,await u.save()}}const v=async m=>(m.transfer_transaction_id&&!m.transfer_transaction&&(o.transferTransactionId=await a.loadTransactionById(m.transfer_transaction_id)),o.getTransferTransaction);return(m,x)=>{const g=t("v-btn");return l(),p("div",null,[e(g,{loading:s.value,color:"primary",rounded:"t-0 b-xl",size:"x-large",text:"Continue",variant:"flat",block:"",onClick:_},null,8,["loading"])])}}},St={class:"d-flex justify-end align-center pa-2"},kt={class:"text-h3"},Vt={__name:"TheCreateAmount",props:{amount:{type:[String,Number],default:"0"}},emits:["onClickOnAmount"],setup(f,{emit:o}){const a=o,r=A(),s=ve();q(_);async function _(){await s.loadCurrencies()}return(d,v)=>{const m=t("v-icon"),x=t("v-btn"),g=t("v-menu");return l(),p("div",St,[b("div",{class:"text-right mr-4 d-flex align-center",onClick:v[0]||(v[0]=i=>a("onClickOnAmount"))},[b("span",kt,D(f.amount),1),c(r).isAmountValid?L("",!0):(l(),k(m,{key:0,color:"error",icon:"mdi-alert-circle"}))]),e(g,null,{activator:n(({props:i})=>[e(x,ue({variant:"outlined",class:"s-btn"},i,{"append-icon":"mdi-chevron-down",loading:c(s).loading}),{default:n(()=>[e(m,{icon:c(r).getCurrency.icon},null,8,["icon"])]),_:2},1040,["loading"])]),default:n(()=>[e(de,{currencies:c(s).currencies,onSelected:v[1]||(v[1]=i=>c(r).currencyId=i.id)},null,8,["currencies"])]),_:1})])}}},ht=Z(Vt,[["__scopeId","data-v-2875c90d"]]),Ut={__name:"TheAmount",props:{isCalcShow:{type:Boolean,default:!1}},setup(f){const o=f,a=A(),{toInteger:r,toMinus:s,toPlus:_,toDecimal:d}=pe(),v=$(o.isCalcShow),m=U(()=>_(d(a.amount))),x=U(()=>a.typeId);le(x,()=>{a.amount=g(a.amount)});const g=T=>{switch(a.typeId){case he:case B:return s(T);case ie:return _(T)}},i=T=>{a.amount=g(r(T))};return(T,u)=>(l(),p(O,null,[e(ht,{amount:m.value,onOnClickOnAmount:u[0]||(u[0]=y=>v.value=!0)},null,8,["amount"]),e(_e,{modelValue:v.value,"onUpdate:modelValue":u[1]||(u[1]=y=>v.value=y),"start-sum":m.value,onDone:u[2]||(u[2]=y=>i(y))},null,8,["modelValue","start-sum"])],64))}};export{Ut as _,Et as a,Dt as b,Ct as u};
