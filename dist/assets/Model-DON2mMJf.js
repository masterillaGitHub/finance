var H=Object.defineProperty;var j=s=>{throw TypeError(s)};var J=(s,t,e)=>t in s?H(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var c=(s,t,e)=>J(s,typeof t!="symbol"?t+"":t,e),P=(s,t,e)=>t.has(s)||j("Cannot "+e);var r=(s,t,e)=>(P(s,t,"read from private field"),e?e.call(s):t.get(s)),u=(s,t,e)=>t.has(s)?j("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),l=(s,t,e,i)=>(P(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),I=(s,t,e)=>(P(s,t,"access private method"),e);import{C as V,M as x,a3 as k,cm as S,cn as Y,X as O,co as X,cp as M}from"./index-ByPb97X1.js";const p=V("models",{state:()=>({models:{},activeIds:{}}),getters:{getAll:s=>(t,e=!1)=>G(s,t,e),getById:s=>(t,e)=>K(s,t,e),getByIds:s=>(t,e)=>F(s,t,e),getByLoaded:s=>t=>F(s,t,z(s,t))},actions:{setActiveIds(s,t){C(this,s),this.activeIds[s]=t},addActiveIds(s,t){t.forEach(e=>this.addActiveId(s,e))},addActiveId(s,t){C(this,s),this.activeIds[s].push(t)},removeActiveIds(s,t){t.forEach(e=>this.removeLoadedId(s,e))},removeLoadedId(s,t){C(this,s);const e=this.activeIds.indexOf(t);delete this.activeIds[e]},setCollection(s,t){typeof this.models[s]>"u"&&(this.models[s]={}),this.models[s]=t},updateById(s,t,e){typeof this.models[s]>"u"&&(console.info(`create state model [${s}]`),this.models[s]={});const i={...this.models[s][t],...e},n={...this.models[s],[t]:i},h={...this.models,[s]:n};this.models=h},removeById(s,t){if(typeof this.models[s]>"u"){console.warn(`Not found state model [${s}]`);return}delete this.models[s][t]},reset(s){typeof this.models[s]<"u"&&(this.models[s]={}),typeof this.activeIds[s]<"u"&&(this.activeIds[s]=[])},resetAll(){this.models={},this.activeIds={}}}});function C(s,t){typeof s.activeIds[t]>"u"&&(s.activeIds[t]=[])}function z(s,t){return s.activeIds[t]??[]}function G(s,t,e=!1){const i=s.models[t];return e?i??{}:i?Object.values(i):[]}function F(s,t,e){return e.map(i=>K(s,t,i)).filter(i=>i)}function K(s,t,e){let i=s.models[t]??null;return i?i[e]:null}function N(s){return JSON.parse(JSON.stringify(s))}function Q(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function Z(s,t,e){return s.map(i=>i===t?e:i)}function ut(s,t={}){return tt(s,"UAH",t)}function tt(s,t="UAH",e={},i="uk-UA"){if(typeof s!="number")return s;const n={style:"currency",currency:t,currencyDisplay:"narrowSymbol"};return new Intl.NumberFormat(i,{...n,...e}).format(s)}function pt(s,t){return Object.assign(s,t)}function et(s){return Array.isArray(s)?s.length===0:Object.keys(s).length===0}function mt(s,t){return s.reduce((e,i)=>parseInt(e,10)+parseInt(i[t],10),0)}function st(s,t,e={},i={}){for(let[n,h]of Object.entries(s)){let g=i.hasOwnProperty(n)?i[n]:t;e.hasOwnProperty(n)&&(n=e[n]),rt(g,n,h)}}function it(s,t,e){if(et(t))return;const i=p();switch(e){case S:i.setActiveIds(s,t);break;case k:case x:i.addActiveIds(s,t);break}}function rt(s,t,e){switch(s){case S:B(t,e);break;case k:nt(t,e);break;case x:ot(t,e);break}}function B(s,t){p().setCollection(s,t)}function nt(s,t){L(s),B(s,Object.assign({},{...L(s),...t}))}function ot(s,t){console.log("fillModels update Field");const e={...L(s)};for(const i in t){const n={...e[i]};e[i]=Object.assign(n,t[i])}B(s,e)}function L(s){return p().getAll(s,!0)}var a,_,o,y,w,A,v,m,b,W,$,q;let at=(q=class{constructor(){u(this,m);u(this,a,null);u(this,_,{});u(this,o,{});u(this,y,{});u(this,w,S);u(this,A,{});u(this,v,{});this.api=new Y}static make(t){const e=new this;return e.setModel(t),e}getResponse(){return r(this,o)}getMeta(){return r(this,y)}getResourceUrl(t=null){return t?r(this,a).urlResource()+t:r(this,a).urlResource()}getStorageNames(){let t={};return r(this,a)&&(t[r(this,a).includeName()]=r(this,a).storageName()),{...t,...r(this,v)}}setModel(t){return l(this,a,t),this}setUpdateMode(t){return l(this,w,t),this}setParams(t){return l(this,_,t),this}setUpdateModes(t){return l(this,A,t),this}setStorageNames(t){return l(this,v,t),this}async get(t=null){var e;return this.api.params(r(this,_)),l(this,o,await this.api.query(this.getResourceUrl(t))),l(this,y,(e=r(this,o).data)==null?void 0:e.meta),I(this,m,b).call(this,r(this,o).data,r(this,w)),r(this,o)}async create(){var i;const t=r(this,a).urlResource(),e=r(this,a).toObject();return console.log("api create resource",t,e),this.api.params(r(this,_)),l(this,o,await this.api.post(t,e)),l(this,y,(i=r(this,o).data)==null?void 0:i.meta),I(this,m,b).call(this,r(this,o).data,k),r(this,o)}async update(){const t=r(this,a).urlResource()+"/"+r(this,a).getId(),e=r(this,a).toObject();return console.log("api update resource",t,e),this.api.params(r(this,_)),l(this,o,await this.api.patch(t,e)),l(this,y,r(this,o).data.meta),I(this,m,b).call(this,r(this,o).data,k),r(this,o)}async destroy(){const t=r(this,a).urlResource()+"/"+r(this,a).getId();return console.log("api destroy resource",t),l(this,o,await this.api.delete(t)),l(this,y,r(this,o).data.meta),r(this,o)}},a=new WeakMap,_=new WeakMap,o=new WeakMap,y=new WeakMap,w=new WeakMap,A=new WeakMap,v=new WeakMap,m=new WeakSet,b=function(t,e){it(r(this,a).storageName(),t.data,e),st(I(this,m,W).call(this,t.included),e,this.getStorageNames(),r(this,A))},W=function(t){for(const[e,i]of Object.entries(t))t[e]=I(this,m,$).call(this,i);return t},$=function(t){for(const[e,i]of Object.entries(t))i.exists=!0,t[e]=i;return t},q);class d{constructor(){c(this,"model",null);c(this,"params",{});this.params=this._getDefaultParams()}static make(t){const e=new this;return e.setModel(t),e}setModel(t){return this.model=t,this}setParams(t){return this.params={...this.params,...t},this}all(){const e=p().getAll(this._storageName());return this._handlerEntities(e)}find(t){const i=p().getById(this._storageName(),t);return i?this._handlerEntities([i])[0]:null}findIn(t){const i=p().getByIds(this._storageName(),t);return this._handlerEntities(i)}findLoaded(){const e=p().getByLoaded(this._storageName());return this._handlerEntities(e)}reset(){p().reset(this._storageName())}copyToStorage(t){const e=p(),i=e.getById(this._storageName(),this.model.id);e.updateById(t,this.model.id,i)}moveToStorage(t){this.copyToStorage(t),this._storeRemoveById(this.model.id)}update(){this._storeCommit()}create(){return this.model.getId()||this.model.setId(Q()),this._storeCommit(),this.model.getId()}remove(){this._storeRemoveById(this.model.getId())}removeById(t){this._storeRemoveById(t)}_storeRemoveById(t){p().removeById(this._storageName(),t)}_storeCommit(){const t=p(),e=N(this.model.toObject());t.updateById(this._storageName(),this.model.getId(),e)}_getDefaultParams(){return{model:!0,copy:!0,deepCopy:!0,with:[]}}_isFieldRelation(t){return this.model.isFieldRelation(t)}_getRelation(t){return this.model.relations()[t]??null}_storageName(){const t=this.model.storageName();if(!t)throw new Error("Is not founded storage name");return t}_handlerEntities(t){if(!Array.isArray(t))throw Error("Is not correct ids");return t.length?(this._isCopy()&&(t=t.map(e=>this._copyObj(e))),this._isWithRelations()&&(t=t.map(e=>this._completeRelations(e))),this._isModel()&&(t=t.map(e=>this._completeModel(e))),t):[]}_completeRelations(t){if(!t)return null;for(let[e,i]of Object.entries(t))if(this._isFieldRelation(e)&&i){const h=Array.isArray(i)?this._getRelation(e).findIn(i,this.params):this._getRelation(e).find(i,this.params);t[e]=h}return t}_completeModel(t){return this.model.clone().fill(t)}_isWithRelations(){return this.params.hasOwnProperty("with")&&this.params.with.length>0}_isModel(){return this.params.hasOwnProperty("model")&&this.params.model===!0}_isCopy(){return this.params.hasOwnProperty("copy")&&this.params.copy===!0}_isDeepCopy(){return this.params.hasOwnProperty("deepCopy")&&this.params.deepCopy===!0}_copyObj(t){return t&&(this._isDeepCopy()?N(t):{...t})}}function lt(){return typeof window<"u"?window.console:global.console}const f=lt(),T="array",ht="object";var E,R;const D=class D{constructor(){c(this,"relationships",{});c(this,"_dependentRelationships",{});c(this,"exists",!1);c(this,"_baseUrl","/api/v1");c(this,"_resourceName",null);u(this,E,[]);c(this,"_storageName",null);c(this,"_includeName",null);c(this,"_primaryKey","id");u(this,R,null)}instance(){return new this.constructor}static make(){return new this}static query(){return new this().query()}static sync(t={}){return new this().sync(t)}static fill(t){return new this().fill(t)}static createLocal(){return new this().createLocal()}static all(t){return new this().all(t)}static find(t,e={}){return new this().find(t,e)}static findIn(t,e={}){return new this().findIn(t,e)}static findLoaded(t={}){return new this().findLoaded(t)}static reset(){new this().reset()}apiResource(){return r(this,R)}urlResource(){return this._baseUrl+"/"+this.resourceName()}resourceName(){return this._resourceName}includeName(){return this._includeName||this.resourceName().replace("-","_")}storageName(){return this._storageName||this.includeName()}relations(){return this._relations}primaryKey(){return this._primaryKey}getId(){return this[this._primaryKey]??null}setId(t){return this[this._primaryKey]=t,this}setResourceName(t){return this._resourceName=t,this}setIncludeName(t){return this._includeName=t,this}setStorageName(t){return this._storageName=t,this}fill(t){return this._creator(t),this}toObject(){return Object.getOwnPropertyNames(this).reduce((e,i)=>(this.isFieldAttribute(i)&&(e[i]=this[i]),e),{})}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}query(){return at.make(this)}async sync(t={}){l(this,R,this.query());const e=await r(this,R).setParams(t).get();return f.log("sync response",e),l(this,E,e.data.data),e.data.data}all(t={}){return d.make(this).setParams(t).all()}find(t,e={}){return d.make(this).setParams(e).find(t)??null}findIn(t,e={}){return d.make(this).setParams(e).findIn(t)}findLoaded(t={}){return d.make(this).setParams(t).findLoaded()}reset(){d.make(this).reset()}createLocal(){const t=d.make(this).create();return this._updateDependentRelationships(t),t}updateLocal(){d.make(this).update()}destroyLocal(){d.make(this).remove()}copyToStorage(t){d.make(this).copyToStorage(t)}moveToStorage(t){d.make(this).moveToStorage(t)}save(t={}){return this.exists?this.update(t):this.create(t)}async create(t={}){const e=d.make(this),i=e.create();this._updateDependentRelationships(i);try{const n=await this.query().setParams(t).create();return this._updateDependentRelationships(n.data.data,i),f.log("model create response",n),e.removeById(i),n.data.data}catch(n){f.log("removeById",i),e.removeById(i),f.error("Error: "+n)}}async update(t={}){const e=d.make(this),i=e.find(this.getId());e.update();try{const n=await this.query().setParams(t).update();return f.log("model update response",n),n.data.data}catch(n){d.make(i).update(),f.error("Error: "+n)}return i.getId()}async destroy(){const t=d.make(this),e=t.find(this.getId());t.remove();try{const i=await this.query().destroy();return f.log("model update response",i),this.getId()}catch(i){d.make(e).update(),f.error("Error: "+i)}}isFieldAttribute(t){return this.isPublicField(t)}isPublicField(t){return!t.startsWith("_")&&!t.startsWith("#")}hasOne(t,e){return this.relationships.hasOwnProperty(t)?e.find(this.relationships[t])??null:null}hasMany(t,e){return this.relationships.hasOwnProperty(t)?e.findIn(this.relationships[t])??[]:[]}belongsTo(t,e,i=null,n=null,h=null){if(this.putRelation(t,e),O(i))return;const g=i.find(e);n=n||this.storageName(),this._dependentRelationships[t]={relationEntity:g,localRelationName:n,localStorageName:h}}hasRelation(t){return!!this.getRelation(t)}setRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships[t]=e}addRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships.hasOwnProperty(t)||(this.relationships[t]=[]),this.relationships[t].push(e)}getRelation(t){return this.relationships[t]??null}removeRelation(t){delete this.relationships[t],this._checkAndDeleteRelationshipsField()}removeRelationValue(t,e){const i=this.getRelation(t);if(O(i)||X(i))return;const n=i.indexOf(e);delete this.relationships[t][n]}isFieldRelation(t){return(Array.isArray(this._relations)?T:ht)===T?this._relations.includes(t):this._relations.hasOwnProperty(t)}isFieldModel(t){return this[t]instanceof D}_convertModelToId(t){return t.getId()}_creator(t){t=t||{};for(let[e,i]of Object.entries(t))this[e]=i}_checkAndCreateRelationshipsField(){this.hasOwnProperty("relationships")||(this.relationships={})}_checkAndDeleteRelationshipsField(){Object.entries(this.relationships).length===0&&delete this.relationships}_updateDependentRelationships(t,e=null){const i=Object.entries(this._dependentRelationships);for(let[n,{relationEntity:h,localRelationName:g}]of i)O(e)?h.putRelation(g,t):e!==0?h.replaceRelation(g,t,e):h.deleteRelation(g,t),h.updateLocal()}deleteRelation(t,e=null){const i=this[t];if(M(i)){if(O(e))throw Error("Delete Relation: no value specified");this.removeRelationValue(t,e)}else this.removeRelation(t)}replaceRelation(t,e,i){const n=this[t];if(M(n)){const h=this.getRelation(t);this.setRelation(t,Z(h,i,e))}else this.setRelation(t,e)}putRelation(t,e){const i=this[t];M(i)?this.addRelation(t,e):this.setRelation(t,e)}};E=new WeakMap,R=new WeakMap;let U=D;export{U as M,tt as a,pt as b,mt as c,ut as t,p as u};
