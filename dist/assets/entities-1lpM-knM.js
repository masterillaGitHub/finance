var tt=Object.defineProperty;var et=(s,t,e)=>t in s?tt(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var a=(s,t,e)=>(et(s,typeof t!="symbol"?t+"":t,e),e),L=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var n=(s,t,e)=>(L(s,t,"read from private field"),e?e.call(s):t.get(s)),d=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},u=(s,t,e,r)=>(L(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);var I=(s,t,e)=>(L(s,t,"access private method"),e);import{J as st,M as $,R as N,c3 as F,c4 as rt,V as E,c5 as it,c6 as B,c7 as nt,N as at,D as ot,A as V,c8 as ct,c9 as ut}from"./index-Cab78JjM.js";const p=st("models",{state:()=>({models:{},activeIds:{}}),getters:{getAll:s=>(t,e=!1)=>lt(s,t,e),getById:s=>(t,e)=>H(s,t,e),getByIds:s=>(t,e)=>Y(s,t,e),getByLoaded:s=>t=>Y(s,t,ht(s,t))},actions:{setActiveIds(s,t){D(this,s),this.activeIds[s]=t},addActiveIds(s,t){t.forEach(e=>this.addActiveId(s,e))},addActiveId(s,t){D(this,s),this.activeIds[s].push(t)},removeActiveIds(s,t){t.forEach(e=>this.removeLoadedId(s,e))},removeLoadedId(s,t){D(this,s);const e=this.activeIds.indexOf(t);delete this.activeIds[e]},setCollection(s,t){typeof this.models[s]>"u"&&(this.models[s]={}),this.models[s]=t},updateById(s,t,e){typeof this.models[s]>"u"&&(console.info(`create state model [${s}]`),this.models[s]={});const r={...this.models[s][t],...e},i={...this.models[s],[t]:r},h={...this.models,[s]:i};this.models=h},removeById(s,t){if(typeof this.models[s]>"u"){console.warn(`Not found state model [${s}]`);return}delete this.models[s][t]},reset(s){typeof this.models[s]<"u"&&(this.models[s]={}),typeof this.activeIds[s]<"u"&&(this.activeIds[s]=[])},resetAll(){this.models={},this.activeIds={}}}});function D(s,t){typeof s.activeIds[t]>"u"&&(s.activeIds[t]=[])}function ht(s,t){return s.activeIds[t]??[]}function lt(s,t,e=!1){const r=s.models[t];return e?r??{}:r?Object.values(r):[]}function Y(s,t,e){return e.map(r=>H(s,t,r)).filter(r=>r)}function H(s,t,e){let r=s.models[t]??null;return r?r[e]:null}function K(s){return JSON.parse(JSON.stringify(s))}function dt(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function pt(s,t,e){return s.map(r=>r===t?e:r)}function St(s,t={}){return yt(s,"UAH",t)}function yt(s,t="UAH",e={},r="uk-UA"){if(typeof s!="number")return s;const i={style:"currency",currency:t,currencyDisplay:"narrowSymbol"};return new Intl.NumberFormat(r,{...i,...e}).format(s)}function kt(s,t){return Object.assign(s,t)}function mt(s){return Array.isArray(s)?s.length===0:Object.keys(s).length===0}function gt(s,t){return s.reduce((e,r)=>parseInt(e,10)+parseInt(r[t],10),0)}function ft(s,t,e={},r={}){for(let[i,h]of Object.entries(s)){let f=r.hasOwnProperty(i)?r[i]:t;e.hasOwnProperty(i)&&(i=e[i]),It(f,i,h)}}function _t(s,t,e){if(mt(t))return;const r=p();switch(e){case F:r.setActiveIds(s,t);break;case N:case $:r.addActiveIds(s,t);break}}function It(s,t,e){switch(s){case F:U(t,e);break;case N:Rt(t,e);break;case $:At(t,e);break}}function U(s,t){p().setCollection(s,t)}function Rt(s,t){j(s),U(s,Object.assign({},{...j(s),...t}))}function At(s,t){console.log("fillModels update Field");const e={...j(s)};for(const r in t){const i={...e[r]};e[r]=Object.assign(i,t[r])}U(s,e)}function j(s){return p().getAll(s,!0)}var c,_,o,g,w,C,T,R,M,S,G,k,X,W;let Ot=(W=class{constructor(){d(this,R);d(this,S);d(this,k);d(this,c,null);d(this,_,{});d(this,o,{});d(this,g,{});d(this,w,F);d(this,C,{});d(this,T,{});this.api=new rt}static make(t){const e=new this;return e.setModel(t),e}getResponse(){return n(this,o)}getMeta(){return n(this,g)}getResourceUrl(t=null){return t?n(this,c).urlResource()+t:n(this,c).urlResource()}getStorageNames(){let t={};return n(this,c)&&(t[n(this,c).includeName()]=n(this,c).storageName()),{...t,...n(this,T)}}setModel(t){return u(this,c,t),this}setUpdateMode(t){return u(this,w,t),this}setParams(t){return u(this,_,t),this}setUpdateModes(t){return u(this,C,t),this}setStorageNames(t){return u(this,T,t),this}async get(t=null){var e;return this.api.params(n(this,_)),u(this,o,await this.api.query(this.getResourceUrl(t))),u(this,g,(e=n(this,o).data)==null?void 0:e.meta),I(this,R,M).call(this,n(this,o).data,n(this,w)),n(this,o)}async create(){var r;const t=n(this,c).urlResource(),e=n(this,c).toObject();return console.log("api create resource",t,e),this.api.params(n(this,_)),u(this,o,await this.api.post(t,e)),u(this,g,(r=n(this,o).data)==null?void 0:r.meta),I(this,R,M).call(this,n(this,o).data,N),n(this,o)}async update(){const t=n(this,c).urlResource()+"/"+n(this,c).getId(),e=n(this,c).toObject();return console.log("api update resource",t,e),this.api.params(n(this,_)),u(this,o,await this.api.patch(t,e)),u(this,g,n(this,o).data.meta),I(this,R,M).call(this,n(this,o).data,N),n(this,o)}async destroy(){const t=n(this,c).urlResource()+"/"+n(this,c).getId();return console.log("api destroy resource",t),u(this,o,await this.api.delete(t)),u(this,g,n(this,o).data.meta),n(this,o)}},c=new WeakMap,_=new WeakMap,o=new WeakMap,g=new WeakMap,w=new WeakMap,C=new WeakMap,T=new WeakMap,R=new WeakSet,M=function(t,e){_t(n(this,c).storageName(),t.data,e),ft(I(this,S,G).call(this,t.included),e,this.getStorageNames(),n(this,C))},S=new WeakSet,G=function(t){for(const[e,r]of Object.entries(t))t[e]=I(this,k,X).call(this,r);return t},k=new WeakSet,X=function(t){for(const[e,r]of Object.entries(t))r.exists=!0,t[e]=r;return t},W);class l{constructor(){a(this,"model",null);a(this,"params",{});this.params=this._getDefaultParams()}static make(t){const e=new this;return e.setModel(t),e}setModel(t){return this.model=t,this}setParams(t){return this.params={...this.params,...t},this}all(){const e=p().getAll(this._storageName());return this._handlerEntities(e)}find(t){const r=p().getById(this._storageName(),t);return r?this._handlerEntities([r])[0]:null}findIn(t){const r=p().getByIds(this._storageName(),t);return this._handlerEntities(r)}findLoaded(){const e=p().getByLoaded(this._storageName());return this._handlerEntities(e)}reset(){p().reset(this._storageName())}copyToStorage(t){const e=p(),r=e.getById(this._storageName(),this.model.id);e.updateById(t,this.model.id,r)}moveToStorage(t){this.copyToStorage(t),this._storeRemoveById(this.model.id)}update(){this._storeCommit()}create(){return this.model.getId()||this.model.setId(dt()),this._storeCommit(),this.model.getId()}remove(){this._storeRemoveById(this.model.getId())}removeById(t){this._storeRemoveById(t)}_storeRemoveById(t){p().removeById(this._storageName(),t)}_storeCommit(){const t=p(),e=K(this.model.toObject());t.updateById(this._storageName(),this.model.getId(),e)}_getDefaultParams(){return{model:!0,copy:!0,deepCopy:!0,with:[]}}_isFieldRelation(t){return this.model.isFieldRelation(t)}_getRelation(t){return this.model.relations()[t]??null}_storageName(){const t=this.model.storageName();if(!t)throw new Error("Is not founded storage name");return t}_handlerEntities(t){if(!Array.isArray(t))throw Error("Is not correct ids");return t.length?(this._isCopy()&&(t=t.map(e=>this._copyObj(e))),this._isWithRelations()&&(t=t.map(e=>this._completeRelations(e))),this._isModel()&&(t=t.map(e=>this._completeModel(e))),t):[]}_completeRelations(t){if(!t)return null;for(let[e,r]of Object.entries(t))if(this._isFieldRelation(e)&&r){const h=Array.isArray(r)?this._getRelation(e).findIn(r,this.params):this._getRelation(e).find(r,this.params);t[e]=h}return t}_completeModel(t){return this.model.clone().fill(t)}_isWithRelations(){return this.params.hasOwnProperty("with")&&this.params.with.length>0}_isModel(){return this.params.hasOwnProperty("model")&&this.params.model===!0}_isCopy(){return this.params.hasOwnProperty("copy")&&this.params.copy===!0}_isDeepCopy(){return this.params.hasOwnProperty("deepCopy")&&this.params.deepCopy===!0}_copyObj(t){return t&&(this._isDeepCopy()?K(t):{...t})}}function bt(){return typeof window<"u"?window.console:global.console}const m=bt(),J="array",vt="object";var P,A;const q=class q{constructor(){a(this,"relationships",{});a(this,"_dependentRelationships",{});a(this,"exists",!1);a(this,"_baseUrl","/api/v1");a(this,"_resourceName",null);d(this,P,[]);a(this,"_storageName",null);a(this,"_includeName",null);a(this,"_primaryKey","id");d(this,A,null)}instance(){return new this.constructor}static make(){return new this}static query(){return new this().query()}static sync(t={}){return new this().sync(t)}static fill(t){return new this().fill(t)}static createLocal(){return new this().createLocal()}static all(t){return new this().all(t)}static find(t,e={}){return new this().find(t,e)}static findIn(t,e={}){return new this().findIn(t,e)}static findLoaded(t={}){return new this().findLoaded(t)}static reset(){new this().reset()}apiResource(){return n(this,A)}urlResource(){return this._baseUrl+"/"+this.resourceName()}resourceName(){return this._resourceName}includeName(){return this._includeName||this.resourceName().replace("-","_")}storageName(){return this._storageName||this.includeName()}relations(){return this._relations}primaryKey(){return this._primaryKey}getId(){return this[this._primaryKey]??null}setId(t){return this[this._primaryKey]=t,this}setResourceName(t){return this._resourceName=t,this}setIncludeName(t){return this._includeName=t,this}setStorageName(t){return this._storageName=t,this}fill(t){return this._creator(t),this}toObject(){return Object.getOwnPropertyNames(this).reduce((e,r)=>(this.isFieldAttribute(r)&&(e[r]=this[r]),e),{})}clone(){return Object.assign(Object.create(Object.getPrototypeOf(this)),this)}query(){return Ot.make(this)}async sync(t={}){u(this,A,this.query());const e=await n(this,A).setParams(t).get();return m.log("sync response",e),u(this,P,e.data.data),e.data.data}all(t={}){return l.make(this).setParams(t).all()}find(t,e={}){return l.make(this).setParams(e).find(t)??this.instance()}findIn(t,e={}){return l.make(this).setParams(e).findIn(t)}findLoaded(t={}){return l.make(this).setParams(t).findLoaded()}reset(){l.make(this).reset()}createLocal(){const t=l.make(this).create();return this._updateDependentRelationships(t),t}updateLocal(){l.make(this).update()}destroyLocal(){l.make(this).remove()}copyToStorage(t){l.make(this).copyToStorage(t)}moveToStorage(t){l.make(this).moveToStorage(t)}save(t={}){return this.exists?this.update(t):this.create(t)}async create(t={}){const e=l.make(this),r=e.create();this._updateDependentRelationships(r);try{const i=await this.query().setParams(t).create();return this._updateDependentRelationships(i.data.data,r),m.log("model create response",i),e.removeById(r),i.data.data}catch(i){m.log("removeById",r),e.removeById(r),m.error("Error: "+i)}}async update(t={}){const e=l.make(this),r=e.find(this.getId());e.update();try{const i=await this.query().setParams(t).update();return m.log("model update response",i),i.data.data}catch(i){l.make(r).update(),m.error("Error: "+i)}return r.getId()}async destroy(){const t=l.make(this),e=t.find(this.getId());t.remove();try{const r=await this.query().destroy();return m.log("model update response",r),this.getId()}catch(r){l.make(e).update(),m.error("Error: "+r)}}isFieldAttribute(t){return this.isPublicField(t)}isPublicField(t){return!t.startsWith("_")&&!t.startsWith("#")}hasOne(t,e){return this.relationships.hasOwnProperty(t)?e.find(this.relationships[t])??null:null}hasMany(t,e){return this.relationships.hasOwnProperty(t)?e.findIn(this.relationships[t])??[]:[]}belongsTo(t,e,r=null,i=null,h=null){if(this.putRelation(t,e),E(r))return;const f=r.find(e);i=i||this.storageName(),this._dependentRelationships[t]={relationEntity:f,localRelationName:i,localStorageName:h}}hasRelation(t){return!!this.getRelation(t)}setRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships[t]=e}addRelation(t,e){this._checkAndCreateRelationshipsField(),this.relationships.hasOwnProperty(t)||(this.relationships[t]=[]),this.relationships[t].push(e)}getRelation(t){return this.relationships[t]??null}removeRelation(t){delete this.relationships[t],this._checkAndDeleteRelationshipsField()}removeRelationValue(t,e){const r=this.getRelation(t);if(E(r)||it(r))return;const i=r.indexOf(e);delete this.relationships[t][i]}isFieldRelation(t){return(Array.isArray(this._relations)?J:vt)===J?this._relations.includes(t):this._relations.hasOwnProperty(t)}isFieldModel(t){return this[t]instanceof q}_convertModelToId(t){return t.getId()}_creator(t){t=t||{};for(let[e,r]of Object.entries(t))this[e]=r}_checkAndCreateRelationshipsField(){this.hasOwnProperty("relationships")||(this.relationships={})}_checkAndDeleteRelationshipsField(){Object.entries(this.relationships).length===0&&delete this.relationships}_updateDependentRelationships(t,e=null){const r=Object.entries(this._dependentRelationships);for(let[i,{relationEntity:h,localRelationName:f}]of r)E(e)?h.putRelation(f,t):e!==0?h.replaceRelation(f,t,e):h.deleteRelation(f,t),h.updateLocal()}deleteRelation(t,e=null){const r=this[t];if(B(r)){if(E(e))throw Error("Delete Relation: no value specified");this.removeRelationValue(t,e)}else this.removeRelation(t)}replaceRelation(t,e,r){const i=this[t];if(B(i)){const h=this.getRelation(t);this.setRelation(t,pt(h,r,e))}else this.setRelation(t,e)}putRelation(t,e){const r=this[t];B(r)?this.addRelation(t,e):this.setRelation(t,e)}};P=new WeakMap,A=new WeakMap;let y=q;class O extends y{constructor(){super(...arguments);a(this,"_resourceName","currencies")}get icon(){var e;return((e=nt.find(r=>r.id===this.id))==null?void 0:e.icon)??null}}class z extends y{constructor(){super(...arguments);a(this,"_resourceName","account-sums")}getBalanceInMainCurrency(){const e=at(),r=this.currency.alphabetic_code.toLowerCase();if(r===e.currency.main)return this.balance;const i=e.currency.exchangeRates[r];return this.balance*i}get currency(){return this.hasOne("currency",O)}set currency(e){return this.belongsTo("currency",e)}get account(){this.hasOne("account",b)}set account(e){this.belongsTo("account",e,b,"sums")}}class b extends y{constructor(){super(...arguments);a(this,"_resourceName","accounts");a(this,"icon","mdi-help");a(this,"place_type",ot)}get sums(){return this.hasMany("sums",z)}set sums(e){this.belongsTo("sums",e)}get category(){return this.hasOne("category",x)}set category(e){this.belongsTo("category",e,x,"accounts")}get currency(){return this.hasOne("currency",O)}set currency(e){this.belongsTo("currency",e)}getSum(){return this.place_type===V?0:gt(this.sums,"balance")}getSumInMineCurrency(){return this.place_type===V?0:this.sums.reduce((e,r)=>e+r.getBalanceInMainCurrency(),0)}}class x extends y{constructor(){super(...arguments);a(this,"_resourceName","account-categories")}get accounts(){return this.hasMany("accounts",b)}get icon(){var e;return((e=ct.find(r=>r.id===this.id))==null?void 0:e.icon)??null}getSum(){return this.accounts.reduce((e,r)=>r.getSum()+e,0)}getSumInMineCurrency(){return this.accounts.reduce((e,r)=>r.getSumInMineCurrency()+e,0)}static async loadMainPage(){return await this.query().get("/main-page")}static async loadTransactionPage(){return await this.query().get("/transaction-page")}async loadMainPage(){return await this.query().get("/main-page")}}class v extends y{constructor(){super(...arguments);a(this,"_resourceName","transaction-categories");a(this,"icon","mdi-help")}get children(){return this.hasMany("children",v)}get transactions(){return this.hasMany("transactions",Z)}get parent(){return this.hasOne("parent",v)}set parent(e){return this.belongsTo("parent",e)}set type(e){this.belongsTo("type",e)}childrenCount(){return this.children.length}isChildren(){return this.childrenCount()>0}static async loadCategoryStep(e){return await this.query().get("/category-step?type_id="+e)}}class wt extends y{constructor(){super(...arguments);a(this,"_resourceName","transaction-types")}}class Q extends y{constructor(){super(...arguments);a(this,"_resourceName","transaction-tags")}}class Z extends y{constructor(){super(...arguments);a(this,"_resourceName","transactions")}isInitial(){return this.category.id===ut}get account(){return this.hasOne("account",b)}get currency(){return this.hasOne("currency",O)}get to_currency(){return this.hasOne("to_currency",O)}get to_account(){return this.hasOne("to_account",b)}get type(){return this.hasOne("type",wt)}get category(){return this.hasOne("category",v)}get tags(){return this.hasMany("tags",Q)}set currency(e){this.belongsTo("currency",e)}set to_currency(e){this.belongsTo("to_currency",e)}set type(e){this.belongsTo("type",e)}set account(e){this.belongsTo("account",e)}set to_account(e){this.belongsTo("to_account",e)}set category(e){this.belongsTo("category",e)}set tags(e){this.belongsTo("tags",e)}}function Lt(s){return s instanceof x}function Ct(s){return s instanceof z}function Bt(s){return s.every(Ct)}function Tt(s){return s instanceof O}function Dt(s){return s.every(Tt)}function jt(s){return s instanceof Z}function Et(s){return s instanceof v}function xt(s){return s.every(Et)}function Ft(s){return s instanceof Q}export{b as A,O as C,Z as T,x as a,z as b,yt as c,Ct as d,kt as e,Tt as f,jt as g,v as h,Lt as i,Q as j,Dt as k,Et as l,xt as m,Ft as n,St as t,p as u,Bt as v};
