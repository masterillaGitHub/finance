import{G as I,_ as F,j as k,n as S,r as _,o as r,c as y,a as h,t as x,b as j,k as i,e as V,w as C,H as N,I as O,f as R,z as q,d as b,F as w,y as L}from"./index-7TYs6_Yt.js";import{a as M,b as B,C as p,c as P,d as z,A as D}from"./Transaction-3bVJcTy4.js";import{a as T,b as E,v as G}from"./entities-pc8Wm9KT.js";import{_ as H,a as U}from"./CurrenciesList-C8h1v6t1.js";const se=I("accounts/index",{state:()=>({amountTotal:0,accountsPanelModel:[],categoriesIds:[]}),getters:{},actions:{addCategoryId(e){this.categoriesIds.indexOf(e)===-1&&this.categoriesIds.push(e)},updateAmountTotal(){const e=M.findIn(this.categoriesIds);this.amountTotal=e.reduce((t,n)=>t+n.getSumInMineCurrency(),0)}}}),J={class:"d-flex align-center s-item"},K={class:"d-flex align-center"},Q={class:"mr-2"},W={key:0,class:"align-self-center"},X={__name:"AccountSumItem",props:{accountSum:{type:Object,required:!0,validator:e=>e instanceof B},isAvailableRemove:{type:Boolean,required:!1}},emits:{removeAccountSum:T},setup(e,{emit:t}){const n=e,v=t,a=k(!1),u=S(()=>n.accountSum.balance??0),l=S(()=>p.find(n.accountSum.getRelation("currency")));function f(m){z(n.accountSum,{balance:m})}return(m,c)=>{const A=_("v-btn");return r(),y("div",J,[h("div",K,"Баланс ("+x(l.value.alphabetic_code)+")",1),h("div",{class:"flex-grow-1 d-flex justify-end align-center text-h6",onClick:c[2]||(c[2]=o=>a.value=!0)},[h("span",Q,x(j(P)(u.value,l.value.alphabetic_code)),1),i(H,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=o=>a.value=o),"start-sum":u.value,onDone:c[1]||(c[1]=o=>f(o))},null,8,["modelValue","start-sum"])]),e.isAvailableRemove?(r(),y("div",W,[i(A,{variant:"text",icon:"mdi-close",onClick:c[3]||(c[3]=o=>v("removeAccountSum",e.accountSum))})])):V("",!0)])}}},Y=F(X,[["__scopeId","data-v-31e64aa0"]]),Z={__name:"TheAddAccountSum",emits:{selectedCurrency:E},setup(e,{emit:t}){const n=t,v=S(()=>p.all());return(a,u)=>{const l=_("v-divider"),f=_("v-btn"),m=_("v-menu");return r(),y("div",null,[i(l,{class:"mb-3"}),i(m,null,{activator:C(({props:c})=>[i(f,N(O(c)),{default:C(()=>[R(" Додати валюту ")]),_:2},1040)]),default:C(()=>[i(U,{currencies:v.value,onSelected:u[0]||(u[0]=c=>n("selectedCurrency",c))},null,8,["currencies"])]),_:1})])}}},ae={__name:"TheAccountSums",props:{accountSums:{type:Array,required:!0,validator:G},isCreateFirst:{type:Boolean,default:!1}},emits:{createdAccountSum:T},setup(e,{emit:t}){const n=e,v=t,a=k(!1),u=S(()=>p.findLoaded());q(()=>{l()});async function l(){u.value.length!==3&&await m(),n.isCreateFirst&&f()}function f(){const s=p.all();o(s[0])}async function m(){a.value=!0;try{await p.sync()}finally{a.value=!1}}function c(s){A(s)||o(s)}function A(s){return n.accountSums.some(d=>d.currency.id===s.id)}function o(s){const d=new B;d.balance=0,d.currency=s.id,v("createdAccountSum",d)}return(s,d)=>{const $=_("v-progress-linear");return r(),y(w,null,[a.value?(r(),b($,{key:0,indeterminate:""})):V("",!0),(r(!0),y(w,null,L(e.accountSums,g=>(r(),b(Y,{key:g.id,"account-sum":g},null,8,["account-sum"]))),128)),i(Z,{onSelectedCurrency:c})],64)}}},oe=I("accounts/create",{state:()=>({account:null,sums:[]}),getters:{},actions:{createAccount(e){const t=new D;t.category=e,this.account=t},reset(){this.resetAccount(),this.resetAccountSum(),console.info("account and account sums were reset")},resetAccount(){this.account=null},resetAccountSum(){this.sums=[]},createAccountSum(e){this.sums.push(e)},deleteAccountSum(e){this.sums.splice(this.sums.indexOf(e),1)},async saveAccount(){this.account.currency=this.sums[0].currency.id;const e=await this.account.save({include:"sums,category"});await this.saveAccountSums(e)},async saveAccountSums(e){if(e)for(const t of this.sums)t.account=e,await t.save({include:"currency"})}}});export{ae as _,oe as a,se as u};
