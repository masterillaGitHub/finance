import{_ as J}from"./FullscreenAppBar-1zrFhwOU.js";import{h as k,l as N,m as Q}from"./entities-BmQlPgWX.js";import{a5 as H,J as K,Q as $,r as n,o as m,d as v,w as a,a as h,k as t,b as c,n as C,j as U,a0 as W,t as Z,S,c as M,f as E,e as P,F as ee,X as te,B as oe}from"./index-CatLxAw8.js";import{D as L}from"./vuedraggable.umd-Dt0kKAk1.js";import{r as ae,u as ne,_ as B}from"./DialogComponent-D1PZ-0IT.js";import{_ as se}from"./BottomConfirm-D17Vw_mt.js";import{_ as re}from"./TheCategoryIcon-BNQk6OsT.js";class ie extends H{getResource(){return"transaction-categories"}static setSorting(e){return new this().setSorting(e)}async setSorting(e){return await this.post(this.getPath()+"/set-sorting",{orderNumbers:e})}}const b=K("settings/categories",{state:()=>({categoryLoading:!1,editCategory:null,editDialog:!1,storeDialog:!1,currentTab:$,categoryIds:[]}),getters:{categories:o=>k.findIn(o.categoryIds)},actions:{async loadCategories(){console.log("load categories"),this.categoryLoading=!0;try{this.categoryIds=await k.sync({include:"children.parent,parent","filter[user_id]":"auth"})}finally{this.categoryLoading=!1}},async saveCategory(o){await o.save()},setNewCategory(){const o=new k;o.type=this.currentTab,this.editCategory=o,this.storeDialog=!0},setEditCategory(o){this.editCategory=o,this.editDialog=!0},closeDialog(){this.editDialog=!1,this.storeDialog=!1,setTimeout(()=>{this.editCategory=!1},1e3)},async setSorting(o){const e=o.map(u=>u.id);this.categoryIds=e,await ie.setSorting(e)}}}),le={class:"s-handle-sorting-setting-category-item text-grey mr-3"},O={__name:"CategoryItem",props:{category:{type:Object,required:!0,validator:N}},setup(o){const e=b();return(u,s)=>{const i=n("v-icon"),_=n("v-list-item");return m(),v(_,{title:o.category.name,onClick:s[0]||(s[0]=p=>c(e).setEditCategory(o.category))},{prepend:a(()=>[h("div",le,[t(i,{icon:o.category.icon},null,8,["icon"])])]),_:1},8,["title"])}}},ce={class:"s-handle-sorting-setting-category-item text-grey mr-3"},de={__name:"CategoryItemGroup",props:{category:{type:Object,required:!0,validator:N}},setup(o){const e=b(),u=o,s=C(()=>u.category.children),i=U(s.value),_=()=>{e.setSorting(s.value)};return(p,l)=>{const g=n("v-icon"),V=n("v-badge"),w=n("v-list-item-title"),x=n("v-btn"),f=n("v-list-item"),D=n("v-list-group");return m(),v(D,null,{activator:a(({props:d})=>[t(f,{"prepend-icon":o.category.icon,onClick:l[0]||(l[0]=r=>c(e).setEditCategory(o.category))},{prepend:a(()=>[h("div",ce,[t(g,{icon:o.category.icon},null,8,["icon"])])]),append:a(({isActive:r})=>[t(x,W(d,{icon:r?"mdi-chevron-up":"mdi-chevron-down",variant:"text"}),null,16,["icon"])]),default:a(()=>[t(w,null,{default:a(()=>[h("span",null,Z(o.category.name),1),t(V,{content:o.category.childrenCount(),inline:"",color:"transparent"},null,8,["content"])]),_:1})]),_:2},1032,["prepend-icon"])]),default:a(()=>[t(c(L),{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=d=>i.value=d),"item-key":"id",handle:".s-handle-sorting-setting-category-item",style:{width:"100%"},onUpdate:_},{item:a(({element:d})=>[t(O,{category:d},null,8,["category"])]),_:1},8,["modelValue"])]),_:1})}}},I={__name:"CategoryList",props:{categories:{type:Array,default:()=>[],validator:Q}},setup(o){const e=o,u=b(),s=C(()=>e.categories),i=()=>{u.setSorting(s.value)};return(_,p)=>{const l=n("v-list");return m(),v(l,null,{default:a(()=>[t(c(L),{list:s.value,"item-key":"id",handle:".s-handle-sorting-setting-category-item",style:{width:"100%"},onUpdate:i},{item:a(({element:g})=>[g.isChildren()?(m(),v(de,{key:0,category:g},null,8,["category"])):(m(),v(O,{key:1,category:g},null,8,["category"]))]),_:1},8,["list"])]),_:1})}}},ue={class:"pa-2"},_e={__name:"CategoryListTabs",setup(o){const e=b(),u=C(()=>e.categories.filter(i=>i.type_id===$)),s=C(()=>e.categories.filter(i=>i.type_id===S));return(i,_)=>{const p=n("v-tab"),l=n("v-tabs"),g=n("v-card"),V=n("v-tabs-window-item"),w=n("v-tabs-window"),x=n("v-fade-transition");return m(),M(ee,null,[h("div",ue,[t(g,{loading:c(e).categoryLoading},{default:a(()=>[t(l,{modelValue:c(e).currentTab,"onUpdate:modelValue":_[0]||(_[0]=f=>c(e).currentTab=f),grow:""},{default:a(()=>[t(p,{value:c($)},{default:a(()=>[E("Витрати")]),_:1},8,["value"]),t(p,{value:c(S)},{default:a(()=>[E("Доходи")]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1},8,["loading"])]),t(x,null,{default:a(()=>[c(e).categories.length?(m(),v(g,{key:0},{default:a(()=>[t(w,{modelValue:c(e).currentTab,"onUpdate:modelValue":_[1]||(_[1]=f=>c(e).currentTab=f)},{default:a(()=>[t(V,{value:c($)},{default:a(()=>[t(I,{categories:u.value},null,8,["categories"])]),_:1},8,["value"]),t(V,{value:c(S)},{default:a(()=>[t(I,{categories:s.value},null,8,["categories"])]),_:1},8,["value"])]),_:1},8,["modelValue"])]),_:1})):P("",!0)]),_:1})],64)}}},me={class:"text-center mb-4"},q={__name:"TheFormCategory",props:{title:{type:String,required:!0}},setup(o){const e=b(),u=U(),s={name:"Немає",id:null},i=C(()=>!!l.value.exists),_=C({get:()=>{var d;return(d=l.value.parent)!=null&&d.exists?l.value.parent:s},set:d=>l.value.parent=d}),p=U(!1),l=C(()=>e.editCategory),g=C(x),{check:V}=ne(u),w=[ae];function x(){const d=e.categories.filter(r=>r.type_id===e.currentTab).filter(r=>r.id!==l.value.id).map(r=>({name:r.name,id:r.id}));return d.unshift(s),d}async function f(){await V()&&(e.closeDialog(),await e.saveCategory(l.value),await e.loadCategories())}function D(){e.closeDialog(),l.value.destroy()}return(d,r)=>{const F=n("v-text-field"),R=n("v-select"),j=n("v-form"),z=n("v-card-text"),A=n("v-divider"),T=n("v-btn"),X=n("v-spacer"),Y=n("v-card-actions"),G=n("v-card");return m(),v(G,{"prepend-icon":"mdi-credit-card-edit-outline",title:o.title},{default:a(()=>[t(z,null,{default:a(()=>[h("div",me,[t(re,{modelValue:l.value.icon,"onUpdate:modelValue":r[0]||(r[0]=y=>l.value.icon=y)},null,8,["modelValue"])]),t(j,{onSubmit:te(f,["prevent"]),ref_key:"form",ref:u},{default:a(()=>[t(F,{label:"Назва категорії",modelValue:l.value.name,"onUpdate:modelValue":r[1]||(r[1]=y=>l.value.name=y),rules:w,autofocus:!i.value},null,8,["modelValue","autofocus"]),t(R,{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=y=>_.value=y),label:"Батьківська категорія",items:g.value,"item-title":"name","item-value":"id"},null,8,["modelValue","items"])]),_:1},512),t(se,{modelValue:p.value,"onUpdate:modelValue":r[3]||(r[3]=y=>p.value=y),title:"Видалити?",onSuccess:D},null,8,["modelValue"])]),_:1}),t(A),t(Y,null,{default:a(()=>[i.value?(m(),v(T,{key:0,class:"text-red",icon:"mdi-delete-outline",variant:"plain",onClick:r[4]||(r[4]=y=>p.value=!0)})):P("",!0),t(X),t(T,{text:"Відміна",size:"large",variant:"plain",onClick:r[5]||(r[5]=y=>c(e).closeDialog())}),t(T,{size:"large",color:"primary",text:"Зберегти",variant:"tonal",onClick:f})]),_:1})]),_:1},8,["title"])}}},ge={__name:"TheCategoryEdit",setup(o){const e=b();return(u,s)=>(m(),v(B,{modelValue:c(e).editDialog,"onUpdate:modelValue":s[0]||(s[0]=i=>c(e).editDialog=i)},{default:a(()=>[t(q,{title:"Редагування категорії"})]),_:1},8,["modelValue"]))}},ve={__name:"TheCategoryCreate",setup(o){const e=b();return(u,s)=>(m(),v(B,{modelValue:c(e).storeDialog,"onUpdate:modelValue":s[0]||(s[0]=i=>c(e).storeDialog=i)},{default:a(()=>[t(q,{title:"Нова категорія"})]),_:1},8,["modelValue"]))}},pe={class:""},he={__name:"Index",setup(o){const e=b();return oe(async()=>{await e.loadCategories()}),(u,s)=>{const i=n("v-btn");return m(),M("div",pe,[t(J,{"path-name":"settings.index",title:"Категорії"},{default:a(()=>[t(i,{icon:"mdi-plus",onClick:s[0]||(s[0]=_=>c(e).setNewCategory())})]),_:1}),t(_e),t(ve),t(ge)])}}};export{he as default};
