import{_ as B}from"./FullscreenAppBar-1zrFhwOU.js";import{j as y,n as E}from"./entities-BmQlPgWX.js";import{a5 as M,J as R,r as s,o as c,d as u,w as n,a as j,k as e,b as l,n as w,c as D,f as q,j as V,X as z,e as F,B as O}from"./index-CatLxAw8.js";import{D as A}from"./vuedraggable.umd-Dt0kKAk1.js";import{r as J,u as P,_ as k}from"./DialogComponent-D1PZ-0IT.js";import{_ as X}from"./BottomConfirm-D17Vw_mt.js";class G extends M{getResource(){return"transaction-tags"}static setSorting(t){return new this().setSorting(t)}async setSorting(t){return await this.post(this.getPath()+"/set-sorting",{orderNumbers:t})}}const g=R("settings/tags",{state:()=>({tagsLoading:!0,editTag:null,editDialog:!1,storeDialog:!1,tagIds:[]}),getters:{tags:a=>y.findIn(a.tagIds)},actions:{async loadTags(){console.log("load tags"),this.tagsLoading=!0;try{this.tagIds=await y.sync({"filter[user_id]":"auth"})}finally{this.tagsLoading=!1}},async saveTag(a){await a.save()},setNewTag(){this.editTag=new y,this.storeDialog=!0},setEditTag(a){this.editTag=a,this.editDialog=!0},closeDialog(){this.editDialog=!1,this.storeDialog=!1,setTimeout(()=>{this.editTag=!1},1e3)},async setSorting(a){const t=a.map(i=>i.id);this.tagIds=t,await G.setSorting(t)}}}),H={class:"s-handle-sorting-setting-tag-item text-grey mr-3"},K={__name:"TagItem",props:{tag:{type:Object,required:!0,validator:E}},setup(a){const t=g();return(i,o)=>{const r=s("v-icon"),d=s("v-list-item");return c(),u(d,{title:a.tag.name,onClick:o[0]||(o[0]=p=>l(t).setEditTag(a.tag))},{prepend:n(()=>[j("div",H,[e(r,{icon:"mdi-file-arrow-up-down-outline"})])]),_:1},8,["title"])}}},Q={class:"pa-2"},W={__name:"TheTagList",setup(a){const t=g(),i=w(()=>t.tags),o=()=>{t.setSorting(i.value)};return(r,d)=>{const p=s("v-card-text"),f=s("v-list"),v=s("v-fade-transition"),T=s("v-card");return c(),D("div",Q,[e(T,{loading:l(t).tagsLoading},{default:n(()=>[e(v,{mode:"out-in"},{default:n(()=>[i.value.length===0&&!l(t).tagsLoading?(c(),u(p,{key:0},{default:n(()=>[q(" Тегів немає ")]),_:1})):(c(),u(f,{key:1},{default:n(()=>[e(l(A),{list:i.value,"item-key":"id",handle:".s-handle-sorting-setting-tag-item",style:{width:"100%"},onUpdate:o},{item:n(({element:x})=>[e(K,{tag:x},null,8,["tag"])]),_:1},8,["list"])]),_:1}))]),_:1})]),_:1},8,["loading"])])}}},$={__name:"TheFormTag",props:{title:{type:String,required:!0}},setup(a){const t=g(),i=V(),o=w(()=>!!d.value.exists),r=V(!1),d=w(()=>t.editTag),{check:p}=P(i),f=[J];async function v(){await p()&&(t.closeDialog(),await t.saveTag(d.value),await t.loadTags())}function T(){t.closeDialog(),d.value.destroy()}return(x,_)=>{const S=s("v-text-field"),C=s("v-form"),b=s("v-card-text"),I=s("v-divider"),h=s("v-btn"),L=s("v-spacer"),N=s("v-card-actions"),U=s("v-card");return c(),u(U,{"prepend-icon":"mdi-credit-card-edit-outline",title:a.title},{default:n(()=>[e(b,null,{default:n(()=>[e(C,{onSubmit:z(v,["prevent"]),ref_key:"form",ref:i},{default:n(()=>[e(S,{label:"Назва тегу",modelValue:d.value.name,"onUpdate:modelValue":_[0]||(_[0]=m=>d.value.name=m),rules:f,autofocus:!o.value},null,8,["modelValue","autofocus"])]),_:1},512),e(X,{modelValue:r.value,"onUpdate:modelValue":_[1]||(_[1]=m=>r.value=m),title:"Видалити?",onSuccess:T},null,8,["modelValue"])]),_:1}),e(I),e(N,null,{default:n(()=>[o.value?(c(),u(h,{key:0,class:"text-red",icon:"mdi-delete-outline",variant:"plain",onClick:_[2]||(_[2]=m=>r.value=!0)})):F("",!0),e(L),e(h,{text:"Відміна",size:"large",variant:"plain",onClick:_[3]||(_[3]=m=>l(t).closeDialog())}),e(h,{size:"large",color:"primary",text:"Зберегти",variant:"tonal",onClick:v})]),_:1})]),_:1},8,["title"])}}},Y={__name:"TheTagEdit",setup(a){const t=g();return(i,o)=>(c(),u(k,{modelValue:l(t).editDialog,"onUpdate:modelValue":o[0]||(o[0]=r=>l(t).editDialog=r)},{default:n(()=>[e($,{title:"Редагування тегу"})]),_:1},8,["modelValue"]))}},Z={__name:"TheTagCreate",setup(a){const t=g();return(i,o)=>(c(),u(k,{modelValue:l(t).storeDialog,"onUpdate:modelValue":o[0]||(o[0]=r=>l(t).storeDialog=r)},{default:n(()=>[e($,{title:"Новий тег"})]),_:1},8,["modelValue"]))}},tt={class:""},rt={__name:"Index",setup(a){const t=g();return O(async()=>{await t.loadTags()}),(i,o)=>{const r=s("v-btn");return c(),D("div",tt,[e(B,{"path-name":"settings.index",title:"Теги"},{default:n(()=>[e(r,{icon:"mdi-plus",onClick:o[0]||(o[0]=d=>l(t).setNewTag())})]),_:1}),e(W),e(Z),e(Y)])}}};export{rt as default};
