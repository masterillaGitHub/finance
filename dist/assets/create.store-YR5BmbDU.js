import{G as w,_ as F,j as k,n as A,r as _,o as i,c as y,a as C,t as x,b as j,k as l,e as V,w as g,H as D,I as N,f as O,z as R,d as b,F as I,y as q}from"./index-uNLpc8m8.js";import{a as L,b as B,d as T,C as p,c as M,e as P,f as z,v as E,A as G}from"./entities-DXs83vKd.js";import{_ as H,a as U}from"./CurrenciesList-FRp3ZG6X.js";import{u as J}from"./currency_decimal_convert-KKbzYINo.js";const ae=w("accounts/index",{state:()=>({amountTotal:0,accountsPanelModel:[],categoriesIds:[]}),getters:{},actions:{addCategoryId(e){this.categoriesIds.indexOf(e)===-1&&this.categoriesIds.push(e)},updateAmountTotal(){const e=L.findIn(this.categoriesIds);this.amountTotal=e.reduce((t,a)=>t+a.getSumInMineCurrency(),0)}}}),K={class:"d-flex align-center s-item"},Q={class:"d-flex align-center"},W={class:"mr-2"},X={key:0,class:"align-self-center"},Y={__name:"AccountSumItem",props:{accountSum:{type:Object,required:!0,validator:e=>e instanceof B},isAvailableRemove:{type:Boolean,required:!1}},emits:{removeAccountSum:T},setup(e,{emit:t}){const{toDecimal:a,toInteger:f}=J(),o=e,m=t,u=k(!1),d=A(()=>a(o.accountSum.balance)??0),v=A(()=>p.find(o.accountSum.getRelation("currency")));function r(S){P(o.accountSum,{balance:f(S)})}return(S,n)=>{const s=_("v-btn");return i(),y("div",K,[C("div",Q,"Баланс ("+x(v.value.alphabetic_code)+")",1),C("div",{class:"flex-grow-1 d-flex justify-end align-center text-h6",onClick:n[2]||(n[2]=c=>u.value=!0)},[C("span",W,x(j(M)(d.value,v.value.alphabetic_code)),1),l(H,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=c=>u.value=c),"start-sum":d.value,onDone:n[1]||(n[1]=c=>r(c))},null,8,["modelValue","start-sum"])]),e.isAvailableRemove?(i(),y("div",X,[l(s,{variant:"text",icon:"mdi-close",onClick:n[3]||(n[3]=c=>m("removeAccountSum",e.accountSum))})])):V("",!0)])}}},Z=F(Y,[["__scopeId","data-v-23e4787d"]]),ee={__name:"TheAddAccountSum",emits:{selectedCurrency:z},setup(e,{emit:t}){const a=t,f=A(()=>p.all());return(o,m)=>{const u=_("v-divider"),d=_("v-btn"),v=_("v-menu");return i(),y("div",null,[l(u,{class:"mb-3"}),l(v,null,{activator:g(({props:r})=>[l(d,D(N(r)),{default:g(()=>[O(" Додати валюту ")]),_:2},1040)]),default:g(()=>[l(U,{currencies:f.value,onSelected:m[0]||(m[0]=r=>a("selectedCurrency",r))},null,8,["currencies"])]),_:1})])}}},oe={__name:"TheAccountSums",props:{accountSums:{type:Array,required:!0,validator:E},isCreateFirst:{type:Boolean,default:!1}},emits:{createdAccountSum:T},setup(e,{emit:t}){const a=e,f=t,o=k(!1),m=A(()=>p.findLoaded());R(()=>{u()});async function u(){m.value.length!==3&&await v(),a.isCreateFirst&&d()}function d(){const s=p.all();n(s[0])}async function v(){o.value=!0;try{await p.sync()}finally{o.value=!1}}function r(s){S(s)||n(s)}function S(s){return a.accountSums.some(c=>c.currency.id===s.id)}function n(s){const c=new B;c.balance=0,c.currency=s.id,f("createdAccountSum",c)}return(s,c)=>{const $=_("v-progress-linear");return i(),y(I,null,[o.value?(i(),b($,{key:0,indeterminate:""})):V("",!0),(i(!0),y(I,null,q(e.accountSums,h=>(i(),b(Z,{key:h.id,"account-sum":h},null,8,["account-sum"]))),128)),l(ee,{onSelectedCurrency:r})],64)}}},ue=w("accounts/create",{state:()=>({account:null,sums:[]}),getters:{},actions:{createAccount(e){const t=new G;t.category=e,this.account=t},reset(){this.resetAccount(),this.resetAccountSum(),console.info("account and account sums were reset")},resetAccount(){this.account=null},resetAccountSum(){this.sums=[]},createAccountSum(e){this.sums.push(e)},deleteAccountSum(e){this.sums.splice(this.sums.indexOf(e),1)},async saveAccount(){this.account.currency=this.sums[0].currency.id;const e=await this.account.save({include:"sums,category"});await this.saveAccountSums(e)},async saveAccountSums(e){if(e)for(const t of this.sums)t.account=e,await t.save({include:"currency"})}}});export{oe as _,ue as a,ae as u};
